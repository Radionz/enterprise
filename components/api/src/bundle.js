!function(e,t){for(var r in t)e[r]=t[r]}(exports,function(e){function t(a){if(r[a])return r[a].exports;var n=r[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=158)}([function(e,t){e.exports=require("lodash")},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.computeLineNumbers=t.arrayIncludes=t.nameValueToMap=t.mapToNameValue=t.safeStringify=t.safeParse=t.shallowEqual=void 0;var n=r(2),i=a(n),o=r(0),s=a(o),u=r(143),c=a(u),d=r(142),l=a(d),f=r(110),p=a(f),m=r(40);t.shallowEqual=p.default;t.safeParse=function(e,t){if("string"==typeof e)try{return JSON.parse(e)}catch(e){return t||{}}return e},t.safeStringify=function(e,t){return e&&"string"!=typeof e?(0,c.default)(e,null,t||2):e},t.mapToNameValue=function(e){return e instanceof Array?e:s.default.map(e||{},function(e,t){return{name:t,value:e}})},t.nameValueToMap=function(e){if(!s.default.isArray(e))return e;var t={},r=!0,a=!1,n=void 0;try{for(var o,u=(0,i.default)(e);!(r=(o=u.next()).done);r=!0){var c=o.value,d=c.name,l=c.value;t[d]=l}}catch(e){a=!0,n=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw n}}return t},t.arrayIncludes=function(e,t){if(!(e instanceof Array&&t instanceof Array))return!1;if(s.default.size(t)>s.default.size(e))return!1;for(var r in e)if(t.hasOwnProperty(r)&&e[r]!==t[r])return!1;return!0},t.computeLineNumbers=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,r=e.propPath,a=t;"string"==typeof t&&(a=JSON.parse(t));var n={from:0,to:0};if(s.default.isEmpty(a))return n;var i=l.default.stringify(a,null,2),o=(0,m.pathToHash)({path:r,noSign:!0}),u=s.default.get(i,["pointers",o]);return u&&(n.from=s.default.get(u,"value.line",0)+1,n.to=s.default.get(u,"valueEnd.line",0)+1),n}},function(e,t){e.exports=require("babel-runtime/core-js/get-iterator")},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(5),i=a(n),o=r(2),s=a(o),u=r(0),c=r(153),d=r(117),l=r(20),f=r(12),p=f.extractSrn,m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.data)if(e.data instanceof Array)for(var r in e.data)Object.prototype.hasOwnProperty.call(e.data,r)&&(e.data[r][t.name]=t.value);else u.set(e,"data."+t.name,t.value);return e},g=function(e,t){var r=["params."+t,"params.query."+t,"data."+t,t],a=!0,n=!1,i=void 0;try{for(var o,c=(0,s.default)(r);!(a=(o=c.next()).done);a=!0){var d=o.value,l=u.get(e,d);if(l!==":"+t&&"undefined"!==l&&!u.isEmpty(l))return l}}catch(e){n=!0,i=e}finally{try{!a&&c.return&&c.return()}finally{if(n)throw i}}},h=function(e){var t=e.prop,r=e.value,a=e.blacklist,n=e.query,o=e.service;return new i.default(function(e){var i=0,s=!0,f=c(r);d(function(){return s},function(e){var r=i>0?f+"-"+l.generate().substring(0,u.random(3,10)).toLowerCase():f;if(i++,a&&u.includes(a,r))return e(null,r);var c={};u.set(c,t,r),n&&u.merge(c,n),o.find({query:c}).then(function(t){s=!u.isEmpty(u.get(t,"data")),e(null,r)})},function(t,r){e(r)})})},v=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function(t){var r=g(t,"teamId")||g(t,"id");return r?(u.set(t,"requestedTeamId",r),t.app.services["orgs/:orgId/teams"].get(r,t.params).then(function(r){t.params.team=r;var a=u.get(t,"params.team._id");return u.set(t,"params.teamId",a),e&&u.set(t,"params.query.teamId",a),m(t,{name:"teamId",value:a}),t}).catch(function(){return t})):t}},y=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function(t){var r=g(t,"specId")||g(t,"id"),a=p({id:r});return a&&(r=a.entityId),!r||u.get(t,"params.spec")?t:(u.set(t,"requestedSpecId",r),t.app.services["orgs/:orgId/specs"].get(r,t.params).then(function(r){t.params.spec=r;var a=u.get(t,"params.spec._id");return u.set(t,"params.specId",a),e&&u.set(t,"params.query.specId",a),m(t,{name:"specId",value:a}),t}).catch(function(){return t}))}},I=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function(t){var r=g(t,"collectionId")||g(t,"id"),a=p({id:r});return a&&(r=a.entityId),!r||u.get(t,"params.collection")?t:(u.set(t,"requestedCollectionId",r),t.app.services["orgs/:orgId/collections"].get(r,t.params).then(function(r){t.params.collection=r;var a=u.get(t,"params.collection._id");return u.set(t,"params.collectionId",a),e&&u.set(t,"params.query.collectionId",a),m(t,{name:"collectionId",value:a}),t}).catch(function(){return t}))}},b=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function(t){var r=g(t,"instanceId")||g(t,"id"),a=p({id:r});return a&&(r=a.entityId),!r||u.get(t,"params.instance")?t:(u.set(t,"requestedInstanceId",r),t.app.services["orgs/:orgId/instances"].get(r,t.params).then(function(r){t.params.instance=r;var a=u.get(t,"params.instance._id");return u.set(t,"params.instanceId",a),e&&u.set(t,"params.query.instanceId",a),m(t,{name:"instanceId",value:a}),t}).catch(function(){return t}))}},_=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(r){var a=g(r,"orgId")||g(r,"id")||g(r,"requestedOrgId");return!a||u.get(r,"params.org")?r:(u.set(r,"requestedOrgId",a),r.app.services.orgs.get(a,r.params).then(function(t){r.params.org=t;var a=u.get(r,"params.org._id");return u.set(r,"params.orgId",a),e&&u.set(r,"params.query.orgId",a),m(r,{name:"orgId",value:a}),m(r,{name:"orgSlug",value:t.slug}),r}).catch(function(e){if(t)throw e;return r}))}},w=function(){return function(e){var t=u.get(e,"params.query.userId")||u.get(e,"data.userId");return t?(u.set(e,"requestedUserId",t),e.app.services.users.get(t,e.params).then(function(t){return e.params.user=t,u.set(e,"params.query.userId",t._id),m(e,{name:"userId",value:t._id}),e}).catch(function(){return e})):e}},S=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(e){case"teams":case"team":return v(t);case"specs":case"spec":return y(t);case"scenarios":case"scenario":case"collections":case"collection":return I(t);case"instances":case"instance":return b(t);case"orgs":case"org":return _(t,r);case"users":case"user":return w();default:return console.warn("Entity type "+e+" is not supported by lookupEntity"),function(e){return e}}},x=function(e,t,r){return e?S(e,t,r):function(t){return e||(e=g(t,"eType")),S(e)(t)}},E=function(){return function(e){var t=e.params.query;for(var r in t)if(t.hasOwnProperty(r)&&t[r].$search&&!r.includes("$")){var a=t[r].$search.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");t[r]={$regex:new RegExp(a,"i")}}return u.set(e,"hook.params.query",t),e}};e.exports={setDataProp:m,getProp:g,uniquePropByService:h,lookupTeam:v,lookupSpec:y,lookupCollection:I,lookupInstance:b,lookupOrg:_,lookupUser:w,lookupEntity:x,enableSearch:E}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(26),i=a(n),o=r(5),s=a(o),u=r(0),c=r(6),d=r(47),l=r(1).safeParse,f=d("feathers-authentication:hooks:authenticate"),p=function(e){var t=e.hook,r=e.request,a=e.strategy,n=e.options;return t.app.authenticate(a,n)(r).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.fail&&!n.optional){n.failureRedirect&&Object.defineProperty(t.data,"__redirect",{value:{status:302,url:n.failureRedirect}});var r=e.challenge,a=e.status,o=void 0===a?401:a,u=r&&r.message?r.message:r;return n.failureMessage&&(u=n.failureMessage),s.default.reject(new c[o](u,r))}return e.success?(t.params=(0,i.default)({authenticated:!0},t.params,e.data),n.successRedirect&&Object.defineProperty(t.data,"__redirect",{value:{status:302,url:n.successRedirect}})):e.redirect&&Object.defineProperty(t.data,"__redirect",{value:{status:e.status,url:e.url}}),s.default.resolve(t)})};e.exports={hooks:{authenticate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("The 'authenticate' hook requires one of your registered passport strategies.");return function(r){if(!r.params.provider||r.params.authenticated)return s.default.resolve(r);if("before"!==r.type)return s.default.reject(new Error("The 'authenticate' hook should only be used as a 'before' hook."));var a={query:r.data,body:r.data,params:r.params,headers:r.params.headers||{},cookies:r.params.cookies||{},session:{}};f("Attempting to authenticate using "+e+" strategy with options",t);var n=u.trim(u.get(a,"headers.authorization"),"Bearer ")||u.get(a,"params.query.apikey");return f("Using apiSecret: ",n),u.includes(e,"apiSecret")&&!u.isEmpty(n)?r.app.services.users.find({query:{apiSecret:n}}).then(function(n){var o=u.get(n,"data[0]",{});return u.isEmpty(o)?p({hook:r,request:a,strategy:u.without(e,"apiSecret"),options:t}):(r.params=(0,i.default)({authenticated:!0},r.params,{user:o,payload:{userId:o._id}}),s.default.resolve(r))}):p({hook:r,request:a,strategy:e,options:t})}},populateUser:function(){return function(e){return e}},restrictToAuthenticated:function(){return function(e){if("before"!==e.type)throw new Error("The 'restrictToAuthenticated' hook should only be used as a 'before' hook.");if(e.params.provider&&void 0===e.params.user)throw new c.NotAuthenticated("You are not authenticated.");return e}},restrictToOwner:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={idField:"_id",ownerField:"userId"};return function(r){var a=this;if("before"!==r.type)throw new Error("The 'restrictToOwner' hook should only be used as a 'before' hook.");if(!r.id)throw new c.MethodNotAllowed("The 'restrictToOwner' hook should only be used on the 'get', 'update', 'patch' and 'remove' service methods.");if(!r.params.provider)return r;if(u.isEmpty(r.params.user))throw new c.NotAuthenticated("You are not authenticated.");var n=l(process.env.AUTH,null)||r.app.get("AUTH"),o=(0,i.default)({},t,n,e),d=r.params.user[o.idField];if(void 0===d)throw new Error("'"+o.idField+" is missing from current user.'");return new s.default(function(e,t){var n=(0,i.default)({},r.params,{provider:void 0});return a.get(r.id,n).then(function(a){var n=a;n.toJSON?n=n.toJSON():n.toObject&&(n=n.toObject());var i=n[o.ownerField];if(u.isPlainObject(i)&&(i=i[o.idField]),Array.isArray(i)){var s=i.map(function(e){return e.toString()});(0===s.length||s.indexOf(d.toString())<0)&&t(new c.Forbidden("You do not have the permissions to access this."))}else void 0!==i&&i.toString()===d.toString()||t(new c.Forbidden("You do not have the permissions to access this."));e(r)}).catch(t)})}}}}},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("feathers-errors")},function(e,t){e.exports=require("babel-runtime/helpers/extends")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("feathers-hooks-common")},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(29),i=a(n),o=r(5),s=a(o),u=r(7),c=a(u),d=r(17),l=r(12),f=r(0),p=r(6),m=r(144),g=r(3),h=function(e,t){var r={orgId:f.get(e,"params.org._id"),userId:f.get(e,"params.user._id"),slAdmin:f.get(e,"params.user.slAdmin")},a=f.get(e,["params",t,"_id"]);return"before"!==e.type&&(a||(a=f.get(e,"result._id")),"org"===t&&(r.orgId=f.get(e,"result._id"))),r.resourceId=a,r.entityId=a,r},v=function(e){if("MissingArgumentError"===e.name)throw console.error(e),new p.BadRequest;throw e},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments[2],a=t.filter(function(t){return t.resourceId===e._id}),n=f.reduce(a,function(e,t){var a={acl:(0,c.default)({},t.acl,{permissions:r?t.permissions:t.resourcePermissions})};return m(e,a)},{});return f.merge({},e,n)},I=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=f.get(e,"params.aclRecords")||[];return a=f.isEmpty(a)||r?f.isArray(t)?t:[t]:a.concat(f.isArray(t)?t:[t]),f.set(e,"params.aclRecords",a),e},b=function(e,t,r,a){var n=f.get(e,"params.aclRecords",[]).slice(0);if(n.length){var i=n.map(function(e){return function(e){return e.userId===r.userId&&e.resourceId===r.resourceId}&&(a?f.set(e,t,f.get(a,t)):f.set(e,t,void 0)),e});I(e,i,!0)}return e};e.exports={hooks:{canUser:function(e,t,r){return function(a){return f.isUndefined(f.get(a,"params.provider"))?a:a.app.service("aclManagement").create({action:"canUser",value:(0,c.default)({},h(a,t),{resource:t,throwError:r,permission:e})}).then(function(e){var t=e.aclRecords;return I(a,t)}).catch(v)}},addOwner:function(e){return function(t){if("after"!==t.type)throw new Error('The addOwner() hook should only be used as an "after" hook.');return t.app.service("aclManagement").create({action:"addMember",value:(0,c.default)({},h(t,e),{resource:e,roles:["owner"]})}).then(function(e){var r=e.aclRecords;return I(t,r)})}},addOrgEntity:function(e){return function(t){if("after"!==t.type)throw new Error('The addOrgEntity() hook should only be used as an "after" hook.');var r=t.data.orgRoles;return r&&r.length?t.app.service("aclManagement").create({action:"addOrgEntity",value:(0,c.default)({},h(t,e),{entity:e,roles:r})}).then(function(e){var r=e.aclRecords;return I(t,r)}):t}},updateOrgEntity:function(e){return function(t){if("after"!==t.type)throw new Error('The updateOrgEntity() hook should only be used as an "after" hook.');var r=t.data.orgRoles;return f.isUndefined(r)?t:f.isNull(r)||0===r.length?t.app.service("aclManagement").create({action:"deleteOrgEntity",value:(0,c.default)({},h(t,e),{entity:e})}).then(function(e){var r=e.aclRecords;return b(t,"acl.org",r[0])}):t.app.service("aclManagement").create({action:"updateOrgEntity",value:(0,c.default)({},h(t,e),{entity:e,roles:r})}).then(function(e){var r=e.aclRecords;return b(t,"acl.org",r[0],r[0])})}},addPublicEntity:function(e){return function(t){if("after"!==t.type)throw new Error('The addPublicEntity() hook should only be used as an "after" hook.');var r=t.data.publicRoles;if(r&&r.length){var a=h(t,e);return t.app.service("aclManagement").create({action:"addPublicEntity",value:(0,c.default)({},a,{entity:e,roles:r})}).then(function(r){var n=r.aclRecords;return t.app.service("orgs/:orgId/"+e+"s").patch(a.entityId,{$pull:{connections:{orgId:a.orgId}}},{requestedOrgId:t.requestedOrgId,query:{orgId:a.orgId}}).then(function(){return I(t,n)})})}return t}},updatePublicEntity:function(e){return function(t){if("after"!==t.type)throw new Error('The updatePublicEntity() hook should only be used as an "after" hook.');var r=t.data.publicRoles;if(f.isUndefined(r))return t;if(f.isNull(r)||0===r.length){var a=h(t,e);return t.app.service("aclManagement").create({action:"deletePublicEntity",value:(0,c.default)({},a,{entity:e})}).then(function(r){var n=r.aclRecords;return t.app.service("orgs/:orgId/"+e+"s").patch(a.entityId,{$pull:{connections:{orgId:{$ne:a.orgId}}}},{requestedOrgId:t.requestedOrgId,query:{orgId:a.orgId}}).then(function(){return b(t,"acl.public",n[0])})})}return t.app.service("aclManagement").create({action:"updatePublicEntity",value:(0,c.default)({},h(t,e),{entity:e,roles:r})}).then(function(e){var r=e.aclRecords;return b(t,"acl.public",r[0],r[0])})}},listResources:function(e){return function(t){if("before"!==t.type)throw new Error('The listResources() hook should only be used as a "before" hook.');if(f.isUndefined(f.get(t,"params.provider")))return t;var r=h(t,e),a="true"===t.params.query.public||!0===t.params.query.public;return delete t.params.query.public,t.app.service("aclManagement").create({action:"listResources",value:(0,c.default)({},r,{resource:e})}).then(function(r){var n=r.aclRecords,i=f.uniq(f.map(n,"resourceId")),o=f.uniq(f.map(n,"orgId")),s=f.get(t,"params.query._id.$in")||[];if(s.length){var u=f.intersection(s,i);t.params.query._id={$in:u}}else t.params.query._id={$in:i};return a&&"org"!==e&&o.length&&(t.params.query.orgId=o),I(t,n),t})}},populateMember:function(){return function(e){if("after"!==e.type)throw new Error('The populateMember() hook should only be used as a "after" hook.');if(e.result){var t=e.result.aclRecords;if(f.isEmpty(t))return e;var r=f.map(t,"userId");return e.app.service("users").find({noFilter:!0,query:(0,c.default)({_id:{$in:r},$select:["profile","emails","username"]},f.pick(e.params.query,["$limit","$skip","$sort"]))}).then(function(r){return r.data=f.reduce(t,function(t,a){var n=f.find(r.data,{_id:a.userId});return n&&t.push({acl:a.acl,_id:n._id,id:n.username,username:n.username,name:f.get(n,"profile.name"),email:f.get(n,"emails[0].address"),orgId:e.requestedOrgId,teamId:e.requestedTeamId,specId:e.requestedSpecId,collectionId:e.requestedCollectionId,instanceId:e.requestedInstanceId}),t},[]),e.id||!f.isEmpty(e.data)?f.set(e,"result",r.data[0]):f.set(e,"result",r),e.data&&f.isArray(e.data.userId)&&f.set(e,"result",r),e})}return e}},populateTeam:function(){return function(e){if("after"!==e.type)throw new Error('The populateTeam() hook should only be used as a "after" hook.');if(e.result){var t=e.result.aclRecords;if(f.isEmpty(t))return e;var r=f.map(t,"teamId");return e.app.service("orgs/:orgId/teams").find({requestedOrgId:e.requestedOrgId,noFilter:!0,query:(0,c.default)({_id:{$in:r},orgId:f.get(e,"params.org._id")},f.pick(e.params.query,["$limit","$skip","$sort"]))}).then(function(r){return r.data=f.reduce(t,function(t,a){var n=f.find(r.data,{_id:a.teamId});return n&&t.push((0,c.default)({},n,{acl:a.acl,orgId:e.requestedOrgId,teamId:e.requestedTeamId,specId:e.requestedSpecId,collectionId:e.requestedCollectionId,instanceId:e.requestedInstanceId})),t},[]),e.id||!f.isEmpty(e.data)?f.set(e,"result",r.data[0]):f.set(e,"result",r),e.data&&f.isArray(e.data.teamId)&&f.set(e,"result",r),e})}return e}},removeRelated:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return function(r){if("before"!==r.type)throw new Error('The removeRelated() hook should only be used as a "before" hook.');var a="org"===e?f.get(r,"params.org._id",r.id):f.get(r,"params.org._id"),n=void 0;if("user"===e)n={userId:f.get(r,"params.user._id",r.id)};else{if(!a)return r;if(n={orgId:a},"org"!==e){var i=f.get(r,["params",e,"_id"],r.id);if(!i)return r;"team"===e?n.$or=[{teamId:i},{eId:i}]:n.eId=i}}var o={authenticated:r.params.authenticated,headers:r.params.headers,user:r.params.user,org:r.params.org,query:n};return s.default.all(t.map(function(e){return r.app.service(e).remove(null,o)})).then(function(){return r.app.service("acl").remove(null,{query:n}).then(function(){return r})})}},populateTeamEntity:function(e){var t={project:"orgs/:orgId/projects",spec:"orgs/:orgId/specs",collection:"orgs/:orgId/collections",instance:"orgs/:orgId/instances",portal:"orgs/:orgId/portals"};return function(r){if("after"!==r.type)throw new Error('The populateTeamEntity() hook should only be used as a "after" hook.');if(r.result){var a=r.result.aclRecords;if(f.isEmpty(a))return r;var n=t[e];if(!n)return r;var i=f.map(a,"resourceId"),o=r.params,s=o.orgId,u=o.user;return r.app.service("aclManagement").create({action:"listResources",value:{orgId:s,userId:u._id,slAdmin:u.slAdmin,resource:e}}).then(function(t){var a=t.aclRecords;return r.app.services[n].find({query:{_id:{$in:i},orgId:s},enableFilter:!0}).then(function(t){return t.data=f.reduce(t.data,function(e,t){return f.find(a,{resourceId:t._id})&&e.push((0,c.default)({},y(t,a),{orgId:r.requestedOrgId,teamId:r.requestedTeamId})),e},[]),r.id||!f.isEmpty(r.data)?f.set(r,"result",t.data[0]):f.set(r,"result",t),r.data&&f.isArray(r.data[e+"Id"])&&f.set(r,"result",t),r})})}return r}},populateConnectedEntity:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(r){if("after"!==r.type)throw new Error('The populateConnectedEntity() hook should only be used as a "after" hook.');if(r.result){var a=r.result,n=a.connections,o=a.availableResources,s=a.aclRecords,u=r.params,p=u.query,m=u[e],h=g.getProp(r,"entityType");if(f.isEmpty(n)&&f.isEmpty(o))return r.result={limit:p.$limit||25,skip:p.$skip||0,sort:p.$sort||0,data:[]},r;var v=r.requestedOrgId,y=r["requested"+f.upperFirst(e+"Id")],I=function(t,r){var a,n="outbound"===r?s:o,u=f.find(n,{resourceId:t._id}),m=(a={_id:t._id,id:t.orgSlug+"/"+h+"/"+t.slug,name:t.name},(0,i.default)(a,e+"Id",y),(0,i.default)(a,"orgId",v),(0,i.default)(a,"connectionType",r),(0,i.default)(a,"entityType",h),(0,i.default)(a,"acl",u?u.acl:{}),a);return p.detailed&&(m=(0,c.default)({},t,m,{detailed:!0})),f.unset(m,"urls.export"),f.set(m,"urls.export",(0,l.buildExportUrl)({entityType:m.entityType,entity:m,host:(0,d.getConfigVar)("HOST"),exportHost:(0,d.getConfigVar)("SL_EXPORT_HOST"),deref:"remote"})),m};if(o){var b=f.uniq(f.map(o,"resourceId"));return r.app.service("orgs/:orgId/"+h).find({query:(0,c.default)({_id:{$in:b},"connections.entityId":m._id},f.pick(r.params.query,["$limit","$skip","$sort"]))}).then(function(e){return e.data=f.map(e.data,function(e){return I(e,"inbound")}),f.set(r,"result",e),r})}var _=f.uniq(f.map(n,"entityId"));return r.app.service("orgs/:orgId/"+h).find({query:(0,c.default)({_id:{$in:_}},f.pick(r.params.query,["$limit","$skip","$sort"])),enableFilter:!0,dereference:t.dereference,detailed:!0}).then(function(e){return e.data=f.reduce(e.data,function(e,t){return f.find(n,{entityId:t._id})&&e.push(I(t,"outbound")),e},[]),f.set(r,"result",e),r})}return r}},augmentWithPermissions:function(e){return function(t){if("after"!==t.type)throw new Error('The augmentWithPermissions() hook should only be used as a "after" hook.');if(f.isUndefined(t.params.provider))return t;var r=t.params.aclRecords;if(f.isEmpty(r))return t;var a=t.result,n=void 0===a?{}:a;return n.data instanceof Array?t.result.data=n.data.map(function(t){return y(t,r,e)}):t.result=y(t.result,r,e),t}}}}},function(e,t,r){"use strict";var a=r(26),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(0),o=r(1),s=o.safeStringify,u=o.safeParse,c=r(27),d=c.dereference,l=function(e,t,r){return e.service.Model&&(e.service.Model.filter?t=e.service.Model.filter(e,t,r):console.warn(e.service.Model.modelName+" must implement a static filter method to use the filter hook.")),r.filter?r.filter(e,t,r):t};e.exports={filter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){if(i.isUndefined(t.params.provider)&&!t.params.enableFilter)return t;if(t.params.noFilter)return t;var r=t.result,a=i.get(t,"params.query._id.$in",[]);if(!i.isEmpty(r)){var o=void 0;o=!(r.data instanceof Array||r instanceof Array);var s=(0,n.default)(e,{detailed:t.params.hasOwnProperty("detailed")?t.params.detailed:e.detailed||o});r.data instanceof Array?t.result.data=i.map(r.data,function(e){return l(t,e,s)}):r instanceof Array?t.result=i.map(r,function(e){return i.includes(a,e._id),l(t,e,s)}):t.result=l(t,t.result,s)}return t}},stringifyData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){if(t.data instanceof Array)t.data=i.map(t.data,function(t){var r=i.get(t,e.path);return r&&i.set(t,e.path,s(r)),t});else{var r=i.get(t.data,e.path);r&&i.set(t.data,e.path,s(r))}return t}},parseResult:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){var r=t.result,a=t.params,n=void 0===a?{}:a,o=n.dereference;if(!i.isEmpty(r))if(r.data instanceof Array)t.result.data=i.map(r.data,function(t){var r=i.get(t,e.path);return r&&i.set(t,e.path,u(r,r)),t});else if(r instanceof Array)t.result=i.map(r,function(t){var a=i.get(r,e.path);return a&&i.set(r,e.path,u(a,a)),r});else{var s=i.get(t.result,e.path);s&&(t.result=i.set(t.result,e.path,u(s,s)))}return o?d(t.result,o).then(function(e){return t.result=e,t}):t}}}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getAllowedConnections=t.computeTreeData=t.buildExportUrl=t.cleanEntity=t.extractSrn=t.computeSrnData=t.exportUrlToSrn=t._exportUrlToSrn=t.getEntityTypesWithData=t.getEntityData=t.getEntityPropId=t.getEntityIcon=t.getEntityDescription=t.getEntityTabName=t.getEntityName=t.getEntityTeamServiceKey=t.getEntityServiceKey=t.getEntityKey=t.getEntityKeys=t.getEntityTypes=void 0;var n=r(7),i=a(n),o=r(31),s=a(o),u=r(0),c=a(u),d=r(111),l=r(40),f=r(24),p=r(17),m=r(23),g=r(42),h=r(108),v=t.getEntityTypes=function(){return["specs","collections","instances"]},y=(t.getEntityKeys=function(){return["spec","collection","instance"]},t.getEntityKey=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"specs";return c.default.trimEnd(e,"s")}),I=t.getEntityServiceKey=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"specs",t=arguments[1];return""+y(e)+(t?c.default.capitalize(t):"")+"Service"},b=t.getEntityTeamServiceKey=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"specs",t=y(e);return"team"+c.default.capitalize(t)+"Service"},_=t.getEntityName=function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"specs"){case"specs":return"API Spec";case"collections":return"Collection";case"instances":return"Instance";default:return"Entity"}},w=t.getEntityTabName=function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"specs"){case"specs":return"Modeling";case"collections":return"Testing";case"instances":return"Prism Instances";default:return"UNKNOWN"}},S=t.getEntityDescription=function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"specs"){case"specs":return"Design APIs with our visual OAS (Swagger 2) editor.";case"collections":return"Debug, test, and orchestrate APIs.";case"instances":return"Spin up mock APIs, validate HTTP traffic, and more.";default:return"Please select a valid type below."}},x=t.getEntityIcon=function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"specs"){case"specs":return"puzzle";case"collections":return"flask";case"instances":return"database";default:return"question"}},E=t.getEntityPropId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"specs";return y(e)+"Id"},T=t.getEntityData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"specs";return{type:e,tabName:w(e),name:_(e),icon:x(e),key:y(e),description:S(e),idProp:E(e),serviceKey:I(e),connectionServiceKey:I(e,"connection"),memberServiceKey:I(e,"member"),teamServiceKey:b(e),entityTeamServiceKey:I(e,"team"),buildExportUrl:function(t){return q({entityType:e,entity:t})}}},P=(t.getEntityTypesWithData=function(){var e=v();return c.default.map(e,T)},t._exportUrlToSrn=c.default.memoize(function(e){if(!e)return e;var t=(0,f.createURL)(e);return t&&t.pathname?""+c.default.trim(t.pathname,"/")+t.hash:e})),k=(t.exportUrlToSrn=function(e){var t=e.url;return P(t)},t.computeSrnData=function(e){var t=c.default.take(c.default.compact(c.default.split(e,"/")),3);return t.length<3?null:{orgId:t[0],type:t[1],entityId:t[2],srn:e}}),q=(t.extractSrn=function(e){if(c.default.isEmpty(e))return null;var t=c.default.get(e,"info.x-stoplight.id")||c.default.get(e,"id");return k(t)},t.cleanEntity=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"specs",t=arguments[1],r=t;switch(e){case"collections":r=(0,m.cleanCollection)({collection:t});break;case"specs":r=(0,g.cleanSpec)({spec:t});break;case"instances":r=(0,h.cleanInstance)({instance:t})}return r},function(e){var t=e.entityType,r=e.entity,a=e.host,n=e.exportHost,i=e.deref,o=e.extension,s=void 0===o?"json":o,u=e.path,d=c.default.get(r,"urls.export");if(d)return u&&(d+="#/"+u),d;var l=r.orgSlug||r.orgId,f=n||(0,p.getConfigVar)("SL_EXPORT_HOST");d=f?f+"/"+l+"/"+t+"/"+r.slug+"."+s:(a||(0,p.getConfigVar)("SL_API_HOST"))+"/orgs/"+l+"/"+t+"/"+r.slug+"/export."+s;var m=[];return r.public||c.default.get(r,"acl.public")||!r.token||m.push("__token="+r.token),i&&m.push("__deref="+i),c.default.isEmpty(m)||(d+="?"+m.join("&")),u&&(d+="#/"+c.default.trim(u,"#/")),d});t.buildExportUrl=q;t.computeTreeData=function e(t,r){var a=r.data,n=r.currentPath,o=r.depth,u=void 0===o?0:o,f=r.treePath,p=r.pathname,m=r.editor,g=r.meta,h=void 0===g?{}:g,v=[];for(var y in t){(function(o){var g=f.concat([o]),y=g.join("/"),I=(0,d.route)(m.contentRouter,g)||{},b=I.sidebarOptions,_=void 0===b?{}:b,w=c.default.isEmpty(t[o])||c.default.isNull(t[o])||c.default.isUndefined(t[o]);if(!Object.prototype.hasOwnProperty.call(t,o))return"continue";var S=_.childLinkFactory,x=_.parseChildren,E=!c.default.isEmpty(n)&&c.default.isEqual(n,g),T=[];for(var P in n)g[P]===n[P]&&T.push(n[P]);var k=n.length>u+1&&c.default.isEqual(T,g),q=function(e){return e.preventDefault(),e.stopPropagation(),m.removePath(g),!1},O=c.default.has(a,g)&&!_.noDefaultActions?[{id:"remove",icon:"trash",type:"negative",onClick:q}]:[];_.actionsFactory&&(O=[].concat((0,s.default)(_.actionsFactory(o,t[o],r)),(0,s.default)(O)));var R=w&&u<1,A={token:_.tokenFactory?_.tokenFactory(o,t[o],r):null,name:_.nameFactory?_.nameFactory(o,t[o],r):o,icon:_.icon,isActive:!S&&E,isMuted:R,childActive:k,openByDefault:_.openByDefault,meta:h[y],actions:O};if(x){var $=t[o];c.default.isArray(x)&&($=c.default.pick($,x)),A.children=e($,{data:a,currentPath:n,depth:u+1,treePath:g,pathname:p,editor:m,meta:h,openByDefault:_.openByDefault,actions:R?[]:[{id:"remove",icon:"trash",type:"negative",onClick:q}]})}!_.linkable&&x||(A.href=""+p+(0,l.pathToHash)({path:g})),S&&(A.children=A.children||[],A.children.unshift((0,i.default)({},S(o,t[o],r),{href:""+p+(0,l.pathToHash)({path:g}),isActive:E}))),A.isMuted&&A.items||v.push(A)})(y)}return v},t.getAllowedConnections=function(e,t){var r={specs:{outbound:["specs","instances"],inbound:["specs","collections","instances"]},collections:{outbound:["specs"],inbound:["specs"]},instances:{outbound:["specs","collections"],inbound:["specs"]},hub:{outbound:["specs","collections","instances"],inbound:[]}};return c.default.get(r,[t,e],[])}},function(e,t){e.exports=require("@stoplight/feathers-mongoose")},function(e,t){e.exports=require("meteor-random")},function(e,t,r){"use strict";var a=r(0),n=r(3);t.generateSlug=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){var r=e.prop||"slug";return n.uniquePropByService({prop:r,value:a.get(t,["data",e.target],""),blacklist:e.blacklist,query:e.query?e.query(t):{},service:t.service}).then(function(e){return a.set(t,["data",r],e),t})}},t.addOwner=function(){return function(e){var t=a.get(e,"params.user._id");return t&&a.set(e,"data.owner",t),e}};var i=function(e,t,r){return a.get(e,t)&&r.hasOwnProperty(e[t])?a.merge({},e,a.get(r,e[t])):e};t.extendWith=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"_id";return function(t){if(a.isEmpty(t.params.extendWith))return t;var r=t.result,n=t.params.extendWith;return r&&(r.data instanceof Array?t.result.data=a.map(r.data,function(t){return i(t,e,n)}):r instanceof Array?t.result=a.map(r,function(t){return i(t,e,n)}):t.result=i(t.result,e,n)),t}}},function(e,t,r){"use strict";var a=r(0),n=function(e,t,r){return e.service.Model&&(e.service.Model.addVirtuals?t=e.service.Model.addVirtuals(e,t,r):console.warn(e.service.Model.modelName+" must implement a static addVirtuals method to use the virtuals hook.")),r.addVirtuals?r.addVirtuals(e,t,r):t};e.exports={add:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){if(t.params.noVirtuals)return t;var r=t.result,i=a.get(t,"params.query._id.$in",[]);return a.isEmpty(r)||(r.data instanceof Array?t.result.data=a.map(r.data,function(r){return a.includes(i,r._id),n(t,r,e)}):r instanceof Array?t.result=a.map(r,function(r){return a.includes(i,r._id),n(t,r,e)}):t.result=n(t,t.result,e)),t}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getConfigVar=void 0;var a=r(0);t.getConfigVar=function(e){return"undefined"!=typeof Meteor?(0,a.get)(Meteor,["settings","public",e])||(0,a.get)(CONFIG,e):"undefined"!=typeof CONFIG?(0,a.get)(CONFIG,e):"undefined"!=typeof process?(0,a.get)(process.CONFIG,e)||(0,a.get)(process.env,e):null}},function(e,t){e.exports=require("babel-runtime/helpers/typeof")},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t){e.exports=require("shortid")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(14),n=function(e){e.add({_id:{type:String}}),e.pre("save",function(e){this.isNew&&!this._id&&(this._id=a.id()),e()})};t.default=n},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=r(56),i=a(n),o=r(57),s=a(o),u=r(58),c=a(u),d=r(21),l=a(d);t.default={connections:i.default,entity:s.default,errors:c.default,global:l.default}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.anonCollection=t.todosExample=t.githubExample=t.validateCollection=t.cleanCollection=t.cleanScenario=t.cleanStep=t.computeAllScenarios=t.flattenRefOutput=t.prepareCollectionRun=t.prepareScenarioRun=t.prepareStepRun=t.newScenario=t.scenarioName=t.newStep=t.stepToken=t.stepName=t.stepResultMeta=t.assertionsPassed=t.splitLogicPath=t.scenarioPathLocations=void 0;var n=r(5),i=a(n),o=r(31),s=a(o),u=r(7),c=a(u),d=r(2),l=a(d),f=r(0),p=a(f),m=r(20),g=a(m),h=r(25),v=a(h),y=r(103),I=t.scenarioPathLocations=["before","scenarios","after","utilities"],b=(t.splitLogicPath=function(e){var t=e.locations,r=void 0===t?[]:t,a=e.path,n=void 0===a?"":a,i={location:"",path:n};if(!(r&&r instanceof Array))return i;var o=n.match(new RegExp(""+r.join("|").replace(/\$/g,"\\$")));return o&&(i.location=o[0],i.path=p.default.trimStart(i.path.replace(i.location,""),".")),i},t.assertionsPassed=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.assertions,r=void 0===t?[]:t,a=!0,n=!0,i=!1,o=void 0;try{for(var s,u=(0,l.default)(r);!(n=(s=u.next()).done);n=!0){var c=s.value;if(!p.default.get(c,"result.pass")){a=!1;break}}}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return a},t.stepResultMeta=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.stepResult,r={className:"is-plain",type:"plain",code:2,status:"not run"};return p.default.isEmpty(t)?r:(r.status=p.default.get(t,"output.status")||"run",p.default.gt(t.failCount,0)?(r.type="negative",r.code=0):p.default.gt(t.passCount,0)&&(r.type="positive",r.code=1),r.className="is-"+r.type,r)},t.stepName=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.skipToken,a=t.mappedScenarioNames,n=e||{},i=n.name;if(p.default.isEmpty(i))switch(n.type){case"http":i=r?p.default.get(n,"input.url")||"!emptyUrl!":p.default.get(n,"input.method","GET").toUpperCase()+" "+(p.default.get(n,"input.url")||"!emptyUrl!");break;case"ref":var o=p.default.get(n,"input.name",""),s=p.default.get(n,"input.$ref",""),u=p.default.last(s.split("/"));i=p.default.get(a,u),p.default.isEmpty(i)&&(i=p.default.isEmpty(o)?s||"!emptyRef!":o+" ["+s+"]");break;default:i=n.name||"Un-named"}return i},t.stepToken=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.maxLength,a=void 0===r?999:r,n=e||{},i={name:null,icon:null,className:""};switch(n.type){case"http":var o=p.default.get(n,"input.method","get");i.name=o.substring(0,a),i.className="sl-"+o+"-color";break;case"ref":i.name="REF",i.className="sl-ref-color";break;case"script":i.name="SCRIPT",i.className="sl-script-color"}return i},t.newStep=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,r=e.name,a=e.input,n=e.before,i=e.after,o={id:g.default.generate().substring(0,4).toLowerCase(),type:t||"http",name:r||"",input:a||{method:"get",url:""}};return n&&(o.before=n),i&&(o.after=i),o}),_=(t.scenarioName=function(e){return e?e.hasOwnProperty("$ref")?e.$ref?e.$ref:"Invalid scenario ref.":e.name||"No name.":"Error: undefined scenario."},t.newScenario=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,r=e.steps;return{name:t||"New Scenario",steps:r||[b()]}},t.prepareStepRun=function(e){var t=e.step,r=e.specs,a=(e.variables,p.default.get(t,"after.assertions",[]));return p.default.isEmpty(r)||p.default.isEmpty(a)?t:(0,c.default)({},t)}),w=t.prepareScenarioRun=function(e){var t=e.scenario,r=e.specs,a=e.variables;if(p.default.isEmpty(r))return t;var n=[],i=!0,o=!1,s=void 0;try{for(var u,d=(0,l.default)(t.steps);!(i=(u=d.next()).done);i=!0){var f=u.value;n.push(_({step:f,specs:r,variables:a}))}}catch(e){o=!0,s=e}finally{try{!i&&d.return&&d.return()}finally{if(o)throw s}}return(0,c.default)({},t,{steps:n})},S=(t.prepareCollectionRun=function(e){var t=e.collection,r=e.specs,a=e.variables;if(p.default.isEmpty(r))return t;var n=[],i=!0,o=!1,s=void 0;try{for(var u,d=(0,l.default)(t.data.scenarios);!(i=(u=d.next()).done);i=!0){var f=u.value;n.push(w({scenario:f,specs:r,variables:a}))}}catch(e){o=!0,s=e}finally{try{!i&&d.return&&d.return()}finally{if(o)throw s}}return(0,c.default)({},t,{scenarios:n})},function e(t){var r=p.default.get(t,"input.spec.steps"),a=p.default.get(t,"output.steps");if(p.default.isEmpty(a)||p.default.isEmpty(r))return[];var n=[],i=!0,o=!1,s=void 0;try{for(var u,c=(0,l.default)(r);!(i=(u=c.next()).done);i=!0){var d=u.value,f=a[d.id];"ref"!==d.type?n.push(f):n=n.concat(e(f))}}catch(e){o=!0,s=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw s}}return n}),x=(t.flattenRefOutput=function(e){if(!p.default.isEmpty(e)){var t=[];for(var r in e)if(p.default.has(e,r)){var a=e[r];"ref"===a.type?t=t.concat(S(a)):t.push(a)}return t}},t.computeAllScenarios=function(e){var t=e.collection,r=void 0===t?{}:t,a=[],n=!0,i=!1,o=void 0;try{for(var s,u=(0,l.default)(I);!(n=(s=u.next()).done);n=!0){var c=s.value;a=a.concat(p.default.values(p.default.get(r,c,{})))}}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return a}),E=t.cleanStep=function(e){var t=e.step,r=void 0===t?{}:t;return r=p.default.pick(r,["id","type","name","description","input","before","after"])},T=t.cleanScenario=function(e){var t=e.scenario,r=void 0===t?{}:t;r=p.default.pick(r,["id","name","description","steps"]),r.steps=r.steps||[];for(var a in r.steps)Object.prototype.hasOwnProperty.call(r.steps,a)&&(r.steps[a]=E({step:r.steps[a]}));return r},P=(t.cleanCollection=function(e){var t=e.collection,r=void 0===t?{}:t;r=p.default.cloneDeep(p.default.pick(r,["scenarioVersion","description","before","scenarios","after","utilities"]));var a=!0,n=!1,i=void 0;try{for(var o,u=(0,l.default)(I);!(a=(o=u.next()).done);a=!0){var c=o.value,d=p.default.get(r,c,[]);for(var f in d)if(Object.prototype.hasOwnProperty.call(d,f)){var m=[].concat((0,s.default)(c.split(".")),[f]);p.default.set(r,m,T({scenario:p.default.get(r,m)}))}}}catch(e){n=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(n)throw i}}return r},t.validateCollection=function(e){var t=e.collection,r=void 0===t?{}:t,a={errors:[],warnings:[]};return new i.default(function(e){(0,y.validator)(r).then(function(){var t=x({collection:r});for(var n in t){var i=t[n],o=[],s=[],u=i.steps||[],c=!0,d=!1,f=void 0;try{for(var m,g=(0,l.default)(u);!(c=(m=g.next()).done);c=!0){var h=m.value;if(p.default.includes(o,h.id)&&!p.default.includes(s,h.id)){var v=p.default.filter(u,{id:h.id}),y=p.default.map(v,"name");a.errors.push({code:"SCENARIO_STEP_UNIQUE_ID",message:i.name+" ("+n+"): The following steps have the same id ("+h.id+"): "+y.join(", "),description:"This can cause a bunch of issues. To fix it, navigate to the scenario, open up the code editor pane, and manually update the step ids to be different."})}o.push(h.id)}}catch(e){d=!0,f=e}finally{try{!c&&g.return&&g.return()}finally{if(d)throw f}}}e(a)}).catch(function(t){if(t instanceof v.default.ValidationError){if(t.errors){var r=!0,n=!1,i=void 0;try{for(var o,s=(0,l.default)(t.errors);!(r=(o=s.next()).done);r=!0){var u=o.value;a.errors.push((0,c.default)({code:"VALIDATION_ERROR"},u,{inner:u}))}}catch(t){n=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}}}else a.errors.push({code:"VALIDATION_ERROR",message:String(t)});e(a)})})},t.githubExample={name:"Github Gists",description:"This 2 step example scenario demonstrates how to fetch a list of gists (step 1), save the id of the first one, and use that id to fetch the gist details (step 2).\nClick the **Run Scenario** button above to run it, click the steps below or on the left to explore how it's put together.\nThe Github API has rate limits, so this scenario will sometimes fail if those limits have been reached!",steps:[{id:"listGists",type:"http",name:"List Gists",input:{url:"https://api.github.com/gists",method:"get"},after:{assertions:[{target:"output.status",op:"eq",expected:200}],transforms:[{target:"$.ctx.gistId",source:"output.body[0].id"}]}},{id:"getGist",type:"http",name:"Get Gist",input:{method:"get",url:"https://api.github.com/gists/{$.ctx.gistId}"},after:{assertions:[{target:"output.body.id",op:"eq",expected:"{$.ctx.gistId}"}]}}]}),k=t.todosExample={name:"Todos API Crud",description:'This scenario sends 4 HTTP requests to the Stoplight Todos demo API, which is hosted at http://todos.stoplight.io.\nBefore running it, you **must** set the todos-apikey environment variable below! Set it to "123" - very secure API, we know :).\nOf note in this scenario is the usage of the $.ctx.todoId variable. This variable is set in the capture section of the first step, "Create Todo".',steps:[{id:"createTodo",type:"http",name:"Create Todo",input:{method:"post",url:"http://todos.stoplight.io/todos?apikey={$$.env.todos-apikey}",body:{name:"demo todo",completed:!1},headers:{"Content-Type":"application/json"}},after:{assertions:[{target:"output.status",op:"eq",expected:201}],transforms:[{target:"$.ctx.todoId",source:"output.body.id"}]}},{id:"getTodo",type:"http",name:"Get Todo",input:{method:"get",url:"http://todos.stoplight.io/todos/{$.ctx.todoId}"},after:{assertions:[{target:"output.status",op:"eq",expected:200}]}},{id:"updateTodo",type:"http",name:"Update Todo",input:{method:"put",url:"http://todos.stoplight.io/todos/{$.ctx.todoId}?apikey={$$.env.todos-apikey}",body:{completed:!0},headers:{"Content-Type":"application/json"}},after:{assertions:[{target:"output.status",op:"eq",expected:200},{target:"output.body.completed",op:"eq",expected:!0}]}},{id:"deleteTodo",type:"http",name:"Delete Todo",input:{method:"delete",url:"http://todos.stoplight.io/todos/{$.ctx.todoId}?apikey={$$.env.todos-apikey}"},after:{assertions:[{target:"output.status",op:"eq",expected:204}]}}]};t.anonCollection={_id:"scenario-editor",id:"scenario-editor",name:"Example Scenario Collection",description:'Welcome! Use scenarios to test, automate, and mashup web APIs. \n\nWe\'ve included some example scenarios on the left, but feel free to explore and add your own scenarios by clicking the "New Scenario" button above.\n\n**If you like what you see, click the "Register" button above to create a free account and unlock all sorts of extra features!**',scenarios:[P,k]}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getAllParams=t.extractParams=t.getAnchorQs=t.getSearchQs=t.getAnchorSearch=t.buildPathParts=t.cleanSlashes=t.createURL=void 0;var n=r(18),i=a(n),o=r(0),s=a(o),u=r(156),c=a(u),d=r(149),l=a(d),f=(t.createURL=function(e,t){var r={};if("function"==typeof URL)try{r=new URL(e)}catch(a){try{r=new URL(""+t+e)}catch(e){return{}}}else if("undefined"!==(void 0===c.default?"undefined":(0,i.default)(c.default)))try{r=c.default.parse(e)}catch(a){try{r=c.default.parse(""+t+e)}catch(e){return{}}}else"undefined"!==("undefined"==typeof document?"undefined":(0,i.default)(document))&&(r=document.createElement("a"),r.href=e);return r={hash:r.hash,host:r.host,hostname:r.hostname,href:r.href,origin:r.origin,password:r.password,pathname:"blank"===r.pathname?"":r.pathname,port:r.port,protocol:r.protocol,search:r.search,searchParams:r.searchParams,username:r.username},r.href&&(r.href=r.href.replace("%7B","{").replace("%7D","}")),r.pathname&&(r.pathname=r.pathname.replace("%7B","{").replace("%7D","}")),r},t.cleanSlashes=function(e){var t=s.default.trimEnd(e,"/");return""!==t&&t?"/"!==t&&"/"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)):t="/",t},t.buildPathParts=function(e,t){var r=[],a=t?e.replace(t,""):e,n=a.split("/");n.length&&""===n[0]&&n.shift();for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var o=n[i];if(o.match(/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/g))r.push(o);else if(i===n.length-1){var s=o.split(".");s.length>1?(""===s[0]&&s.shift(),r.push(s[0]),s.shift(),r.push(s.join("."))):r.push(o)}else r.push(o)}return r},t.getAnchorSearch=function(e){var t=e.anchor||"",r=t.split("?");return r.length>1?r[1]:null}),p=t.getSearchQs=function(e){var t=e.search||"",r=t.replace("?","");return r?l.default.parse(r):{}},m=t.getAnchorQs=function(e){var t=f(e);return t?l.default.parse(t):{}};t.extractParams=function(e){for(var t=[],r=/{([^}]+)}/g,a=r.exec(e);null!=a;)t.push(a[1]),a=r.exec(e);return t},t.getAllParams=function(e){return s.default.merge({},m(e),p(e))}},function(e,t){e.exports=require("ajv")},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.dereference=t.dereferenceLocal=void 0;var n=r(5),i=a(n),o=r(18),s=a(o),u=r(0),c=a(u),d=r(154),l=a(d),f=r(12),p=r(1),m=r(24),g=r(125),h=a(g),v=new h.default({storage:"session",defaultExpiration:60}),y=r(155)(v),I=function e(t,r,a){if(t.$ref){if(c.default.startsWith(t.$ref,"#/")){if(!a.local[t.$ref]){var n=c.default.trimStart(t.$ref,"#/").split("/");a.local[t.$ref]={localPath:n,referencedFrom:[]}}return void a.local[t.$ref].referencedFrom.push(r)}try{if(!a.remote[t.$ref]){var i=(0,m.createURL)(t.$ref),o=i.protocol+"//"+i.host+i.pathname+(i.search||""),u=c.default.trimStart(i.hash,"#/").split("/");a.urls[o]||(a.urls[o]=null),a.remote[t.$ref]={url:o,localPath:u,referencedFrom:[]}}return void a.remote[t.$ref].referencedFrom.push(r)}catch(e){return void console.error("utils/dereference:findRefs",e)}}c.default.forEach(t,function(t,n){t&&"object"===(void 0===t?"undefined":(0,s.default)(t))&&e(t,r.concat(n),a)})},b=function(e,t){var r={urls:{},local:{},remote:{}};return t&&c.default.forEach(t,function(e,t){r.urls[t]=e}),e&&e.$ref?I(e,[],r):c.default.forEach(e,function(e,t){e&&"object"===(void 0===e?"undefined":(0,s.default)(e))&&I(e,[t],r)}),r},_=t.dereferenceLocal=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.refMap,a=t.isParsed,n=e;return a||(n=(0,p.safeParse)((0,p.safeStringify)(e),e),!c.default.isEmpty(n)&&c.default.isObject(n))?(c.default.isEmpty(r)&&(r=b(n)),c.default.times(2,function(){c.default.forEach(r.local,function(e,t){c.default.forEach(e.referencedFrom,function(t){c.default.isEmpty(t)?n=c.default.get(n,e.localPath):c.default.set(n,t,c.default.get(n,e.localPath))})})}),n):n};t.dereference=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.remote,a=void 0===r||r,n=t.local,o=t.detailed,s=t.remoteData,u=void 0===s?{}:s;return new i.default(function(t){var r=(0,p.safeParse)((0,p.safeStringify)(e),e);if(c.default.isEmpty(r)||!c.default.isObject(r))return t(r);var s=b(r,c.default.cloneDeep(u)),d=[],m={},g={};return c.default.forEach(s.urls,function(e,t){if(e)m[t]=e;else{var r=new i.default(function(e){l.default.get(t).use(y).end(function(r,a){r?g[t]=r:m[t]=a?a.body:{},e()})});d.push(r)}}),n&&(r=_(r,{refMap:s,isParsed:!0})),a?i.default.all(d).then(function(){return c.default.forEach(s.remote,function(e,t){if(g[e.url])c.default.forEach(e.referencedFrom,function(a){c.default.isEmpty(a)?r={$ref:t,__error:g[e.url].code||"ERR_LOADING_REF"}:c.default.set(r,a,{$ref:t,__error:g[e.url].code||"ERR_LOADING_REF"})});else{var a=m[e.url],n=c.default.get(a,e.localPath);c.default.isEmpty(n)&&(n={$ref:t,__error:"REF_PATH_DOES_NOT_EXIST"}),c.default.forEach(e.referencedFrom,function(e){c.default.isEmpty(e)?(r=n,o&&(r.__inheritedFrom={name:(0,f.exportUrlToSrn)({url:t})})):(c.default.set(r,e,n),o&&c.default.set(r,e.concat("__inheritedFrom"),{name:(0,f.exportUrlToSrn)({url:t})}))})}}),t((0,p.safeParse)((0,p.safeStringify)(r)))}).catch(function(e){console.error("utils/dereference:dereference",e)}):t((0,p.safeParse)((0,p.safeStringify)(r)))})}},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/helpers/defineProperty")},function(e,t){e.exports=require("babel-runtime/helpers/slicedToArray")},function(e,t){e.exports=require("babel-runtime/helpers/toConsumableArray")},function(e,t){e.exports=require("feathers")},function(e,t){e.exports=require("js-yaml/dist/js-yaml")},function(e,t){e.exports=require("json-schema-generator")},function(e,t,r){"use strict";var a=r(5),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(0),o=r(37);e.exports={hooks:{sendEnrollmentEmail:function(){return function(e){var t=i.get(e,"params.enrollUsers");if(i.isEmpty(t)||!e.app.service("mailer"))return e;var r=t.map(function(t){return e.app.service("mailer").create(o.enrollAccount({email:t.email,token:t.token,name:i.get(e,"params.user.profile.name")||"Your colleague",org:i.get(e,"params.org",{})}))});return n.default.all(r).then(function(){return e}).catch(function(t){return console.error("sendEnrollmentEmail",t),e})}},sendOrgMemberEmail:function(){return function(e){var t=i.get(e,"params.existingUsers");if(i.isEmpty(t)||!e.app.service("mailer"))return e;var r=t.map(function(t){return e.app.service("mailer").create(o.addOrgMember({email:t.email,toName:t.name,fromName:i.get(e,"params.user.profile.name")||"Your colleague",org:i.get(e,"params.org",{})}))});return n.default.all(r).then(function(){return e}).catch(function(t){return console.error("sendOrgMemberEmail",t),e})}},sendVerificationEmail:function(){return function(e){var t=e.data;return i.isEmpty(t)||e.params.skipEmail||!e.app.service("mailer")?e:e.app.service("mailer").create(o.createAccount({email:i.get(t,"emails[0].address"),verifyToken:t.verifyToken})).then(function(){return e}).catch(function(t){return console.error("sendVerificationEmail",t),e})}}}}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(44),i=a(n),o=r(45),s=a(o),u=r(0),c=r(121),d=r(129),l=r(6);r(122).promisifyAll(c);var f=function(){function e(){(0,i.default)(this,e)}return(0,s.default)(e,null,[{key:"sha256",value:function(e){return d.createHash("sha256").update(e).digest("hex")}},{key:"getPasswordString",value:function(e){if("string"==typeof e)e=this.sha256(e);else{if("sha-256"!==e.algorithm)throw new Error("Invalid password hash algorithm. Only 'sha-256' is allowed.");e=e.digest}return e}},{key:"hashPassword",value:function(e){return e=this.getPasswordString(e),c.hashAsync(e,10)}},{key:"comparePassword",value:function(e,t){return!(!(e=this.getPasswordString(e))||!t)&&c.compareAsync(e,t)}}]),e}();e.exports={Password:f,hashPassword:function(){return function(e){var t=e.data,r=t.password;if(u.isEmpty(r)||r.length<6)throw new l.BadRequest("Your password must be at least 6 characters long.",{password:r});return f.hashPassword(r).then(function(r){return u.get(e,"params.user")||u.set(t,"emails[0]",{address:t.email}),u.set(t,"services.password.bcrypt",r),e})}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=process.env.SL_APP_HOST||"http://localhost:3100",n="\nIf you have any questions, just hit reply on this email.\n\nHappy designing,\nThe Stoplight Team\n\n"+a+"\n\nIf you received this email in error, please reply and we'll fix the issue.\n";t.enrollAccount=function(e){var t=e.email,r=e.token,i=e.name,o=void 0===i?"":i,s=e.org;return{from:"Stoplight Accounts <hi@stoplight.io>",to:t,replyTo:"Stoplight Support <support@stoplight.io>",subject:o+" invites you to collaborate on an API",text:"Hi there,\n\n"+o+" is using the Stoplight API Designer, and\nhas invited you to collaborate in their organization, "+((void 0===s?{}:s).name||"")+".\n\nWe have created an account for you - click the link below to complete the process:\n\n"+a+"/reset-password/"+r+"\n\n"+n}},t.addOrgMember=function(e){var t=e.email,r=e.toName,i=e.fromName,o=e.org,s=void 0===o?{}:o;return{from:"Stoplight Accounts <hi@stoplight.io>",to:t,replyTo:"Stoplight Support <support@stoplight.io>",subject:"You've been added to an Organization",text:"Hey "+(r||"there")+",\n\n"+i+" has added you as a member to their organization, "+(s.name||"")+".\n\nYou can access it now at "+a+"/"+(s.slug||"")+".\n\n"+n}},t.createAccount=function(e){var t=e.email,r=e.verifyToken;return{from:"Stoplight Accounts <hi@stoplight.io>",to:t,replyTo:"Stoplight Support <support@stoplight.io>",subject:"Welcome to Stoplight",text:"Thanks for joining!\n\nPlease take a moment to verify your account by clicking on the link below.\n\n"+a+"/verify-email/"+r+"\n\n"+n}},t.resetPassword=function(e){var t=e.email,r=e.name,i=e.resetToken;return{from:"Stoplight Accounts <hi@stoplight.io>",to:t,replyTo:"Stoplight Support <support@stoplight.io>",subject:"How to reset your password on stoplight.io",text:"Hello "+(r||"There")+",\n\nTo reset your password, simply click the link below.\n\n"+a+"/reset-password/"+i+"\n\n"+n}}},function(e,t,r){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.migrateCollection=t.latestVersion=void 0;var i=r(2),o=n(i),s=r(0),u=n(s),c=r(104),d=a(c),l=r(105),f=a(l),p=r(23),m=(t.latestVersion="1.1",{"1.0":d,1.1:f}),g=function(e){var t=e.collection,r=e.version,a=e.migration,n=u.default.cloneDeep(t);n.scenarioVersion=r,n=a.migrateCollection({collection:n});var i=!0,s=!1,c=void 0;try{for(var d,l=(0,o.default)(p.scenarioPathLocations);!(i=(d=l.next()).done);i=!0){var f=d.value;for(var m in n[f]){n[f][m]=a.migrateScenario({scenario:n[f][m]});for(var g in n[f][m].steps){n[f][m].steps[g]=a.migrateStep({step:n[f][m].steps[g]});var h=u.default.get(n[f][m].steps[g],"before.script");h&&u.default.set(n[f][m].steps[g],"before.script",a.migrateScript({script:h}));var v=u.default.get(n[f][m].steps[g],"input.script");v&&u.default.set(n[f][m].steps[g],"input.script",a.migrateScript({script:v}));var y=u.default.get(n[f][m].steps[g],"after.script");y&&u.default.set(n[f][m].steps[g],"after.script",a.migrateScript({script:y}))}}}}catch(e){s=!0,c=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw c}}return{collection:n,notes:a.notes}};t.migrateCollection=function(e){var t=e.collection,r=e.withNotes,a=void 0===r||r;if(u.default.isEmpty(t))return{collection:t};var n=t.scenarioVersion,i=0;n&&(i=u.default.indexOf(u.default.keys(m),n))<0&&(i=0);var o=t,s={},c=u.default.keys(m);for(var d in c)if(d>i){var l=g({collection:o,version:c[d],migration:m[c[d]]});o=l.collection,s[c[d]]=l.notes}var f={collection:o};return a&&(f.notes=s),f}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e){this.name="MissingArgumentError",this.message=e||"Argument is missing.",this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.checkArgs=t.emailRegex=t.keyArrangeDeep=t.keyArrange=t.keyArrangeSortByArray=t.omitByRecursively=t.renameObjectKey=t.sortObjectKeys=t.pruneObject=t.isValidJSON=t.combinePathSelectors=t.simpleSlugify=void 0;var i=r(31),o=a(i),s=r(19),u=a(s),c=r(28),d=a(c),l=r(18),f=a(l),p=r(2),m=a(p),g=r(0),h=a(g),v=r(17),y=(t.simpleSlugify=function(e){var t=e;if(!t)return t;t=t.replace(/^\s+|\s+$/g,""),t=t.toLowerCase();for(var r="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",a="aaaaeeeeiiiioooouuuunc------",n=0,i=r.length;n<i;n++)t=t.replace(new RegExp(r.charAt(n),"g"),a.charAt(n));return t=t.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},t.combinePathSelectors=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t="",r=!0,a=!1,n=void 0;try{for(var i,o=(0,m.default)(e);!(r=(i=o.next()).done);r=!0){var s=i.value,u=s.trim();u&&(t=""===t?u:"["===u.charAt(0)?""+t+u:t+"."+u)}}catch(e){a=!0,n=e}finally{try{!r&&o.return&&o.return()}finally{if(a)throw n}}return t},t.isValidJSON=function(e){try{var t=void 0;return"object"===(void 0===e?"undefined":(0,f.default)(e))&&(t=(0,d.default)(e)),JSON.parse(t),!0}catch(e){return!1}},t.pruneObject=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t instanceof Array)return t.length?[e(t[0],r+1)]:[];if(t instanceof Object)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(t[a]=e(t[a],r+1));else if(0===r)try{t=JSON.parse(t),t=(0,d.default)(e(t,r+1))}catch(e){}return t},t.sortObjectKeys=function(e,t){var r=e||{},a={},n=t;n||(n=(0,u.default)(e).sort());var i=!0,s=!1,c=void 0;try{for(var d,l=(0,m.default)(n);!(i=(d=l.next()).done);i=!0){var f=d.value;a[f]=r[f]}}catch(e){s=!0,c=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw c}}var p=h.default.without.apply(h.default,[(0,u.default)(r)].concat((0,o.default)(n))),g=!0,v=!1,y=void 0;try{for(var I,b=(0,m.default)(p);!(g=(I=b.next()).done);g=!0){var _=I.value;a[_]=r[_]}}catch(e){v=!0,y=e}finally{try{!g&&b.return&&b.return()}finally{if(v)throw y}}return a},t.renameObjectKey=function(e,t,r){if(!e||!e[t]||t===r)return e;var a=[];for(var n in e)n!==r&&a.push({name:n===t?r:n,value:e[n]});var i={},o=!0,s=!1,u=void 0;try{for(var c,d=(0,m.default)(a);!(o=(c=d.next()).done);o=!0){var l=c.value;i[l.name]=l.value}}catch(e){s=!0,u=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw u}}return i},t.omitByRecursively=function e(t,r){var a=t instanceof Array;for(var n in t)r(t[n],n)?a?h.default.pullAt(t,n):delete t[n]:"object"===(0,f.default)(t[n])&&(e(t[n],r),h.default.isEmpty(t[n])&&delete t[n]);return t},t.keyArrangeSortByArray=function(e){return function(t,r){var a=h.default.indexOf(e,t),n=h.default.indexOf(e,r);return a===n?t>r?1:t<r?-1:0:-1===n||-1!==a&&a<n?-1:1}},t.keyArrange=function(e,t,r){var a={};return(0,u.default)(e).sort(t?function(e,a){return t(e,a,r)}:void 0).forEach(function(t){a[t]=e[t]}),a});t.keyArrangeDeep=function e(t,r,a,n,i){if(a&&i&&i>=a)return t;if(h.default.isArray(t))return h.default.map(t,function(t){return e(t,r,n)});if(h.default.isObject(t)){var o=y(t,r,n);return h.default.forEach(o,function(t,a){o[a]=e(t,r,n,i+1)}),o}return t},t.emailRegex=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,t.checkArgs=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];if("production"!==(0,v.getConfigVar)("ENV"))for(var a in t)if(t.hasOwnProperty(a)&&h.default.isUndefined(t[a])){var i=new n("You must specify <"+a+"> when calling the "+e+" method.");if(r)throw i;console.error(i)}}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.buildHash=t.hashToPath=t.pathToHash=t.buildQueryParams=t.buildParams=void 0;var n=r(7),i=a(n),o=r(0),s=a(o),u=r(49),c=a(u),d=t.buildParams=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.preserve,n=void 0===a||a,i={},o=e.search?c.default.parse(e.search.slice(1)):{};return n&&(i=o),s.default.merge(i,t),s.default.omitBy(i,s.default.isNull)};t.buildQueryParams=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.pathname||s.default.get(window,"location.pathname"),a=d(window.location,e,(0,i.default)({preserve:!0},t));return s.default.isEmpty(a)||(r+="?"+c.default.stringify(a)),r},t.pathToHash=function(e){var t=e.path,r=e.noSign,a=s.default.map(s.default.cloneDeep(s.default.toPath(t||[])),function(e){return e.replace(/\//g,"~1")}),n="/"+a.join("/");return s.default.startsWith(n,"#")||r||(n="#"+n),n},t.hashToPath=function(e){var t=e.hash;return s.default.compact(s.default.map(s.default.trim(t,"#/").split("/"),function(e){return e.replace(/~1/g,"/")}))},t.buildHash=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.pathname||s.default.get(window,"location.pathname"),a=e;return s.default.startsWith(e,"#")||t.noSign||s.default.isEmpty(e)||(a="#"+e),""+r+a}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.schemaMerger=t.markFieldsRequired=t.resolveSchema=t.publicJSON=t.findSchemaByRef=t.findPropertyByRef=t.uniqueByNamespace=t.dereferenceSchema=t.extendSchema=t.buildExampleFromSchema=t.fakeExampleFromSchema=t.parseYamlOrJson=t.isValidJSON=t.isSchemaEmpty=t.emptyJsonSchema=t.emptySchema=t.Transformer=void 0;var a=r(113),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(112);t.Transformer=n.default,t.emptySchema=i.emptySchema,t.emptyJsonSchema=i.emptyJsonSchema,t.isSchemaEmpty=i.isSchemaEmpty,t.isValidJSON=i.isValidJSON,t.parseYamlOrJson=i.parseYamlOrJson,t.fakeExampleFromSchema=i.fakeExampleFromSchema,t.buildExampleFromSchema=i.buildExampleFromSchema,t.extendSchema=i.extendSchema,t.dereferenceSchema=i.dereferenceSchema,t.uniqueByNamespace=i.uniqueByNamespace,t.findPropertyByRef=i.findPropertyByRef,t.findSchemaByRef=i.findSchemaByRef,t.publicJSON=i.publicJSON,t.resolveSchema=i.resolveSchema,t.markFieldsRequired=i.markFieldsRequired,t.schemaMerger=i.schemaMerger},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.cleanSpec=t.createStepFromOperation=t.getEndpointFromSpec=t.computeUpdatesFromCollectionResult=t.getEndpointsFromSpec=t.computeNewResource=t.computeNewPath=t.computePathParamsFromUri=t.parseDynamicParams=void 0;var n=r(0),i=a(n),o=r(50),s=a(o),u=r(114);t.parseDynamicParams=function(e){var t=e.url,r=t,a=void 0;try{r=new s.default(t),a=r.pathname}catch(e){return a=t,t}if(!a)return t;var n=1,o=a.split("/"),u=[];for(var c in o)if(Object.prototype.hasOwnProperty.call(o,c)){var d=!o[c+1],l=o[c],f=l,p=void 0,m=n>1?"{id"+n+"}":"{id}";!l.match(/@/)&&d&&(l=l.split("."),l.length>1?(p=i.default.last(l),l=l.slice(0,-1).join(".")):l=l[0]),l.match(/^[0-9]+$/)&&(f=m),l.match(/@/)&&(f="{email}"),p&&(f+=".{extension}"),f!==l&&(n+=1),u.push(f)}return t.replace(a,u.join("/"))},t.computePathParamsFromUri=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(t.type,t.existingParams);return(0,u.computePathParamsFromUri)(e,{existingParams:r})},t.computeNewPath=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.type;return(0,u.computeNewPath)(e)},t.computeNewResource=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.type;return(0,u.computeNewResource)(e)},t.getEndpointsFromSpec=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.type;return(0,u.getEndpointsFromSpec)(e)},t.computeUpdatesFromCollectionResult=function(e){var t=e.spec,r=e.result,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.type;return(0,u.computeUpdatesFromCollectionResult)({spec:t,result:r})},t.getEndpointFromSpec=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.type;return(0,u.getEndpointFromSpec)(e)},t.createStepFromOperation=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.type;return(0,u.createStepFromOperation)(e)},t.cleanSpec=function(e){var t=e.spec;return void 0===t?{}:t}},function(e,t){e.exports=require("@stoplight/feathers-authentication-management")},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t){e.exports=require("babel-runtime/helpers/objectWithoutProperties")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("feathers-configuration")},function(e,t){e.exports=require("qs")},function(e,t){e.exports=require("url-parse")},function(e,t,r){"use strict";var a=r(126);a.option("-e, --env <path>","File path to a env file. Defaults to ../../env/api.env").parse(process.argv);var n=r(130);a.env?(console.log("Loading user .env file.",a.env),n.config({path:a.env})):(console.log("Loading default .env file."),n.config({path:"../../env/api.env"})),process.env.NEW_RELIC_LICENSE_KEY&&r(145);var i=r(32),o=r(48),s=r(52),u=i();u.configure(o()),u.use("/",s);var c=process.env.PORT||u.get("PORT"),d=process.env.HOST||"0.0.0.0";u.listen(c,d).on("listening",function(){console.log("Running api server at "+d+":"+c)})},function(e,t,r){"use strict";var a=r(147),n=r(32).static,i=r(151),o=r(127),s=r(128),u=r(32),c=r(48),d=r(137),l=r(139),f=r(123),p=r(140),m=r(54),g=r(75),h=u();h.configure(c()),process.CONFIG=c()(),h.use(o()).options("*",s()).use(s()).use(i(a.join(process.env.PUBLIC||h.get("PUBLIC")||"./public","favicon.ico"))).use("/",n(process.env.PUBLIC||h.get("PUBLIC")||"./public")).use(function(e,t,r){e.headers["content-type"]="application/json",r()}).use(f.json({limit:"50mb"})).use(f.urlencoded({limit:"50mb",extended:!0})).configure(d()).configure(l()).configure(p()).configure(g).configure(m),e.exports=h},function(e,t,r){"use strict";var a=r(124);e.exports=function(e){var t=process.env.BUGSNAG||e.get("BUGSNAG");t&&(a.register(t,{sendCode:!0,projectRoot:"../../src/api"}),e.use(a.requestHandler),e.use(a.errorHandler))}},function(e,t,r){"use strict";var a=r(135),n=r(136),i=r(55),o=r(53);e.exports=function(){var e=this;o(e),e.use(i(e)),e.use(n()),e.use(a())}},function(e,t,r){"use strict";var a=r(157);e.exports=function(e){return e.logger=a,function(e,t,r,n){if(e){var i=(e.code?"("+e.code+") ":"")+"Route: "+t.url+" - "+e.message;404===e.code?a.info(i):(a.error(i),a.info(e.stack))}n(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(8),n=a.Schema,i=(new n({entityId:{type:String,required:!0},orgId:{type:String,required:!0},entityType:{type:String,required:!0}},{_id:!1}),function(e){e.add({connections:{type:Array}})});t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(14),n=r(0),i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.add({name:{type:String,required:!0,default:t.name||""},sourceUrl:{type:String},public:{type:Boolean,default:!1},data:{type:String,default:t.data||"{}"},token:{type:String,default:function(){return a.id(9).toLowerCase()}},slug:{type:String,required:!0,minLength:3,default:function(){return a.id(3).toLowerCase()}},orgId:{type:String,required:!0},orgSlug:{type:String,required:!0}}),e.statics.filter=function(e,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=["_id","id","name","slug","orgId","orgSlug","token","urls","public"];return t.whitelist&&(i=i.concat(t.whitelist)),a.detailed&&(i=i.concat(["data","sourceUrl"])),e.params.connections&&i.push("connections"),e.params.user,n.pick(r,i)}};t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(7),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(0),o=r(8),s=function(e,t,r){if("MongoError"===e.name&&e.message.match("E11000")){var a=e.message.match(/index: ([.$a-zA-Z0-9]+)/);if(a&&a[1]){var s=new o.Error.ValidationError,u=a[1].trim().split("."),c=i.last(u).replace(/\$/,"");return s.errors[c]=i.merge(s.errors[c],(0,n.default)({},e,{kind:"duplicate",path:c,message:"should be unique."})),r(s)}}r()},u=function(e){e.post("save",s),e.post("update",s),e.post("findOneAndUpdate",s),e.post("insertMany",s)};t.default=u},function(e,t,r){"use strict";var a=r(9);t.before={all:[a.disallow("external")],find:[],get:[],create:[],update:[],patch:[],remove:[]},t.after={all:[],find:[],get:[],create:[],update:[],patch:[],remove:[]}},function(e,t,r){"use strict";var a=r(13),n=r(61),i=r(59);e.exports=function(){var e=this,t={Model:n,lean:!0,overwrite:!1,paginate:{default:100,max:500}};e.use("/acl",a(t));var r=e.service("/acl");r.before(i.before),r.after(i.after)}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(26),i=a(n),o=r(21),s=a(o),u=r(0),c=r(8),d=c.Schema,l=new d({aType:{type:String,required:!0,enum:["org-member","org-team","team-member","spec-member","collection-member","instance-member","hub-member","spec-team","collection-team","instance-team","hub-team","org-spec","org-collection","org-instance","org-hub","public-spec","public-collection","public-instance","public-hub"]},orgId:{type:String,required:!0},teamId:{type:String},userId:{type:String},eType:{type:String,enum:["org","team","spec","collection","instance","hub"]},eId:{type:String},roles:{type:[String],enum:["owner","admin","member","guest"]},status:{type:String},slAdmin:{type:Boolean,default:!1,set:function(){return this.slAdmin}}},{timestamps:!0,collection:"acl"});l.plugin(s.default),l.statics.filter=function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,i.default)({},t,{id:t.aType+"-"+t._id,orgId:u.get(e,"requestedOrgId")||t.orgId,teamId:u.get(e,"requestedTeamId")||t.teamId})},l.index({orgId:1,userId:1,teamId:1,aType:1,eType:1,eId:1},{unique:!0});var f=c.model("acl",l);f.on("index",function(e){e&&console.log("Error creating acl model index",e)}),e.exports=f},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e){this.name="MissingArgumentError",this.message=e||"Argument is missing.",this.stack=(new Error).stack}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var r in t)if(t.hasOwnProperty(r)&&v.isUndefined(t[r]))throw new n("You need to specify <"+r+"> for ACL."+e+"() method.")}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];if(!e.length)throw new y.BadRequest("You need to set at least one role.");if("team"===t&&e.includes("owner"))throw new y.BadRequest("Owner role is not supported for a teams.");if("org-entity"===t){var r=["guest","member"];if(!v.intersection(e,r).length)throw new y.BadRequest("Allowed roles are: "+r.join(", ")+".")}if("public-entity"===t){var a=["guest"];if(!v.intersection(e,a).length)throw new y.BadRequest("Allowed roles are: "+a.join(", ")+".")}e.forEach(function(e){if(!b.includes(e))throw new y.NotFound('Role "'+e+'" does not exist.')})}var s=r(2),u=a(s),c=r(5),d=a(c),l=r(30),f=a(l),p=r(29),m=a(p),g=r(7),h=a(g),v=r(0),y=r(6),I=r(12).getEntityKeys,b=["owner","admin","member","guest"],_={org:{owner:["update:org:billing","update:org:collaboration","read:org:collaboration","read:org","update:org","delete:org","create:org:entity","create:team","read:team","update:team","delete:team","create:team:entity","read:team:collaboration","update:team:collaboration","read:entity","update:entity","delete:entity","read:entity:collaboration","update:entity:collaboration","update:entity:connections","read:entity:connections"],admin:["update:org:collaboration","read:org:collaboration","read:org","update:org","create:org:entity","create:team","read:team","update:team","delete:team","create:team:entity","read:team:collaboration","update:team:collaboration","read:entity","update:entity","delete:entity","read:entity:collaboration","update:entity:collaboration","update:entity:connections","read:entity:connections"],member:["read:org:collaboration","read:org","create:org:entity","create:team","read:team","read:team:collaboration"],guest:["read:org"],follower:["read:org"]},team:{owner:["read:team","update:team","delete:team","read:team:collaboration","update:team:collaboration","create:team:entity","read:entity","update:entity","delete:entity","read:entity:collaboration","update:entity:collaboration","update:entity:connections","read:entity:connections"],admin:["read:team","update:team","delete:team","read:team:collaboration","update:team:collaboration","create:team:entity","read:entity","update:entity","delete:entity","read:entity:collaboration","update:entity:collaboration","update:entity:connections","read:entity:connections"],member:["read:team","create:team:entity","read:team:collaboration","read:entity","update:entity","delete:entity","read:entity:collaboration","update:entity:connections","read:entity:connections"],guest:["read:team","read:entity","read:entity:connections"],follower:[]},resource:{owner:["read:entity","update:entity","delete:entity","read:entity:collaboration","update:entity:collaboration","update:entity:connections","read:entity:connections"],admin:["read:entity","update:entity","delete:entity","read:entity:collaboration","update:entity:collaboration","update:entity:connections","read:entity:connections"],member:["read:entity","update:entity","delete:entity","read:entity:collaboration","update:entity:connections","read:entity:connections"],guest:["read:entity","read:entity:connections"],follower:["read:entity"]}};e.exports={_getPermissionsForRole:function(e,t){var r=e;return["org","team"].includes(r)||(r="resource"),v.get(_,[r,t])},_getUserRoles:function(e){var t=this,r=e.userId,a=e.slAdmin,n=e.resource,o=e.resourceId,s=e.orgId;i("getUserRoles",{userId:r,resource:n,orgId:s});var u=function(e){return!e.total&&a&&e.data.push({aType:"org-member",orgId:s,userId:r,eType:"org",eId:s,roles:["admin"],slAdmin:!0}),e};return"org"===n?this.service("acl").find({query:{userId:r,orgId:s,aType:"org-member",eType:"org",eId:s}}).then(u):"team"===n?this.service("acl").find({query:{$or:[{userId:r,orgId:s,aType:"team-member",eType:"team",eId:o},{userId:r,orgId:s,aType:"org-member",eType:"org",eId:s}]}}).then(u):this.service("acl").find({query:{userId:r,orgId:s,aType:"org-member",eType:"org",eId:s}}).then(function(e){var a=e.total;return t.service("acl").find({query:{orgId:s,aType:n+"-team",eType:n,eId:o}}).then(function(e){var i={$or:[{userId:r,orgId:s,aType:n+"-member",eType:n,eId:o},{userId:r,orgId:s,aType:"org-member",eType:"org",eId:s},{aType:"public-"+n,eType:n,eId:o}]};a&&i.$or.push({orgId:s,aType:"org-"+n,eType:n,eId:o});var c=v.map(e.data,"teamId");return c.length&&i.$or.push({userId:r,orgId:s,aType:"team-member",eType:"team",eId:{$in:c}}),t.service("acl").find({query:i}).then(u)})})},_createPermissionsMap:function(e){var t=this;return e&&e.length?v.reduce(e,function(e,r){return(0,h.default)({},e,(0,m.default)({},r.aType,v.reduce(r.roles,function(e,a){return(0,h.default)({},e,(0,m.default)({},a,t._getPermissionsForRole(r.eType,a)))},{})))},{}):{}},_getUserPermissions:function(e){var t=this,r=e.userId,a=e.slAdmin,n=e.resource,o=e.resourceId,s=e.orgId;return i("getUserPermissions",{userId:r,resource:n,orgId:s}),this._getUserRoles({userId:r,slAdmin:a,resource:n,resourceId:o,orgId:s}).then(function(e){var r=e.data;return t._createPermissionsMap(r)})},_mergePermissions:function(e){var t=v.reduce(e,function(e,t){return e.concat(v.reduce(t,function(t,r){return e.concat(r)},[]))},[]);return v.uniq(t)},_filterResourcePermissions:function(e,t){return e.filter(function(e){var r=e.split(":")[1],a=I();return r===t||a.includes(t)&&"entity"===r})},_createAclObject:function(e,t,r,a,n){var i=this,o={org:{roles:[],permissions:[]},user:{roles:[],permissions:[]},team:{roles:[],permissions:[]},public:{roles:[],permissions:[]}};return v.map(e,function(e,s){var u=s.split("-"),c=(0,f.default)(u,2),d=c[0],l=c[1],p=void 0;p=["org","public"].includes(d)&&"member"!==l?d:"team"===l?l:"user",v.map(e,function(e,u){var c=v.union(o[p].permissions,e),d=i._filterResourcePermissions(c,t);if(d.length){var f=u;"member"===l&&r!==v.get(a,"0.userId")&&n?f="org:owner":"org-member"===s&&"org"!==t?f="org:"+f:"team-member"===s&&"team"!==t&&(f="team:"+f),o[p].roles.push(f),o[p].permissions=d}})}),o=v.reduce(o,function(e,t,r){return v.every(t,v.isEmpty)||(e[r]=t),e},{})},_createAclRecord:function(e){var t=e.resource,r=e.resourceId,a=e.userId,n=e.orgId,i=e.members,o=void 0===i?[]:i,s=e.teamId,u=e.teams,c=void 0===u?[]:u,d=e.isOrgOwner,l={resourceId:r},f=void 0;return a&&(l.userId=a,f=this._createPermissionsMap(o.filter(function(e){return e.userId===a||e.aType==="org-"+t||e.aType==="public-"+t}))),n&&(l.orgId=n),s&&(l.teamId=s,f=this._createPermissionsMap(c)),l.acl=this._createAclObject(f,t,a,o,d),l.permissions=this._mergePermissions(f),l.resourcePermissions=this._filterResourcePermissions(l.permissions,t),l},_cleanAclRecords:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e)return e;var t={};return v.forEach(e,function(e){var r=e.resourceId+"-"+e.userId+"-"+e.orgId,a=t[r];a?(v.isEmpty(e.acl)||(a.acl=a.acl||{},v.merge(a.acl,e.acl)),v.isEmpty(e.permissions)||(a.permissions=a.permissions||[],a.permissions=v.uniq(a.permissions.concat(e.permissions))),v.isEmpty(e.resourcePermissions)||(a.resourcePermissions=a.resourcePermissions||[],a.resourcePermissions=v.uniq(a.resourcePermissions.concat(e.resourcePermissions)))):t[r]=e}),v.values(t)},_getUserOrgs:function(e){return i("getUserOrgs",{userId:e}),this.service("acl").find({query:{userId:e,aType:"org-member",eType:"org"}})},_getUserTeams:function(e,t,r,a){var n=this;return i("getUserTeams",{userId:e,orgId:r}),this._getUserPermissions({userId:e,slAdmin:t,orgId:r,resource:"org",resourceId:r}).then(function(t){var i=n._mergePermissions(t),o={orgId:r,aType:"team-member",eType:"team"};return!a&&i.includes("read:team")||(o.userId=e),n.service("acl").find({query:o})})},_getUserEntities:function(e,t,r,a,n){var o=this;return i("getUserEntities",{entity:e,userId:t,orgId:a}),this._getUserTeams(t,r,a,!0).then(function(i){var s=v.uniq(v.map(i.data,"eId")),u={$or:[{userId:r?{$exists:!0}:t,orgId:a,aType:e+"-member",eType:e},{aType:"public-"+e,eType:e}]};return n&&u.$or.push({orgId:a,aType:"org-"+e,eType:e}),v.isEmpty(s)||u.$or.push({orgId:a,aType:e+"-team",eType:e,teamId:{$in:s}}),o.service("acl").find({query:u})})},getMembers:function(e){var t=this,r=e.userId,a=e.resource,n=e.resourceId,o=e.orgId;return i("getMembers",{resource:a,resourceId:n,orgId:o}),this.service("acl").find({query:{orgId:o,userId:r||{$exists:!0},aType:a+"-member",eType:a,eId:n}}).then(function(e){return{aclRecords:e.data.map(function(e){return t._createAclRecord({resource:a,resourceId:n,orgId:o,userId:e.userId,members:[e]})})}})},addMember:function(e){var t=this,r=e.userId,a=e.resource,n=e.resourceId,s=e.orgId,u=e.status,c=e.roles;i("addMember",{userId:r,resource:a,resourceId:n,orgId:s,roles:c}),o(c,"member");var d={userId:r,orgId:s,roles:c,status:u,aType:a+"-member",eType:a,eId:n},l={userId:r,orgId:s,aType:"org-member",eType:"org"};return c.includes("owner")&&(l={$or:[l,{orgId:s,aType:"org-member",eType:"org",roles:"owner"}]}),this.service("acl").find({query:l}).then(function(e){if("org"===a){if(e.total){if(c.includes("owner"))throw new y.BadRequest(v.capitalize(a)+" can only have one owner.");var i=v.find(e.data,{userId:r});if(i)return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:s,userId:r,members:[i]})]}}return t.service("acl").create(d).then(function(e){return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:s,userId:r,members:[e]})]}})}if(!e.total)throw new y.NotFound("User should belong to the same org as a "+a+".");var o=v.omit(d,["roles","status"]);return c.includes("owner")&&(o={$or:[o,{orgId:s,aType:a+"-member",eType:a,eId:n,roles:"owner"}]}),t.service("acl").find({query:o}).then(function(e){if(e.total){if(c.includes("owner"))throw new y.BadRequest(v.capitalize(a)+" can only have one owner.");var i=v.find(e.data,{userId:r})||{};if(i)return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:s,userId:r,members:[i]})]}}return t.service("acl").create(d).then(function(e){return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:s,userId:r,members:[e]})]}})})})},updateMember:function(e){var t=this,r=e.userId,a=e.resource,n=e.resourceId,s=e.orgId,u=e.roles;i("updateMember",{userId:r,resource:a,resourceId:n,orgId:s,roles:u}),o(u,"member");var c={userId:r,orgId:s,aType:a+"-member",eType:a,eId:n};return u.includes("owner")&&(c={$or:[c,{orgId:s,aType:a+"-member",eType:a,eId:n,roles:"owner"}]}),this.service("acl").find({query:c}).then(function(e){var i=v.get(e,"data[0]");return i?t.service("acl").update(i._id,{roles:u}).then(function(e){return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:s,userId:r,members:[e]})]}}):{}})},deleteMember:function(e){var t=this,r=e.userId,a=e.resource,n=e.resourceId,o=e.orgId,s=e.currentUserId;return i("deleteMember",{userId:r,resource:a,resourceId:n,orgId:o,currentUserId:s}),"org"===a?this.service("acl").find({query:{$or:[{userId:r,orgId:o},{orgId:o,eId:o,eType:"org",roles:"owner",aType:"org-member"}]}}).then(function(e){var i=v.get(e,"data",[]),s=v.find(i,{userId:r,eType:"org"}),c=v.remove(i,function(e){return"org"===e.eType&&e.roles.includes("owner")}),l=(0,f.default)(c,1),p=l[0];if(s.userId===p.userId)throw new y.BadRequest("You cannot delete org owner.");var m=[],g=!0,h=!1,I=void 0;try{for(var b,_=(0,u.default)(i);!(g=(b=_.next()).done);g=!0){var w=b.value;w.roles.includes("owner")?m.push(t.service("acl").update(w._id,{userId:p.userId})):m.push(t.service("acl").remove(w._id))}}catch(e){h=!0,I=e}finally{try{!g&&_.return&&_.return()}finally{if(h)throw I}}return d.default.all(m).then(function(e){return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:o,userId:r,members:[s]})]}})}):this.service("acl").find({query:{userId:r,orgId:o,aType:a+"-member",eType:a,eId:n}}).then(function(e){var i=v.get(e,"data",[]);if(v.isEmpty(i))throw new y.NotFound("User does not have an access to "+a+".");var c=[],l=!0,f=!1,p=void 0;try{for(var m,g=(0,u.default)(i);!(l=(m=g.next()).done);l=!0){var h=m.value;if(h.eId===n&&v.includes(h.roles,"owner")&&h.userId!==s)throw new y.BadRequest("You cannot delete "+a+" owner.");c.push(t.service("acl").remove(h._id))}}catch(e){f=!0,p=e}finally{try{!l&&g.return&&g.return()}finally{if(f)throw p}}return d.default.all(c).then(function(e){return{aclRecords:e.map(function(e){return t._createAclRecord({resource:a,resourceId:n,orgId:o,userId:r,members:[e]})})}})})},getTeamEntities:function(e){var t=this,r=e.teamId,a=e.entity,n=e.orgId;return i("getTeamEntities",{teamId:r,entity:a,orgId:n}),this.service("acl").find({query:{orgId:n,teamId:r,aType:a+"-team",eType:a}}).then(function(e){return{aclRecords:e.data.map(function(e){return t._createAclRecord({resource:a,resourceId:e.eId,orgId:e.orgId,teamId:r,teams:[e]})})}})},getTeams:function(e){var t=this,r=e.teamId,a=e.entity,n=e.entityId,o=e.orgId;return i("getTeams",{entity:a,entityId:n,orgId:o}),this.service("acl").find({query:{orgId:o,teamId:r||{$exists:!0},aType:a+"-team",eType:a,eId:n}}).then(function(e){return{aclRecords:e.data.map(function(e){return t._createAclRecord({resource:a,resourceId:e.eId,orgId:e.orgId,teamId:e.teamId,teams:[e]})})}})},addTeam:function(e){var t=this,r=e.teamId,a=e.entity,n=e.entityId,s=e.orgId,u=e.roles;i("addTeam",{teamId:r,entity:a,entityId:n,orgId:s,roles:u}),o(u,"team");var c={teamId:r,orgId:s,roles:u,aType:a+"-team",eType:a,eId:n};return this.service("acl").find({query:{eType:"team",eId:r,orgId:s}}).then(function(e){if(!e.total)throw new y.NotFound("Team should belong to the same org as "+a+".");return t.service("acl").find({query:v.omit(c,["roles"])}).then(function(e){if(e.total){var i=v.find(e.data,{teamId:r});if(i)return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:s,teamId:r,teams:[i]})]}}return t.service("acl").create(c).then(function(e){return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:s,teamId:r,teams:[e]})]}})})})},updateTeam:function(e){var t=this,r=e.teamId,a=e.entity,n=e.entityId,s=e.orgId,u=e.roles;i("updateTeam",{teamId:r,entity:a,entityId:n,orgId:s,roles:u}),o(u,"team");var c={teamId:r,orgId:s,aType:a+"-team",eType:a,eId:n};return this.service("acl").find({query:c}).then(function(e){var i=v.get(e,"data[0]");return i?t.service("acl").update(i._id,{roles:u}).then(function(e){return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:s,teamId:r,teams:[e]})]}}):{}})},deleteTeam:function(e){var t=this,r=e.teamId,a=e.entity,n=e.entityId,o=e.orgId;return i("deleteTeam",{teamId:r,entity:a,entityId:n,orgId:o}),this.service("acl").find({query:{teamId:r,orgId:o,aType:a+"-team",eType:a,eId:n}}).then(function(e){var i=v.get(e,"data[0]");if(!i)throw new y.NotFound("Team does not have an access to "+a+".");return t.service("acl").remove(i._id).then(function(e){return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:o,teamId:r,teams:[e]})]}})})},getOrgEntity:function(e){var t=e.entity,r=e.entityId,a=e.orgId;return i("getOrgEntity",{entity:t,entityId:r,orgId:a}),this.service("acl").find({query:{orgId:a,aType:"org-"+t,eType:t,eId:r}})},addOrgEntity:function(e){var t=this,r=e.userId,a=e.entity,n=e.entityId,s=e.orgId,u=e.roles;i("addOrgEntity",{userId:r,entity:a,entityId:n,orgId:s,roles:u}),o(u,"org-entity");var c={userId:r,orgId:s,roles:u,aType:"org-"+a,eType:a,eId:n};return this.getOrgEntity({entity:a,entityId:n,orgId:s}).then(function(e){if(e.total){var i=v.find(e.data,{eId:n});if(i)return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:s,userId:r,members:[i]})]}}return t.service("acl").create(c).then(function(e){return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:s,userId:r,members:[e]})]}})})},updateOrgEntity:function(e){var t=this,r=e.userId,a=e.entity,n=e.entityId,s=e.orgId,u=e.roles;return i("updateOrgEntity",{entity:a,entityId:n,orgId:s,roles:u}),o(u,"org-entity"),this.getOrgEntity({entity:a,entityId:n,orgId:s}).then(function(e){var i=v.get(e,"data[0]");if(!i){var o={userId:r,orgId:s,roles:u,aType:"org-"+a,eType:a,eId:n};return t.service("acl").create(o).then(function(e){return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:s,userId:r,members:[e]})]}})}return t.service("acl").update(i._id,{roles:u}).then(function(e){return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:s,userId:r,members:[e]})]}})})},deleteOrgEntity:function(e){var t=this,r=e.entity,a=e.entityId,n=e.orgId;return i("deleteOrgEntity",{entity:r,entityId:a,orgId:n}),this.service("acl").find({query:{orgId:n,aType:"org-"+r,eType:r,eId:a}}).then(function(e){var n=v.get(e,"data[0]");if(!n)throw new y.BadRequest(v.capitalize(r)+" does not belong to this org.");return t.service("acl").remove(n._id).then(function(e){return{aclRecords:[t._createAclRecord({resource:r,resourceId:a,orgId:e.orgId,userId:e.userId,members:[e]})]}})})},getPublicOrgEntities:function(e){var t=e.entity,r=e.orgId;return i("getPublicOrgEntities",{entity:t,orgId:r}),this.service("acl").find({query:{aType:"public-"+t,eType:t,orgId:r}})},getPublicEntity:function(e){var t=e.entity,r=e.entityId;return i("getPublicEntity",{entity:t,entityId:r}),this.service("acl").find({query:{aType:"public-"+t,eType:t,eId:r}})},addPublicEntity:function(e){var t=this,r=e.userId,a=e.entity,n=e.entityId,s=e.orgId,u=e.roles;i("addPublicEntity",{userId:r,entity:a,entityId:n,orgId:s,roles:u}),o(u,"public-entity");var c={userId:r,roles:u,orgId:s,aType:"public-"+a,eType:a,eId:n};return this.getPublicEntity({entity:a,entityId:n}).then(function(e){if(e.total){var i=v.find(e.data,{eId:n});if(i)return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,userId:r,orgId:s,members:[i]})]}}return t.service("acl").create(c).then(function(e){return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,userId:r,orgId:s,members:[e]})]}})})},updatePublicEntity:function(e){var t=this,r=e.userId,a=e.entity,n=e.entityId,s=e.orgId,u=e.roles;return i("updatePublicEntity",{userId:r,entity:a,entityId:n,orgId:s,roles:u}),o(u,"public-entity"),this.getPublicEntity({entity:a,entityId:n}).then(function(e){var i=v.get(e,"data[0]");if(!i){var o={userId:r,roles:u,orgId:s,aType:"public-"+a,eType:a,eId:n};return t.service("acl").create(o).then(function(e){return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,userId:r,orgId:s,members:[e]})]}})}return t.service("acl").update(i._id,{roles:u}).then(function(e){return{aclRecords:[t._createAclRecord({resource:a,resourceId:n,orgId:s,userId:r,members:[e]})]}})})},deletePublicEntity:function(e){var t=this,r=e.entity,a=e.entityId;return i("deletePublicEntity",{entity:r,entityId:a}),this.service("acl").find({query:{aType:"public-"+r,eType:r,eId:a}}).then(function(e){var n=v.get(e,"data[0]");if(!n)throw new y.BadRequest(v.capitalize(r)+" does not has public access.");return t.service("acl").remove(n._id).then(function(e){return{aclRecords:[t._createAclRecord({resource:r,resourceId:a,userId:e.userId,orgId:e.orgId,members:[e]})]}})})},listResources:function(e){var t=this,r=e.userId,a=e.slAdmin,n=e.resource,o=e.orgId;i("listResources",{resource:n});var s=d.default.resolve();return o&&r&&(s=this._getUserRoles({userId:r,slAdmin:a,orgId:o,resource:"org"})),s.then(function(e){var i=r,s=v.get(e,"data[0]"),u=v.intersection(v.get(s,"roles",[]),["owner","admin"]);u||(i={$exists:!0});var c=d.default.resolve();switch(n){case"org":c=t._getUserOrgs(r);break;case"team":c=t._getUserTeams(i,a,o);break;default:c=r?t._getUserEntities(n,i,a,o,e.total):t.getPublicOrgEntities({entity:n,orgId:o})}return c.then(function(e){var a=e.data,i=v.map(a,function(e){return t._createAclRecord({resource:n,resourceId:e.eId,userId:r,orgId:e.orgId,members:[e].concat(s?[s]:[]),canViewAll:u})});return{aclRecords:t._cleanAclRecords(i)}})})},isUser:function(e){var t=e.userId,r=e.slAdmin,a=e.resource,n=e.resourceId,o=e.orgId,s=e.role;return i("isUser",{userId:t,resource:a,resourceId:n,orgId:o,role:s}),this._getUserRoles({userId:t,slAdmin:r,resource:a,resourceId:n,orgId:o}).then(function(e){var t=e.data;return v.find(t,{aType:a+"-member"}).roles.includes(s)})},canUser:function(e){var t=this,r=e.userId,a=e.slAdmin,n=e.resource,o=e.resourceId,s=e.orgId,u=e.permission,c=e.throwError;return r?(i("canUser",{userId:r,resource:n,orgId:s}),this._getUserRoles({userId:r,slAdmin:a,resource:n,resourceId:o,orgId:s}).then(function(e){var a=e.data,i=t._createAclRecord({resource:n,resourceId:o,orgId:s,userId:r,members:a}),d=i.permissions.includes(u);if(c&&!d)throw new y.Forbidden("You have no "+u+" permission for this "+n+".");return{allowed:d,aclRecords:[i]}})):d.default.resolve({allowed:!1,aclRecords:[]})},configure:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.services={},v.mapValues(t.services,function(r,a){e.services[a]=t.app.service(a)})},service:function(e){if(!this.services||!this.services.hasOwnProperty(e))throw new Error("ACL needs to be configured with services.");return this.services[e]}}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(5),i=a(n),o=r(26),s=a(o),u=r(6),c=r(47)("aclManagement:main"),d=r(62),l={app:null,services:{users:"/users",acl:"/acl"},path:"aclManagement"};e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c("service being configured.");var t=this,r=(0,s.default)({},l,e,{app:t});d.configure(r),t.use(r.path,{create:function(e){return c("service called. action="+e.action),"options"===e.action?i.default.resolve(r):d[e.action]?d[e.action](e.value):i.default.reject(new u.BadRequest("Action '"+e.action+"' is invalid.",{errors:{$className:"badParams"}}))}})}},function(e,t,r){"use strict";var a=r(4);t.before={all:[],create:[a.hooks.authenticate(["jwt","local"]),a.hooks.restrictToAuthenticated()],remove:[a.hooks.authenticate(["jwt","apiSecret"])]},t.after={all:[],find:[],get:[],create:[],update:[],patch:[],remove:[]}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(29),i=a(n),o=r(30),s=a(o),u=r(5),c=a(u),d=r(118),l=a(d),f=r(44),p=a(f),m=r(45),g=a(m),h=r(120),v=a(h),y=r(119),I=a(y),b=r(0),_=r(6),w=r(131),S=r(133),x=r(132),E=r(134),T=r(146).Strategy,P=r(152),k=r(14),q=r(43),O=r(1).safeParse,R=r(37),A=r(36),$=r(64),M=function(e){function t(){return(0,p.default)(this,t),(0,v.default)(this,(t.__proto__||(0,l.default)(t)).apply(this,arguments))}return(0,I.default)(t,e),(0,g.default)(t,[{key:"verify",value:function(e,t,r,a){this.app.service("users").find({noFilter:!0,query:{$or:[{username:t},{"emails.address":t.toLowerCase()}]}}).then(function(e){var n=e.data,i=n[0];return b.isEmpty(i)?a(new _.NotFound("No account found for "+t+"."),!1):c.default.all([i,A.Password.comparePassword(r,b.get(i,"services.password.bcrypt"))])}).then(function(e){var t=(0,s.default)(e,2),r=t[0];return t[1]?a(null,r,{userId:r._id}):a(new _.NotAuthenticated("Invalid email and password combination."),!1)}).catch(function(e){return a(e,!1)})}}]),t}(S.Verifier),j=function(e){function t(){return(0,p.default)(this,t),(0,v.default)(this,(t.__proto__||(0,l.default)(t)).apply(this,arguments))}return(0,I.default)(t,e),(0,g.default)(t,[{key:"verify",value:function(e,t,r,a,n){var o=this,s=this.options,u=void 0,c=b.reduce(a.emails,function(e,t){return t.primary&&(u=t.value),t.verified&&e.push(t.value),e},[]),d={$or:[(0,i.default)({},s.idField,a.id),(0,i.default)({},s.idField,parseInt(a.id,10)),{"emails.address":{$in:c}}]},l={profile:a,accessToken:t,refreshToken:r},f=void 0;if(e&&e[s.entity]&&(f=e[s.entity]),!f&&e&&e.params&&e.params[s.entity]&&(f=e.params[s.entity]),f)return this._updateEntity(f,l).then(function(e){return n(null,e)}).catch(function(e){return e?n(e):n(null,e)});this.service.find({query:d}).then(function(e){var t=e.data,r=t[0];if(b.size(t)>1&&u){var a=b.find(t,function(e){return b.find(e.emails,{address:u})});a&&(r=a)}return r}).then(function(e){if(e){var t=e[s.idField];if(t===a.id||t===parseInt(a.id,10))return o._updateEntity(e,l);return e.emails.some(function(e){return c.includes(e.address)})?o._updateEntity(e,l):n(null,{},{error:new _.Conflict("An account with this email has already been registered. Please click the verification link in your email to complete the sync to Github.")})}return o._createEntity(l)}).then(function(e){var t=e[o.service.id],r=(0,i.default)({},o.options.entity+"Id",t);n(null,e,r)}).catch(function(e){return e?n(e):n(null,e)})}}]),t}(E.Verifier);e.exports=function(){var e=this,t=process.env.HOST||e.get("HOST"),r=process.env.SL_APP_HOST||e.get("SL_APP_HOST"),a=O(process.env.AUTH,null)||e.get("AUTH")||{path:"auth",secret:process.env.AUTH_SECRET||"6bkCxCRxwnEouTPCBj4+wUxU8+ZrQl+UzgxoEn3STpukm9x7dDviq70R/5H6Xowin62NkdrxJFO/XXV6bX0Re13ZLsQ==",local:{},jwt:{audience:t,issuer:"stoplightio",expiresIn:"9999d"},github:{clientID:process.env.GITHUB_CLIENT_ID||"",clientSecret:process.env.GITHUB_CLIENT_SECRET||"",scope:["user:email"]}};e.configure(w(a)),e.configure(S({Verifier:M})),e.configure(x()),a.github.clientID&&a.github.clientSecret?e.configure(E({name:"github",Strategy:T,path:"/oauth/github",callbackURL:t+"/oauth/github/callback",idField:"services.github.id",Verifier:j,handler:function(t,a,n){var i=t.payload,o=function(e){return a.hook={data:{}},Object.defineProperty(a.hook.data,"__redirect",{value:{status:302,url:r+"/oauth/github/error?reason="+e}}),n(e)};if(i.error)return o(i.error);e.service("auth").create({payload:i}).then(function(e){var t=e.accessToken;a.hook={data:{}},Object.defineProperty(a.hook.data,"__redirect",{value:{status:302,url:r+"/oauth/github/success?access_token="+t}}),n()}).catch(function(e){return o(e)})}})):console.log("GITHUB_CLIENT_ID or GITHUB_CLIENT_SECRET env variable not set - github auth will not work!"),e.configure(q({service:"/users",identifyUserProps:["email","emails.0.address"],userPasswordField:"services.password.bcrypt",resetDelay:2592e6,delay:2592e6,bcrypt:{hash:function(e,t,r){A.Password.hashPassword(e).then(function(e){return r(null,e)}).catch(function(e){return r(e)})},genSalt:function(e,t){t()}},notifier:function(t,r){if("sendResetPwd"===t)return e.service("mailer").create(R.resetPassword({email:b.get(r,"emails[0].address"),resetToken:r.resetToken,name:b.get(r,"profile.name",r.username)}))}}));var n=e.service("auth");n.before($.before),n.after($.after);var i=e.service("authManagement");e.use("/auth/verify-email/:token",{find:function(t){var r=t.token;return i.create({action:"verifySignupLong",value:r}).then(function(t){return e.service("users").patch(t._id,{"emails.0.verified":!0}).then(function(){return{success:!0,message:"Your email is successfully verified."}})}).catch(function(e){return c.default.resolve(e)})}}),e.use("/auth/forgot-password",{create:function(e){var t=e.email;return i.create({action:"sendResetPwd",value:{"emails.0.address":t}}).then(function(){return{success:!0,message:"We are sending you an email with reset instructions. Please give it a few minutes to arrive, and don't forget to check your spam box if you can't find it!"}})}}),e.use("/auth/reset-password",{create:function(e){var t=e.password,r=e.token;if(b.isEmpty(r))throw new _.BadRequest("Please provide a token.");if(b.isEmpty(t)||t.length<6)throw new _.BadRequest("Your password must be at least 6 characters long.");return i.create({action:"resetPwdLong",value:{token:r,password:t}}).then(function(e){return{user:e,success:!0,message:"Password successfully updated."}})}});var o=function(e){return P.create({client:{id:e.clientId,secret:e.clientSecret},auth:{tokenHost:e.accessTokenURL,tokenPath:" ",authorizeHost:e.authorizeURL,authorizePath:" "}})};e.use("/oauth2/authorize",{create:function(r,a){var n=r.credentials,i=b.merge({secret:k.id()},n),s=o(i),u={};return u.authorizationUri=s.authorizationCode.authorizeURL({redirect_uri:t+"/oauth2/callback",scope:i.scope,state:i.secret}),e.service("users").patch(a.user._id,{lastOauth2Config:i}).then(function(){return u})}}),e.service("/oauth2/authorize").before($.before),e.get("/oauth2/callback",function(t,a,n){var i=t.query,u=i.code,c=i.state;e.service("users").find({query:{"lastOauth2Config.secret":c}}).then(function(t){var i=(0,s.default)(t.data,1),c=i[0];if(!c)return n(new _.NotAuthenticated("You are not authenticated."));o(c.lastOauth2Config).authorizationCode.getToken({code:u}).then(function(t){if(b.isEmpty(t)||!t.access_token)return n(new _.BadRequest("Can't get access token."));e.service("users").patch(c._id,{$push:{oauth2AccessTokens:b.merge({},t,{name:c.lastOauth2Config.tokenName})},$set:{lastOauth2Config:{}}}).then(function(){a.redirect(""+r+c.lastOauth2Config.route)}).catch(n)}).catch(n)})})}},function(e,t,r){"use strict";var a=r(7),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(0),o=r(9),s=r(11),u=r(16),c=r(4),d=r(15),l=r(3),f=l.lookupOrg,p=l.lookupCollection,m=l.enableSearch,g=r(10).hooks;t.before={all:[o.setSlug("orgId"),f()],find:[c.hooks.authenticate(["jwt","apiSecret"],{optional:!0}),g.listResources("collection"),m()],get:[c.hooks.authenticate(["jwt","apiSecret"],{optional:!0})],create:[c.hooks.authenticate(["jwt","apiSecret"]),g.canUser("create:org:entity","org",!0),d.generateSlug({target:"name",query:function(e){return{orgId:i.get(e,"params.org._id")}}}),s.stringifyData({path:"data"})],update:[o.disallow()],patch:[c.hooks.authenticate(["jwt","apiSecret"]),o.setSlug("id"),o.setSlug("collectionId"),p(!1),g.canUser("update:entity","collection",!0),o.iff(function(e){return e.data.slug&&e.data.slug!==e.params.collection.slug},d.generateSlug({target:"slug",query:function(e){return{orgId:i.get(e,"params.org._id")}}}),function(e){return(0,n.default)({},e,{id:{$in:[e.id,e.data.slug]}})}),s.stringifyData({path:"data"})],remove:[c.hooks.authenticate(["jwt","apiSecret"]),p(!1),g.canUser("delete:entity","collection",!0),g.removeRelated("collection")]},t.after={all:[u.add(),s.parseResult({path:"data"})],find:[s.filter({detailed:!1}),g.augmentWithPermissions()],get:[s.filter(),g.canUser("read:entity","collection",!0),g.augmentWithPermissions()],create:[s.filter(),g.addOwner("collection"),g.addOrgEntity("collection"),g.addPublicEntity("collection"),g.augmentWithPermissions()],update:[],patch:[s.filter(),g.updateOrgEntity("collection"),g.updatePublicEntity("collection"),g.augmentWithPermissions()],remove:[s.filter(),g.augmentWithPermissions()]}},function(e,t,r){"use strict";var a=r(38),n=r(13),i=r(68),o=r(66);e.exports=function(){var e=this,t={Model:i,lean:!0,overwrite:!1,paginate:{default:100,max:100},findOneQuery:function(e,t,r){return{$or:[{_id:e},{orgId:r.orgId,slug:e}]}}};e.use("/orgs/:orgId/collections",n(t));var r=e.service("/orgs/:orgId/collections");r.before(o.before),r.after(o.after),e.post("/orgs/:orgId/collections/:collectionId/migrate/:version",function(e,t,r){var n=e.body.collection||{},i=(0,a.migrateCollection)({collection:n});return t.json(i)})}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(8),i=a(n),o=r(0),s=a(o),u=r(38),c=r(23),d=r(1),l=r(12),f=r(17),p=r(22),m=a(p),g=i.default.Schema,h=new g({},{timestamps:!0,collection:"collections"});h.plugin(m.default.global),h.plugin(m.default.connections),h.plugin(m.default.entity,{name:"New Collection",data:(0,d.safeStringify)({scenarioVersion:u.latestVersion,scenarios:{github:c.githubExample,todos:c.todosExample}})}),h.statics.addVirtuals=function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],s.default.get(e,"requestedOrgId")),a=s.default.get(e,"params.org",{});return t.id=(t.orgSlug||a.slug)+"/collections/"+(e.id||t.slug||t._id),t.orgId=r||t.orgId,t.urls={export:(0,l.buildExportUrl)({entityType:"collections",entity:t,host:(0,f.getConfigVar)("HOST"),exportHost:(0,f.getConfigVar)("SL_EXPORT_HOST"),deref:"remote"})},t};var v=i.default.model("collection",h);e.exports=v},function(e,t,r){"use strict";var a=r(0),n=r(9),i=r(3),o=i.lookupOrg,s=i.lookupEntity,u=r(10).hooks,c=r(11),d=r(4);t.before=function(e){return{all:[d.hooks.authenticate(["jwt","apiSecret"]),n.setSlug("orgId"),n.setSlug(e+"Id"),o(),function(e){return a.set(e,"params.connections",!0),e},s(e)],find:[u.canUser("read:entity:connections",e,!0)],get:[n.disallow()],create:[u.canUser("update:entity:connections",e,!0)],update:[n.disallow()],patch:[n.disallow()],remove:[u.canUser("update:entity:connections",e,!0)]}},t.after=function(e){return{all:[c.filter(),u.populateConnectedEntity(e,{dereference:{remote:!0}})],find:[],get:[],create:[],update:[],patch:[],remove:[]}}},function(e,t,r){"use strict";var a=r(12),n=r(0),i=r(6),o=r(69),s=r(3);e.exports=function(e){var t=n.trimEnd(e,"s");return function(){var r=this,u="orgs/:orgId/"+e,c="/"+u+"/:"+t+"Id/connections/:entityType";r.use(c,{find:function(e){var a=n.get(e,"org._id"),i=e[t],o=s.getProp({params:e},"entityType"),u=s.getProp({params:e},"connectionType"),c=n.trimEnd(o,"s");return r.service("aclManagement").create({action:"listResources",value:{userId:n.get(e,"user._id"),slAdmin:n.get(e,"user.slAdmin"),orgId:a,resource:c}}).then(function(e){var t=e.aclRecords;return"inbound"===u?{availableResources:t}:{aclRecords:t,connections:n.reduce(i.connections,function(e,r){var a=n.find(t,{resourceId:r.entityId});return n.get(a,"resourcePermissions",[]).includes("read:entity")&&e.push(r),e},[])}})},create:function(o,c){var d=n.get(c,"org._id"),l=c[t],f=s.getProp({params:c},"entityType"),p=s.getProp({params:c},"connectionType")||"outbound",m=n.trimEnd(f,"s");if(!(0,a.getAllowedConnections)(p,e).includes(f))throw new i.BadRequest("You can't connect "+m+" to "+t+".");if(n.isEmpty(o.id))throw new i.BadRequest("You need to specify one or more IDs.");var g=o.id;return n.isArray(g)||(g=[g]),r.service("aclManagement").create({action:"listResources",value:{userId:n.get(c,"user._id"),slAdmin:n.get(c,"user.slAdmin"),orgId:d,resource:m}}).then(function(e){var t=e.aclRecords;return g=n.reduce(t,function(e,t){return g.includes(t.resourceId)&&n.get(t,"resourcePermissions",[]).includes("read:entity")&&e.push(t.resourceId),e},[]),r.service(u).patch(l._id,{$addToSet:{connections:{$each:g.map(function(e){return{entityId:e,orgId:d,entityType:f}})}}},{query:{orgId:d}}).then(function(e){var r=e.connections;return{aclRecords:t,connections:r}})})},remove:function(e,a){var o=n.get(a,"org._id"),c=a[t],d=s.getProp({params:a},"entityType"),l=n.trimEnd(d,"s");if(!e)throw new i.BadRequest("You need to specify an ID.");return r.service("aclManagement").create({action:"listResources",value:{userId:n.get(a,"user._id"),slAdmin:n.get(a,"user.slAdmin"),orgId:o,resource:l}}).then(function(t){var a=t.aclRecords,s=n.find(a,{resourceId:e});if(s&&n.get(s,"resourcePermissions",[]).includes("read:entity"))return r.service(u).patch(c._id,{$pull:{connections:{entityId:e,entityType:d}}},{query:{orgId:o}}).then(function(e){var t=e.connections;return{aclRecords:a,connections:t}});throw new i.Forbidden("You have no read:entity permission for this "+e+".")})}});var d=r.service(c);d.before(o.before(t)),d.after(o.after(t))}}},function(e,t,r){"use strict";var a=r(0),n=r(106).exportService;e.exports=function(e){return function(){var t=this,r=a.trimEnd(e,"s")+"Id",i="/orgs/:orgId/"+e+"/:"+r+"/export.:extension",o="/orgs/:orgId/"+e;t.get(i,function(a,i,s){var u=a.params,c=u.orgId,d=u.extension,l=a.params[r];return t.service(o).get(l,{orgId:c}).then(function(r){return t.service("acl").find({query:{eId:r._id,aType:"public-entity"}}).then(function(t){return n({data:r.data,token:r.token,isPublic:r.public||t.total,entityType:e,extension:d,res:i,next:s},a.query)})}).catch(s)})}}},function(e,t,r){"use strict";var a=r(9),n=r(3),i=n.lookupOrg,o=n.lookupUser,s=n.lookupEntity,u=n.lookupTeam,c=r(10).hooks,d=r(11),l=r(4);t.before=function(e){return{all:[l.hooks.authenticate(["jwt","apiSecret"]),a.setSlug("orgId"),a.setSlug(e+"Id"),i(),s(e),u(),o()],find:[c.canUser("read:entity",e,!0)],get:[c.canUser("read:entity",e,!0)],create:[c.canUser("update:entity:collaboration",e,!0),c.canUser("create:team:entity","team",!0)],update:[a.disallow()],patch:[c.canUser("update:entity:collaboration",e,!0),c.canUser("update:team","team",!0)],remove:[c.canUser("update:team","team",!0)]}},t.after=function(e){return{all:[c.populateTeam(),d.filter()],find:[],get:[],create:[],update:[],patch:[],remove:[]}}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(2),i=a(n),o=r(5),s=a(o),u=r(0),c=r(6),d=r(72);e.exports=function(e){var t=u.trimEnd(e,"s");return function(){var r=this,a="/orgs/:orgId/"+e+"/:"+t+"Id/teams";r.use(a,{find:function(e){return r.service("aclManagement").create({action:"getTeams",value:{orgId:u.get(e,"org._id"),entity:t,entityId:u.get(e,t+"._id")}})},get:function(e,a){return r.service("aclManagement").create({action:"getTeams",value:{orgId:u.get(a,"org._id"),teamId:e,entity:t,entityId:u.get(a,t+"._id")}})},create:function(e,a){if(u.isEmpty(e.teamId))throw new c.BadRequest("You need to specify one or more team IDs.");var n=e.teamId;u.isArray(n)||(n=[n]);var o=u.get(a,"org._id");return r.service("orgs/:orgId/teams").find({noFilter:!0,query:{orgId:o,_id:{$in:n}}}).then(function(d){if(!d.total){if(n.length>1)throw new c.NotFound("One or more teams with provided id are not found.");throw new c.NotFound("Team with provided id is not found.")}var l=[],f=!0,p=!1,m=void 0;try{for(var g,h=(0,i.default)(n);!(f=(g=h.next()).done);f=!0){var v=g.value;u.find(d.data,{_id:v})&&l.push(r.service("aclManagement").create({action:"addTeam",value:{orgId:o,entity:t,teamId:v,roles:[e.role||"member"],entityId:u.get(a,t+"._id")}}))}}catch(e){p=!0,m=e}finally{try{!f&&h.return&&h.return()}finally{if(p)throw m}}return s.default.all(l).then(function(e){return{aclRecords:u.reduce(e,function(e,t){var r=t.aclRecords;return e.concat(r)},[])}})})},patch:function(e,a,n){return r.service("aclManagement").create({action:"updateTeam",value:{orgId:u.get(n,"org._id"),teamId:e,entity:t,entityId:u.get(n,t+"._id"),roles:[a.role]}})},remove:function(e,a){var n=[e];u.isEmpty(e)&&(n=u.get(a,"query.teamIds"));var i=u.map(n,function(e){return r.service("aclManagement").create({action:"deleteTeam",value:{teamId:e,entity:t,orgId:u.get(a,"org._id"),entityId:u.get(a,t+"._id")}})});return s.default.all(i).then(function(e){return{aclRecords:u.reduce(e,function(e,t){var r=t.aclRecords;return e.concat(r)},[])}})}});var n=r.service(a);n.before(d.before(t)),n.after(d.after(t))}}},function(e,t,r){"use strict";var a=r(8);e.exports=function(){this.get("/health",function(e,t){return a.connection.db.admin().ping(function(e,r){e||!r?t.status(500).json({status:"ERROR",message:"DB not connected."}):t.json({status:"OK",build:69})})})}},function(e,t,r){"use strict";var a=r(2),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(8),o=r(12).getEntityTypes,s=r(65),u=r(60),c=r(63),d=r(101),l=r(80),f=r(74),p=r(97),m=r(99),g=r(84),h=r(94),v=r(89),y=r(67),I=r(77),b=r(82),_=r(87),w=r(92),S=r(73),x=r(70),E=r(71);e.exports=function(){var e=this;i.connect(process.env.MONGO_URL||e.get("MONGO_URL")),i.Promise=global.Promise;var t=o();e.configure(s),e.configure(u),e.configure(c),e.configure(d),e.configure(l),e.configure(f),e.configure(p),e.configure(m),e.configure(g),e.configure(y),e.configure(v),e.configure(I),e.configure(b),e.configure(h),e.configure(_("teams"));var r=!0,a=!1,T=void 0;try{for(var P,k=(0,n.default)(t);!(r=(P=k.next()).done);r=!0){var q=P.value;e.configure(E(q)),e.configure(S(q)),e.configure(w(q)),e.configure(x(q)),e.configure(_(q))}}catch(e){a=!0,T=e}finally{try{!r&&k.return&&k.return()}finally{if(a)throw T}}}},function(e,t,r){"use strict";var a=r(7),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=(r(1),r(0)),o=r(9),s=r(11),u=r(16),c=r(4),d=r(15),l=r(3),f=l.lookupOrg,p=l.lookupInstance,m=l.enableSearch,g=r(10).hooks;t.before={all:[o.setSlug("orgId"),f()],find:[c.hooks.authenticate(["jwt","apiSecret"],{optional:!0}),g.listResources("instance"),m()],get:[c.hooks.authenticate(["jwt","apiSecret"],{optional:!0})],create:[c.hooks.authenticate(["jwt","apiSecret"]),g.canUser("create:org:entity","org",!0),d.generateSlug({target:"name",query:function(e){return{orgId:i.get(e,"params.org._id")}}}),o.iff(function(e){return!!e.data.subdomain},d.generateSlug({target:"subdomain",prop:"subdomain"})),s.stringifyData({path:"data"})],update:[o.disallow()],patch:[c.hooks.authenticate(["jwt","apiSecret"]),p(!1),g.canUser("update:entity","instance",!0),o.iff(function(e){return e.data.slug&&e.data.slug!==e.params.instance.slug},d.generateSlug({target:"slug",query:function(e){return{orgId:i.get(e,"params.org._id")}}}),function(e){return(0,n.default)({},e,{id:{$in:[e.id,e.data.slug]}})}),o.iff(function(e){return e.data.subdomain&&e.data.subdomain!==e.params.instance.subdomain},d.generateSlug({target:"subdomain",prop:"subdomain"})),s.stringifyData({path:"data"})],remove:[c.hooks.authenticate(["jwt","apiSecret"]),p(!1),g.canUser("delete:entity","instance",!0),g.removeRelated("instance")]},t.after={all:[u.add(),s.parseResult({path:"data"})],find:[s.filter({detailed:!1}),g.augmentWithPermissions()],get:[s.filter(),g.canUser("read:entity","instance",!0),g.augmentWithPermissions()],create:[s.filter(),g.addOwner("instance"),g.addOrgEntity("instance"),g.addPublicEntity("instance"),g.augmentWithPermissions()],update:[],patch:[s.filter(),g.updateOrgEntity("instance"),g.updatePublicEntity("instance"),g.augmentWithPermissions()],remove:[s.filter(),g.augmentWithPermissions()]}},function(e,t,r){"use strict";var a=r(13),n=r(78),i=r(76);e.exports=function(){var e=this,t={Model:n,lean:!0,overwrite:!1,paginate:{default:100,max:100},findOneQuery:function(e,t,r){return{orgId:r.orgId,$or:[{_id:e},{slug:e}]}}};e.use("/orgs/:orgId/instances",a(t));var r=e.service("/orgs/:orgId/instances");r.before(i.before),r.after(i.after)}},function(e,t,r){"use strict";var a=r(22),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(17),o=r(12),s=r(1),u=r(14),c=r(8),d=r(0),l=c.Schema,f=new l({subdomain:{type:String,required:!0,minLength:3,match:[/[a-z0-9-]+/,'Subdomain should contain only lower case letters, digits and the following characters: "-" and "_".'],default:function(){return u.id(14).toLowerCase()}}},{timestamps:!0,collection:"prism_instances"});f.plugin(n.default.global),f.plugin(n.default.connections),f.plugin(n.default.errors),f.plugin(n.default.entity,{name:"New Instance",data:(0,s.safeStringify)({apis:[],rules:[]}),whitelist:["subdomain"]}),f.statics.addVirtuals=function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],d.get(e,"requestedOrgId")),a=d.get(e,"params.org",{});return t.id=(t.orgSlug||a.slug)+"/instances/"+(e.id||t.slug||t._id),t.orgId=r||t.orgId,t.urls={export:(0,o.buildExportUrl)({entityType:"instances",entity:t,host:(0,i.getConfigVar)("HOST"),exportHost:(0,i.getConfigVar)("SL_EXPORT_HOST"),deref:"remote"})},t};var p=c.model("instance",f);e.exports=p},function(e,t,r){"use strict";var a=r(7),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(0);t.before={all:[function(e){return i.get(e,"data.to","").match(/stoplight-tests/gi)&&(e.result=(0,n.default)({},e.data,{skipped:!0})),e}],find:[],get:[],create:[],update:[],patch:[],remove:[]},t.after={all:[],find:[],get:[],create:[],update:[],patch:[],remove:[]}},function(e,t,r){"use strict";var a=r(138),n=r(79);e.exports=function(){var e=this,t=process.env.MAIL_URL||e.get("MAIL_URL");if(!t)return void console.log("MAIL_URL env variable not set - emails will not work!");e.use("/mailer",a(t));var r=e.service("/mailer");r.before(n.before),r.after(n.after)}},function(e,t,r){"use strict";var a=r(9),n=r(3),i=n.lookupOrg,o=r(10).hooks,s=r(35),u=r(11),c=r(4);t.before={all:[c.hooks.authenticate(["jwt","apiSecret"]),a.setSlug("orgId"),i()],find:[o.canUser("read:org:collaboration","org",!0)],get:[o.canUser("read:org:collaboration","org",!0)],create:[o.canUser("update:org:collaboration","org",!0)],update:[o.canUser("update:org:collaboration","org",!0)],patch:[o.canUser("update:org:collaboration","org",!0)],remove:[]},t.after={all:[o.populateMember(),u.filter()],find:[],get:[],create:[s.hooks.sendEnrollmentEmail(),s.hooks.sendOrgMemberEmail()],update:[],patch:[],remove:[]}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(2),i=a(n),o=r(5),s=a(o),u=r(0),c=r(6),d=r(81),l=r(3),f=r(39),p=r(14);e.exports=function(){var e=this;e.use("/orgs/:orgId/members",{find:function(t){var r=u.get(t,"org._id");return e.service("aclManagement").create({action:"getMembers",value:{orgId:r,resource:"org",resourceId:r}})},get:function(t,r){var a=u.get(r,"org._id");return e.service("aclManagement").create({action:"getMembers",value:{orgId:a,userId:t,resource:"org",resourceId:a}})},create:function(t,r){if(u.isEmpty(t.userId))return{};var a=u.get(r,"org._id"),n=t.userId;return n instanceof Array||(n=[n]),n=u.uniq(n),r.enrollUsers=[],r.existingUsers=[],e.service("users").find({noFilter:!0,query:{$or:[{_id:{$in:n}},{"emails.address":{$in:u.map(n,u.toLower)}},{username:{$in:n}}],$select:["_id","emails","username","profile.name"]}}).then(function(o){var d=[],m=!0,g=!1,h=void 0;try{for(var v,y=(0,i.default)(n);!(m=(v=y.next()).done);m=!0)!function(){var n=v.value,i=u.find(o.data,function(e){return e._id===n||u.get(e,"emails[0].address")===u.toLower(n)||u.get(e,"emails[0].address")===n||e.username===n}),s={orgId:a,resource:"org",roles:[t.role||"member"],userId:u.get(i,"_id")||n,resourceId:a};if(i)r.existingUsers.push({_id:i._id,email:u.get(i,"emails[0].address"),name:u.get(i,"profile.name")}),d.push(e.service("aclManagement").create({action:"addMember",value:s}));else{if(!f.emailRegex.test(s.userId))throw new c.BadRequest(s.userId+" is not a valid email address.");d.push(l.uniquePropByService({prop:"username",value:u.toLower(u.split(s.userId,"@")[0]||""),service:e.service("users")}).then(function(t){return e.service("users").create({username:t,emails:[{address:s.userId}],resetExpires:Date.now()+2592e6,resetToken:p.secret(),isVerified:!0},{skipEmail:!0}).then(function(t){var a=u.get(t,"emails[0].address");return r.enrollUsers.push({_id:t._id,token:t.resetToken,email:a}),u.set(s,"userId",t._id),u.set(s,"email",a),e.service("aclManagement").create({action:"addMember",value:s})})}))}}()}catch(e){g=!0,h=e}finally{try{!m&&y.return&&y.return()}finally{if(g)throw h}}return s.default.all(d).then(function(e){return{aclRecords:u.reduce(e,function(e,t){var r=t.aclRecords;return e.concat(r)},[])}})})},patch:function(t,r,a){var n=u.get(a,"org._id"),i=u.get(a,"user"),o=r.role;if(i._id===t)throw new c.BadRequest("You cannot change your own role.");return e.service("users").find({noFilter:!0,query:{_id:t}}).then(function(r){var a=u.get(r,"data[0]");if(u.isEmpty(a.services)&&"owner"===o)throw new c.BadRequest("You can not promote not verified user to org owner.");return e.service("aclManagement").create({action:"isUser",value:{orgId:n,resource:"org",resourceId:n,userId:i._id,role:"owner"}}).then(function(r){if("owner"===o){if(!r)throw new c.BadRequest("You must be org owner promote member to the owner.");return e.service("aclManagement").create({action:"updateMember",value:{orgId:n,userId:i._id,resource:"org",resourceId:n,roles:["admin"]}}).then(function(){return e.service("aclManagement").create({action:"updateMember",value:{orgId:n,userId:t,resource:"org",resourceId:n,roles:["owner"]}})})}return e.service("aclManagement").create({action:"updateMember",value:{orgId:n,userId:t,resource:"org",resourceId:n,roles:[o]}})})})},remove:function(t,r){var a=u.get(r,"org._id"),n=u.get(r,"user");if(n._id===t)return e.service("aclManagement").create({action:"deleteMember",value:{orgId:a,userId:t,resource:"org",resourceId:a,currentUserId:n._id}});var i=[t];return u.isEmpty(t)&&(i=u.get(r,"query.userIds")),e.service("aclManagement").create({action:"canUser",value:{orgId:a,userId:n._id,slAdmin:n.slAdmin,resource:"org",resourceId:a,permission:"update:org:collaboration",throwError:!0}}).then(function(){var t=u.map(i,function(t){return e.service("aclManagement").create({action:"deleteMember",value:{orgId:a,userId:t,resource:"org",resourceId:a,currentUserId:n._id}})});return s.default.all(t).then(function(e){return{aclRecords:u.reduce(e,function(e,t){var r=t.aclRecords;return e.concat(r)},[])}})})}});var t=e.service("/orgs/:orgId/members");t.before(d.before),t.after(d.after)}},function(e,t,r){"use strict";var a=(r(0),r(9)),n=r(11),i=r(16),o=r(4),s=r(15),u=r(3),c=u.lookupOrg,d=r(10).hooks,l=["register","login","logout","new","new-org","settings","requests","collections","undefined","null",""],f=["orgs/:orgId/teams","orgs/:orgId/collections","orgs/:orgId/specs","orgs/:orgId/instances"];t.before={all:[],find:[o.hooks.authenticate(["jwt","apiSecret"]),d.listResources("org")],get:[o.hooks.authenticate(["jwt","apiSecret"],{optional:!0})],create:[o.hooks.authenticate(["jwt","apiSecret"]),s.generateSlug({target:"name",blacklist:l})],update:[a.disallow()],patch:[o.hooks.authenticate(["jwt","apiSecret"]),c(!1),d.canUser("update:org","org",!0),a.iff(function(e){return e.data.slug&&e.data.slug!==e.params.org.slug},s.generateSlug({target:"slug",blacklist:l}))],remove:[o.hooks.authenticate(["jwt","apiSecret"]),c(!1),d.canUser("delete:org","org",!0),d.removeRelated("org",f)]},t.after={all:[i.add(),n.filter()],find:[d.augmentWithPermissions(!0)],get:[d.canUser("read:org","org",!1),d.augmentWithPermissions(!0)],create:[d.addOwner("org"),d.augmentWithPermissions(!0)],update:[],patch:[d.augmentWithPermissions(!0)],remove:[d.augmentWithPermissions(!0)]}},function(e,t,r){"use strict";var a=r(13),n=r(85),i=r(83);e.exports=function(){var e=this,t={Model:n,lean:!0,overwrite:!1,paginate:{default:100,max:100},findOneQuery:function(e){return{$or:[{_id:e},{slug:e}]}}};e.use("/orgs",a(t));var r=e.service("/orgs");r.before(i.before),r.after(i.after)}},function(e,t,r){"use strict";var a=r(21),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(8),o=r(0),s=i.Schema,u=new s({plan:{type:String,default:"standard",enum:["standard","enterprise"]}},{_id:!1}),c=new s({plan:{type:String,default:"internal",enum:["internal","standard","pro"]}},{_id:!1}),d=new s({plan:{type:String,default:"atto",enum:["atto","nano","micro","kilo","mega","giga","tera","peta","exa"]}},{_id:!1}),l=new s({design:{type:u},teams:{type:d},documentation:{type:c}},{_id:!1}),f=new s({brand:{type:String},last4:{type:String},month:{type:Number},year:{type:Number}},{_id:!1}),p=new s({_id:{type:String},firstName:{type:String},lastName:{type:String},email:{type:String},card:{type:f},vat:{type:String}},{_id:!1}),m=new s({company:{type:String},address1:{type:String},address2:{type:String},city:{type:String},state:{type:String},zipcode:{type:String},country:{type:String}},{_id:!1}),g=new s({_id:{type:String},plan:{type:String},coupon:{type:s.Types.Mixed,default:{}},active:{type:Boolean,default:!0}},{_id:!1}),h=new s({reason:{type:String},updatedAt:{type:Date},locked:{type:Boolean,default:!1},count:{type:Number,default:0}},{_id:!1}),v=new s({name:{type:String,minLength:1,maxLength:255,required:!0},slug:{type:String,required:!0,minLength:3},summary:{type:String,maxLength:5e3},description:{type:String,maxLength:5e5},logoUrl:{type:String,maxLength:1e3},primaryColor:{type:String,maxLength:10},entityCount:{type:s.Types.Mixed,default:{users:1}},skipDrip:{type:Boolean,default:!1},resourcesOrder:{type:s.Types.Mixed,default:{docs:[]}},billingOwner:{type:String},billingProfile:{type:p},payeeProfile:{type:m},features:{type:l},subscriptions:{type:[g],default:[]},trialUntil:{type:Date},customPlan:{type:Boolean},standing:{type:h}},{timestamps:!0});v.plugin(n.default),v.statics.addVirtuals=function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.id=t.slug,t.urls={},t},v.statics.filter=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=["_id","id","name","slug","summary","logoUrl","primaryColor","urls","owner","createdAt","updatedAt"];return r.detailed&&(a=a.concat(["description"])),e.params.user&&(a=a.concat(["trialUntil"])),o.pick(t,a)};var y=i.model("org",v);e.exports=y},function(e,t,r){"use strict";var a=r(9),n=r(3),i=n.lookupOrg,o=n.lookupEntity,s=r(10).hooks,u=r(11),c=r(4);t.before=function(e){var t="team"===e?"team":"entity";return{all:[c.hooks.authenticate(["jwt","apiSecret"]),a.setSlug("orgId"),a.setSlug(e+"Id"),i(),o(e)],find:[s.canUser("read:"+t+":collaboration",e,!0)],get:[s.canUser("read:"+t+":collaboration",e,!0)],create:[s.canUser("update:"+t+":collaboration",e,!0)],update:[s.canUser("update:"+t+":collaboration",e,!0)],patch:[s.canUser("update:"+t+":collaboration",e,!0)],remove:[]}},t.after=function(){return{all:[s.populateMember(),u.filter()],find:[],get:[],create:[],update:[],patch:[],remove:[]}}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(2),i=a(n),o=r(5),s=a(o),u=r(0),c=r(6),d=r(86);e.exports=function(e){var t=u.trimEnd(e,"s");return function(){var r=this,a="/orgs/:orgId/"+e+"/:"+t+"Id/members";r.use(a,{find:function(e){return r.service("aclManagement").create({action:"getMembers",value:{orgId:u.get(e,"org._id"),resource:t,resourceId:u.get(e,t+"._id")}})},get:function(e,a){return r.service("aclManagement").create({action:"getMembers",value:{orgId:u.get(a,"org._id"),userId:e,resource:t,resourceId:u.get(a,t+"._id")}})},create:function(e,a){if(u.isEmpty(e.userId))throw new c.BadRequest("You need to specify one or more user emails.");var n=e.userId;return u.isArray(n)||(n=[n]),r.service("users").find({noFilter:!0,query:{$or:[{_id:{$in:n}},{username:{$in:n}},{"emails.address":{$in:u.map(n,u.toLower)}}],$select:["_id","username","emails"]}}).then(function(o){var c=[],d=function(n){return r.service("aclManagement").create({action:"addMember",value:{resource:t,resourceId:u.get(a,t+"._id"),roles:[e.role||"member"],userId:n._id,orgId:u.get(a,"org._id")}})},l=!0,f=!1,p=void 0;try{for(var m,g=(0,i.default)(n);!(l=(m=g.next()).done);l=!0)!function(){var e=m.value,t=u.find(o.data,function(t){return t._id===e||u.get(t,"emails[0].address")===u.toLower(e)||u.get(t,"emails[0].address")===e||t.username===e});t?c.push(d({_id:u.get(t,"_id")||e}).catch(function(t){if(t.message.includes("User should belong to the same org"))return r.service("/orgs/:orgId/members").create({userId:e},a).then(function(e){return d({_id:e._id})});throw t})):c.push(r.service("/orgs/:orgId/members").create({userId:e},a).then(function(e){return d({_id:e._id})}))}()}catch(e){f=!0,p=e}finally{try{!l&&g.return&&g.return()}finally{if(f)throw p}}return s.default.all(c).then(function(e){return{aclRecords:u.reduce(e,function(e,t){var r=t.aclRecords;return e.concat(r)},[])}})})},patch:function(e,a,n){var i=u.get(n,"org._id"),o=u.get(n,t+"._id"),s=u.get(n,"user"),d=u.get(a,"role","member");if(s._id===e)throw new c.BadRequest("You cannot change your own role.");return r.service("users").find({noFilter:!0,query:{_id:e}}).then(function(a){var n=u.get(a,"data[0]");if(u.isEmpty(n.services)&&"owner"===d)throw new c.BadRequest("You can not promote not verified user to owner.");var l={orgId:i,resource:t,resourceId:o,roles:u.isArray(d)?d:[d],userId:e};return r.service("aclManagement").create({action:"isUser",value:{orgId:i,resource:t,resourceId:o,role:"owner",userId:s._id}}).then(function(e){if("owner"===d){if(!e)throw new c.BadRequest("You must be the "+t+" owner to promote a member to owner.");return r.service("aclManagement").create({action:"updateMember",value:{orgId:i,resource:t,resourceId:o,roles:["admin"],userId:s._id}}).then(function(){return r.service("aclManagement").create({action:"updateMember",value:l})})}return r.service("aclManagement").create({action:"updateMember",value:l})})})},remove:function(e,a){var n=u.get(a,"org._id"),i=u.get(a,t+"._id"),o=u.get(a,"user"),c=[e];return u.isEmpty(e)&&(c=u.get(a,"query.userIds")),o._id===e?r.service("aclManagement").create({action:"deleteMember",value:{orgId:n,userId:o._id,resource:t,resourceId:i,currentUserId:o._id}}):r.service("aclManagement").create({action:"canUser",value:{orgId:n,resource:t,resourceId:i,userId:o._id,slAdmin:o.slAdmin,permission:"update:entity:collaboration",throwError:!0}}).then(function(){var e=u.map(c,function(e){return r.service("aclManagement").create({action:"deleteMember",value:{orgId:n,userId:e,resource:t,resourceId:i,currentUserId:o._id}})});return s.default.all(e).then(function(e){return{aclRecords:u.reduce(e,function(e,t){var r=t.aclRecords;return e.concat(r)},[])}})})}});var n=r.service(a);n.before(d.before(t)),n.after(d.after(t))}}},function(e,t,r){"use strict";var a=r(7),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=(r(1),r(0)),o=r(9),s=r(11),u=r(16),c=r(4),d=r(15),l=r(3),f=l.lookupOrg,p=l.lookupSpec,m=l.enableSearch,g=r(10).hooks;t.before={all:[o.setSlug("orgId"),f()],find:[c.hooks.authenticate(["jwt","apiSecret"],{optional:!0}),g.listResources("spec"),m()],get:[c.hooks.authenticate(["jwt","apiSecret"],{optional:!0})],create:[c.hooks.authenticate(["jwt","apiSecret"]),g.canUser("create:org:entity","org",!0),d.generateSlug({target:"name",query:function(e){return{orgId:i.get(e,"params.org._id")}}}),s.stringifyData({path:"data"})],update:[o.disallow()],patch:[c.hooks.authenticate(["jwt","apiSecret"]),o.setSlug("id"),o.setSlug("specId"),p(!1),g.canUser("update:entity","spec",!0),o.iff(function(e){return e.data.slug&&e.data.slug!==e.params.spec.slug},d.generateSlug({target:"slug",query:function(e){return{orgId:i.get(e,"params.org._id")}}}),function(e){return(0,n.default)({},e,{id:{$in:[e.id,e.data.slug]}})}),s.stringifyData({path:"data"})],remove:[c.hooks.authenticate(["jwt","apiSecret"]),p(!1),g.canUser("delete:entity","spec",!0),g.removeRelated("spec")]},t.after={all:[u.add(),s.parseResult({path:"data"})],find:[s.filter({detailed:!1}),g.augmentWithPermissions()],get:[s.filter(),g.canUser("read:entity","spec",!0),g.augmentWithPermissions()],create:[s.filter(),g.addOwner("spec"),g.addOrgEntity("spec"),g.addPublicEntity("spec"),g.augmentWithPermissions()],update:[],patch:[s.filter(),g.updateOrgEntity("spec"),g.updatePublicEntity("spec"),g.augmentWithPermissions()],remove:[s.filter(),g.augmentWithPermissions()]}},function(e,t,r){"use strict";var a=r(0),n=r(6),i=r(33).safeDump,o=r(13),s=r(1).safeParse,u=r(90),c=r(88);e.exports=function(){var e=this,t={Model:u,lean:!0,overwrite:!1,paginate:{default:100,max:100},findOneQuery:function(e,t,r){return{$or:[{_id:e},{orgId:r.orgId,slug:e}]}}};e.use("/orgs/:orgId/specs",o(t));var r=e.service("/orgs/:orgId/specs");r.before(c.before),r.after(c.after),e.get("/orgs/:orgId/specs/:specId/:fileName.:extension",function(t,o,u){var c=t.params,d=c.orgId,l=c.specId,f=c.fileName,p=c.extension,m=t.query,g=m.__token,h=m.__deref,v=f+"."+p,y=null;return h&&a.includes(["remote","all"],h)&&(y={remote:!0}),r.get(l,{orgId:d,dereference:y}).then(function(t){var r=s(t.data);return e.service("acl").find({query:{eId:t._id,aType:"public-entity"}}).then(function(e){if(!t.public&&!e.total){if(a.isEmpty(g))return u(new n.BadRequest("Please provide a spec token."));if(t.token!==g)return u(new n.NotAuthenticated("Invalid spec token."))}switch(v){case"export.json":case"oas2.json":case"oas.json":case"swagger2.json":case"swagger.json":return o.json(r);case"export.yaml":case"oas2.yaml":case"oas.yaml":case"swagger2.yaml":case"swagger.yaml":return o.set("content-type","text/yaml;charset=utf-8"),o.send(i(r));default:return u(new n.BadRequest(v+" export format is not supported."))}})})})}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(8),i=a(n),o=r(0),s=a(o),u=r(17),c=r(12),d=r(22),l=a(d),f=i.default.Schema,p=new f({},{timestamps:!0,collection:"specs"});p.plugin(l.default.global),p.plugin(l.default.connections),p.plugin(l.default.entity),p.statics.addVirtuals=function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],s.default.get(e,"requestedOrgId")),a=s.default.get(e,"params.org",{});return t.id=(t.orgSlug||a.slug)+"/specs/"+(t.slug||t._id),t.orgId=r||t.orgId,t.urls={export:(0,c.buildExportUrl)({entityType:"specs",entity:t,host:(0,u.getConfigVar)("HOST"),exportHost:(0,u.getConfigVar)("SL_EXPORT_HOST"),deref:"remote"})},t};var m=i.default.model("spec",p);e.exports=m},function(e,t,r){"use strict";var a=r(9),n=r(3),i=n.lookupOrg,o=n.lookupUser,s=n.lookupTeam,u=n.lookupEntity,c=r(10).hooks,d=r(11),l=r(4);t.before=function(e){return{all:[l.hooks.authenticate(["jwt","apiSecret"]),a.setSlug("orgId"),a.setSlug(e+"Id"),a.setSlug("teamId"),i(),u(e),s(),o()],find:[c.canUser("read:team","team",!0)],get:[c.canUser("read:team","team",!0)],create:[c.canUser("create:team:entity","team",!0),c.canUser("update:entity:collaboration",e,!0)],update:[a.disallow()],patch:[c.canUser("update:team","team",!0),c.canUser("update:entity:collaboration",e,!0)],remove:[c.canUser("update:team","team",!0)]}},t.after=function(e){return{all:[c.populateTeamEntity(e),d.filter()],find:[],get:[],create:[],update:[],patch:[],remove:[]}}},function(e,t,r){"use strict";var a=r(5),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(0),o=r(91);e.exports=function(e){var t=i.trimEnd(e,"s"),r=t+"Id";return function(){var a=this,s="/orgs/:orgId/teams/:teamId/"+e;a.use(s,{find:function(e){return a.service("aclManagement").create({action:"getTeamEntities",value:{orgId:i.get(e,"org._id"),teamId:i.get(e,"team._id"),entity:t}})},get:function(e,r){return a.service("aclManagement").create({action:"getTeams",value:{orgId:i.get(r,"org._id"),teamId:i.get(r,"team._id"),entity:t,entityId:e}})},create:function(e,o){if(i.isEmpty(e[r]))return{};var s=e[r];i.isArray(s)||(s=[s]);var u=i.map(s,function(r){return a.service("aclManagement").create({action:"addTeam",value:{orgId:i.get(o,"org._id"),entity:t,roles:[e.role||"member"],teamId:i.get(o,"team._id"),aType:t+"-team",entityId:r}})});return n.default.all(u).then(function(e){return{aclRecords:i.reduce(e,function(e,t){var r=t.aclRecords;return e.concat(r)},[])}})},patch:function(e,r,n){return a.service("aclManagement").create({action:"updateTeam",value:{orgId:i.get(n,"org._id"),teamId:i.get(n,"team._id"),entity:t,entityId:e,roles:[r.role]}})},remove:function(e,o){var s=[e];i.isEmpty(e)&&(s=i.get(o,"query."+r+"s"));var u=i.map(s,function(e){return a.service("aclManagement").create({action:"deleteTeam",value:{orgId:i.get(o,"org._id"),teamId:i.get(o,"team._id"),entity:t,entityId:e}})});return n.default.all(u).then(function(e){return{aclRecords:i.reduce(e,function(e,t){var r=t.aclRecords;return e.concat(r)},[])}})}});var u=a.service(s);u.before(o.before(t)),u.after(o.after(t))}}},function(e,t,r){"use strict";var a=r(0),n=r(9),i=r(3),o=i.lookupOrg,s=i.lookupTeam,u=r(11),c=r(16),d=r(4),l=r(15),f=r(10).hooks;t.before={all:[d.hooks.authenticate(["jwt","apiSecret"]),n.setSlug("orgId"),o()],find:[f.listResources("team")],get:[],create:[f.canUser("create:team","org",!0),l.generateSlug({target:"name",query:function(e){return{orgId:a.get(e,"params.org._id")}}}),l.addOwner()],update:[n.disallow()],patch:[s(!1),f.canUser("update:team","team",!0)],remove:[s(!1),f.canUser("delete:team","team",!0),f.removeRelated("team")]},t.after={all:[c.add(),u.filter()],find:[f.augmentWithPermissions()],get:[f.canUser("read:team","team",!0),f.augmentWithPermissions()],create:[f.addOwner("team"),function(e){var t=a.get(e,"data.members",[]);return a.isEmpty(t)?e:e.app.services["orgs/:orgId/teams/:teamId/members"].create({orgId:a.get(e,"result.orgId"),teamId:a.get(e,"result._id"),userId:t}).then(function(){return e}).then(function(){return e})},f.augmentWithPermissions()],update:[],patch:[f.augmentWithPermissions()],remove:[f.augmentWithPermissions()]}},function(e,t,r){"use strict";var a=r(13),n=r(95),i=r(93);e.exports=function(){var e=this,t={Model:n,lean:!0,overwrite:!1,paginate:{default:100,max:100},findOneQuery:function(e,t,r){return{orgId:r.orgId,$or:[{_id:e},{slug:e}]}}};e.use("/orgs/:orgId/teams",a(t));var r=e.service("/orgs/:orgId/teams");r.before(i.before),r.after(i.after)}},function(e,t,r){"use strict";var a=r(21),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(8),o=r(14),s=r(0),u=i.Schema,c=new u({_id:{type:String},name:{type:String,minLength:1,maxLength:50,required:!0},summary:{type:String,maxLength:5e3},slug:{type:String,required:!0,minLength:3,default:function(){return o.id(3).toLowerCase()}},orgId:{type:String,required:!0},orgSlug:{type:String,required:!0},owner:{type:String}},{timestamps:!0,collection:"teams"});c.plugin(n.default),c.statics.addVirtuals=function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],s.get(e,"requestedOrgId")),a=s.get(e,"params.org",{});return t.id=(t.orgSlug||a.slug)+"/teams/"+(t.slug||t._id),t.orgId=r||t.orgId,t.urls={},t},c.statics.filter=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.whitelist||["_id","id","name","slug","summary","urls","owner","orgId","createdAt","updatedAt"];return r.detailed&&(a=a.concat(["description"])),e.params.user,s.pick(t,a)};var d=i.model("team",c);e.exports=d},function(e,t,r){"use strict";var a=r(4);t.before={all:[a.hooks.authenticate(["jwt","apiSecret"])],find:[],get:[],create:[],update:[],patch:[],remove:[]},t.after={all:[],find:[],get:[],create:[],update:[],patch:[],remove:[]}},function(e,t,r){"use strict";var a=r(96),n=r(6),i=r(115),o=i.migrateTests,s=r(8);e.exports=function(){var e=this;e.use("/test/:versionId",{find:function(e,t){var r=e.versionId;return s.connection.db.collection("tests").find({environment:e.versionId}).toArray(function(e,a){return e||!a.length?t(new n.NotFound("Can not find test for environment, "+r+".")):t(null,o(a))})}});var t=e.service("/test/:versionId");t.before(a.before),t.after(a.after)}},function(e,t,r){"use strict";var a=r(4);t.before={all:[a.hooks.authenticate(["jwt","apiSecret"])],find:[]},t.after={all:[],find:[]}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(7),i=a(n),o=r(2),s=a(o),u=r(5),c=a(u),d=r(0),l=r(98),f=r(3);e.exports=function(){var e=this;e.use("/users/:userId/:entityType",{find:function(t){var r=f.getProp({params:t},"entityType"),a=d.isArray(r)?r:[r],n=f.getProp({params:t},"orgId"),o={};return n&&(o={$or:[{_id:n},{slug:n}]}),e.service("orgs").find({paginate:{default:2147483648,max:2147483648},query:o}).then(function(r){var n=[],o=!0,u=!1,l=void 0;try{for(var f,p=(0,s.default)(r.data);!(o=(f=p.next()).done);o=!0)!function(){var r=f.value,o=!0,u=!1,l=void 0;try{for(var p,m=(0,s.default)(a);!(o=(p=m.next()).done);o=!0)!function(){var a=p.value,o=(0,i.default)({orgId:r._id,public:d.get(t,"query.public")||!1},d.pick(t.query,["$limit","$skip","$sort"]));for(var s in t.query)t.query[s].$search&&(o[s]=t.query[s]);n.push(e.service("orgs/:orgId/"+a).find((0,i.default)({},t,{query:o})).then(function(e){var t=e.data,n=d.map(t,function(e){return{_id:e._id,name:e.name,id:e.orgSlug+"/"+a+"/"+e.slug,orgId:r._id,entityType:a,public:d.isEmpty(e.acl.org)&&d.isEmpty(e.acl.user)&&!d.isEmpty(e.acl.public)}});return c.default.resolve(n)}))}()}catch(e){u=!0,l=e}finally{try{!o&&m.return&&m.return()}finally{if(u)throw l}}}()}catch(e){u=!0,l=e}finally{try{!o&&p.return&&p.return()}finally{if(u)throw l}}return c.default.all(n).then(function(e){var t=d.flattenDeep(e)||[];return c.default.resolve({data:d.uniqBy(t,"_id"),total:t.length})})})}});var t=e.service("/users/:userId/:entityType");t.before(l.before),t.after(l.after)}},function(e,t,r){"use strict";var a=r(0),n=r(9),i=r(6),o=r(8),s=r(15),u=r(11),c=r(16),d=r(36),l=r(4),f=r(43).hooks,p=r(35).hooks,m=(r(10).hooks,function(e){return a.has(e.data,"password")}),g=function(e){var t=a.get(e,"profile.emails");return{email:a.find(t,{primary:!0}).value,id:a.get(e,"profile.id"),username:a.get(e,"profile.username"),emails:a.get(e,"profile.emails"),accessToken:e.accessToken}};t.before={all:[n.setSlug("userId")],find:[n.disallow("external"),l.hooks.authenticate(["jwt","local"]),l.hooks.restrictToAuthenticated(),l.hooks.populateUser()],get:[l.hooks.authenticate(["jwt","local"]),l.hooks.restrictToAuthenticated(),l.hooks.restrictToOwner({ownerField:"_id"}),l.hooks.populateUser()],create:[function(e){var t=process.env.ENTERPRISE_TEAM_SIZE||e.app.get("ENTERPRISE_TEAM_SIZE");if(t)return o.connection.db.collection("users").count().then(function(e){if(e>=t)throw new i.BadRequest("Your enterprise license only allows "+t+" members, contact support@stoplight.io for help.")})},function(e){a.get(e,"data.slAdmin")&&a.set(e,"data.slAdmin",void 0)},function(e){var t=a.get(e,"data.github");if(t){var r=g(t);e.params.skipEmail=!0,e.params.skipVerification=!0,e.data={"emails.0.address":r.email,"emails.0.verified":!0,isVerified:!0,username:a.get(t,"profile.username"),"profile.name":a.get(t,"profile.displayName"),services:{github:r}}}return e},s.generateSlug({prop:"username",target:"username"}),n.iff(n.isProvider("external"),d.hashPassword()),n.unless(function(e){return e.params.skipVerification},f.addVerification())],update:[function(e){a.get(e,"data.slAdmin")&&a.set(e,"data.slAdmin",void 0)},function(e){return e.data["services.github.id"]&&(a.set(e,"data.services.github",g(e.data.github)),delete e.data.github,delete e.data["services.github.id"]),e},n.disallow("external"),l.hooks.authenticate(["jwt","local"]),n.iff(n.isProvider("external")&&m,d.hashPassword()),l.hooks.restrictToAuthenticated(),l.hooks.restrictToOwner({ownerField:"_id"}),l.hooks.populateUser()],patch:[function(e){a.get(e,"data.slAdmin")&&a.set(e,"data.slAdmin",void 0)},l.hooks.authenticate(["jwt","local"]),n.iff(n.isProvider("external")&&m,d.hashPassword()),l.hooks.restrictToAuthenticated(),l.hooks.restrictToOwner({ownerField:"_id"}),l.hooks.populateUser()],remove:[l.hooks.authenticate(["jwt","local"]),l.hooks.restrictToAuthenticated(),l.hooks.restrictToOwner({ownerField:"_id"}),l.hooks.populateUser()]},t.after={all:[c.add(),u.filter({detailed:!0}),s.extendWith()],find:[],get:[],create:[p.sendVerificationEmail()],update:[],patch:[],remove:[]}},function(e,t,r){"use strict";var a=r(13),n=r(102),i=r(100);e.exports=function(){var e=this,t={Model:n,lean:!0,overwrite:!1,paginate:{default:100,max:100},findOneQuery:function(e){return{$or:[{_id:e},{username:e}]}}};e.use("/users",a(t));var r=e.service("/users");r.before(i.before),r.after(i.after)}},function(e,t,r){"use strict";var a=r(22),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(14),o=r(8),s=r(0),u=o.Schema,c=new u({brand:{type:String},last4:{type:String},month:{type:Number},year:{type:Number}}),d=new u({_id:{type:String},firstName:{type:String,default:""},lastName:{type:String,default:""},email:{type:String,lowercase:!0,default:""},card:{type:c},postal_code:{type:String},vat:{type:String}}),l=new u({company:{type:String},address1:{type:String},address2:{type:String},city:{type:String},state:{type:String},zipcode:{type:String},country:{type:String}}),f=new u({_id:{type:String},plan:{type:String},coupon:{type:Object,default:{}},active:{type:Boolean,default:!0}}),p=new u({name:{type:String,default:"",min:1,max:255},company:{type:String,max:255},readStamps:{type:Object,default:{}},welcomeRead:{type:Boolean}},{_id:!1}),m=new u({address:{type:String,lowercase:!0,required:!0},verified:{type:Boolean,default:!1}}),g=new u({name:{type:String},access_token:{type:String},token_type:{type:String},scope:{type:String}},{_id:!1}),h=new u({username:{type:String,required:!0,unique:!0,min:2,max:20},emails:{type:[m],default:[]},profile:{type:p,default:{}},services:{type:u.Types.Mixed,default:{}},betaFeatures:{type:[String]},slAdmin:{type:Boolean},utm_source:{type:String},utm_medium:{type:String},referredBy:{type:String},referrals:{type:[String]},apiSecret:{type:String,default:function(){return i.id()}},feedback:{type:Number},feedbackThreshold:{type:Number,default:0},billingProfile:{type:d},payeeProfile:{type:l},features:{type:u.Types.Mixed,default:{design:{plan:"standard"},teams:{plan:"atto"},documentation:{plan:"inernal"}}},subscriptions:{type:[f]},trialUntil:{type:Date},tutorials:{type:Object},customPlan:{type:Boolean},roles:{type:Object},isVerified:{type:Boolean},verifyToken:{type:String},verifyExpires:{type:Date},verifyChanges:{type:u.Types.Mixed,default:{}},resetToken:{type:String},resetExpires:{type:Date},oauth2AccessTokens:{type:[g],default:[]},lastOauth2Config:{type:u.Types.Mixed,default:{}}},{timestamps:!0,collection:"users"});h.path("slAdmin").validate(function(e){return!e},"You can't make yourself and admin."),h.plugin(n.default.global),h.plugin(n.default.errors),h.statics.addVirtuals=function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.id="users/"+t.username,t.urls={},t},h.statics.filter=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.whitelist;return s.isEmpty(a)&&(a=["_id","id","username","urls"],r.detailed&&(a=a.concat(["profile","emails","oauth2AccessTokens","slAdmin"])),e.params.user&&(a=a.concat(["apiSecret","emails"]))),s.pick(t,a)};var v=o.model("user",h);e.exports=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validator=t.schema=void 0;var a=r(25),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=t.schema={$async:!0,type:"object",properties:{}},o=new n.default;t.validator=o.compile(i)},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.migrateScript=t.migrateStep=t.migrateScenario=t.migrateCollection=t.notes=void 0;var n=r(28),i=a(n),o=r(0),s=a(o),u=r(150),c=a(u),d=r(1),l=c.default.types.builders;t.notes=["General: Scripting is built around getters and setters now.","General: Variable replacement requires brackets now, ie {$.ctx.foo}, not $.ctx.foo","General: Change $.env to $$.env","Scripting: Change $.ctx.foo = 'bar' to $.ctx.set('foo', 'bar')","Scripting: Change $.env.foo = 'bar' to $$.env.set('foo', 'bar')","Scripting: Change input.body.nested.prop = 'bar' to input.body.set('nested.prop', 'bar')","Scripting: Change output.body.foo = 'bar' to output.body.set('foo', 'bar')"],t.migrateCollection=function(e){return e.collection},t.migrateScenario=function(e){return e.scenario},t.migrateStep=function(e){var t=e.step,r=/\"(\$\.(?:env|ctx)+[a-zA-Z\[\].']+)(\\|\")/g,a=(0,d.safeStringify)(t.input);a=s.default.replace(a,r,'"{$1}$2'),t.input=(0,d.safeParse)(a);var n=/(\$\.(?:env|ctx)+[a-zA-Z\[\].']+)/g,o=s.default.get(t,"after.assertions");if(!s.default.isEmpty(o))for(var u in o)o[u].hasOwnProperty("expected")&&"string"==typeof o[u].expected&&(o[u].expected.match("{")||s.default.set(t,["after","assertions",u,"expected"],s.default.replace(o[u].expected,n,"{$1}")));var c=/\$\.env/g,l=(0,i.default)(t);l=l.replace(c,"$$$.env");var f=/\$\$\$\.env/g;return l=l.replace(f,"$$$.env"),t=JSON.parse(l)},t.migrateScript=function(e){var t=e.script,r=t,a=c.default.parse(t);return c.default.visit(a,{visitAssignmentExpression:function(e){var t=s.default.get(e,"value.operator"),r=s.default.get(e,"value.left.object"),a=r.object||{},n=r.property||{};if("="===t&&s.default.includes(["$","$$","input","output"],a.name)&&s.default.includes(["ctx","env","body","headers","method","url","status"],n.name)){var i=l.identifier("set"),o=l.memberExpression(l.memberExpression(a,n),i);return e=l.callExpression(o,[s.default.get(e,"value.left.property.name")?l.literal(s.default.get(e,"value.left.property.name")):s.default.get(e,"value.left.property"),s.default.get(e,"value.right.value")?l.literal(s.default.get(e,"value.right.value")):s.default.get(e,"value.right")])}if("="===t&&s.default.includes(["$","$$","input","output"],r.name)){var u=l.identifier("set"),c=l.memberExpression(l.memberExpression(r,s.default.get(e,"value.left.property")),u);return e=s.default.get(e,"value.right.value")?l.callExpression(c,[l.literal(s.default.get(e,"value.right.value"))]):l.callExpression(c,[s.default.get(e,"value.right")])}console.log("NOT HANDLED",r),console.log("********************************"),this.traverse(e)}}),r=c.default.print(a).code,r=s.default.replace(r,/\= (\$\.ctx|\$\$\.env|input|output)\.([a-zA-Z0-9_\-\.]+)/g,function(e,t,r,a,n){return e.match(".get")?e:"= "+t+".get('"+r+"')"}),r=s.default.replace(r,/\= (\$\.ctx|\$\$\.env|input|output)\[(['"a-zA-Z0-9_\-\.]+)\]/g,function(e,t,r,a,n){return e.match(".get")?e:"= "+t+".get("+r+")"}),r=s.default.replace(r,/(\$\.ctx|\$\$\.env|input|output)\.([a-zA-Z0-9_\-\.]+) \+/g,function(e,t,r,a,n){return e.match(".get")?e:t+".get('"+r+"') +"}),r=s.default.replace(r,/(\$\.ctx|\$\$\.env|input|output)\[(['"a-zA-Z0-9_\-\.]+)\] \+/g,function(e,t,r,a,n){return e.match(".get")?e:t+".get("+r+") +"}),r=s.default.replace(r,/\+ (\$\.ctx|\$\$\.env|input|output)\.([a-zA-Z0-9_\-\.]+)/g,function(e,t,r,a,n){return e.match(".get")?e:"+ "+t+".get('"+r+"')"}),r=s.default.replace(r,/\+ (\$\.ctx|\$\$\.env|input|output)\[(['"a-zA-Z0-9_\-\.]+)\]/g,function(e,t,r,a,n){return e.match(".get")?e:"+ "+t+".get("+r+")"}),r=s.default.replace(r,/, (\$\.ctx|\$\$\.env|input|output)\.([a-zA-Z0-9_\-\.]+)/g,function(e,t,r,a,n){return e.match(".get")?e:", "+t+".get('"+r+"')"}),r=s.default.replace(r,/, (\$\.ctx|\$\$\.env|input|output)\[(['"a-zA-Z0-9_\-\.]+)\]/g,function(e,t,r,a,n){return e.match(".get")?e:", "+t+".get('"+r+"')"}),r=s.default.replace(r,/(\$\.ctx|\$\$\.env|input|output)\.([a-zA-Z0-9_\-\.]+),/g,function(e,t,r,a,n){return e.match(".get")?e:t+".get('"+r+"'),"}),r=s.default.replace(r,/(\$\.ctx|\$\$\.env|input|output)\[(['"a-zA-Z0-9_\-\.]+)\],/g,function(e,t,r,a,n){return e.match(".get")?e:t+".get('"+r+"'),"}),r=s.default.replace(r,/(\$\.ctx|\$\$\.env|input|output)\.([a-zA-Z0-9_\-\.]+)\n/g,function(e,t,r,a,n){return e.match(".get")?e:t+".get('"+r+"')\n"}),r=s.default.replace(r,/(\$\.ctx|\$\$\.env|input|output)\[(['"a-zA-Z0-9_\-\.]+)\]\n/g,function(e,t,r,a,n){return e.match(".get")?e:t+".get('"+r+"')\n"}),r=s.default.replace(r,/\((\$\.ctx|\$\$\.env|input|output)\.([a-zA-Z0-9_\-\.]+)\)/g,function(e,t,r,a,n){return e.match(".get")?e:"("+t+".get('"+r+"'))"}),r=s.default.replace(r,/\((\$\.ctx|\$\$\.env|input|output)\[(['"a-zA-Z0-9_\-\.]+)\]\)/g,function(e,t,r,a,n){return e.match(".get")?e:"("+t+".get('"+r+"'))"})}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.migrateScript=t.migrateStep=t.migrateScenario=t.migrateCollection=t.notes=void 0;var n=r(0),i=a(n),o=r(20),s=a(o),u=r(1),c=(t.notes=["General: Flatten before and after properties, and convert them from arrays to objects.","General: Convert scenarios and utilities properties from arrays to objects.","General: Remove id property on all scenarios (id is the object key now)."],t.migrateCollection=function(e){var t=e.collection,r=(0,u.safeStringify)(t);r=r.replace(/\"ref\":/g,'"$ref":');var a=(0,u.safeParse)(r),n={};return a.before&&(n=c({scenarios:a.before.scenarios})),a.before=n||{},n={},a.after&&(n=c({scenarios:a.after.scenarios})),a.after=n,a.scenarios=c({scenarios:a.scenarios}),a.utilities=c({scenarios:a.utilities}),n={},a.done&&(n=c({scenarios:a.done.scenarios})),a.done=n,a},function(e){var t=e.scenarios;return t instanceof Array?i.default.keyBy(t,function(e){return e.id?e.id:s.default.generate().substring(0,5).toLowerCase()}):t||{}});t.migrateScenario=function(e){var t=e.scenario;return delete t.id,t},t.migrateStep=function(e){return e.step},t.migrateScript=function(e){return e.script}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.exportService=void 0;var n=r(0),i=a(n),o=r(6),s=a(o),u=r(33),c=r(1),d=r(12),l=r(27),f=function(e){var t=e.extension,r=e.data,a=e.res,n=e.next;switch(t){case"json":return a.json(r);case"yaml":return a.set("content-type","text/yaml;charset=utf-8"),a.send((0,u.safeDump)(r));default:return n(new s.default.BadRequest(t+" export format is not supported."))}};t.exportService=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.data,a=e.token,n=e.entityType,o=e.isPublic,u=e.extension,p=e.res,m=e.next,g=t.__token,h=t.__deref;if(!o){if(i.default.isEmpty(g))return m(new s.default.BadRequest("Please provide a token."));if(a!==g)return m(new s.default.NotAuthenticated("Invalid spec token."))}var v=(0,c.safeParse)(r);return v=(0,d.cleanEntity)(n,v),h?(0,l.dereference)(v,{remote:!0}).then(function(e){return f({extension:u,res:p,next:m,data:e})}):f({extension:u,res:p,next:m,data:v})}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.harToSwagger2=t.collectionResultToHar=void 0;var n=r(18),i=a(n),o=r(0),s=a(o),u=r(50),c=a(u),d=r(49),l=a(d),f=r(34),p=a(f),m=r(1),g=r(39),h=r(41),v=r(42),y=(t.collectionResultToHar=function(e){var t=e.result,r=void 0===t?{}:t,a={entries:[]},n=r.scenarios,i=void 0===n?{}:n;return s.default.forEach(i,function(e){var t=e.steps,r=void 0===t?[]:t;s.default.forEach(r,function(e){var t=e.input,r=void 0===t?{}:t,n=e.output,i=void 0===n?{}:n,o=void 0,u={};try{o=new c.default(r.url),s.default.isEmpty(o.query)||(u=l.default.parse(o.query.slice(1)))}catch(e){return void console.warn("invalid url",r.url)}var d={request:{method:r.method,url:o.origin+o.pathname}};if(s.default.isEmpty(r.headers)||(d.request.headers=s.default.map(r.headers,function(e,t){return{name:t,value:e}})),s.default.isEmpty(u)||(d.request.queryString=s.default.map(u,function(e,t){return{name:t,value:e}})),!s.default.isEmpty(r.body)){d.request.postData={};var f=s.default.get(r,"headers.Content-Type","");if(f&&(d.request.postData.mimeType=r.headers["Content-Type"]),f.match(/javascript|json/g))d.request.postData.text=(0,m.safeStringify)(r.body,r.body);else{var p=(0,m.safeParse)(r.body);d.request.postData.params=s.default.map(p,function(e,t){return{name:t,value:e}})}}if(!s.default.isEmpty(i)&&(d.response={status:i.status},s.default.isEmpty(i.headers)||(d.response.headers=s.default.map(i.headers,function(e,t){return{name:t,value:e}})),!s.default.isEmpty(i.body))){d.response.content={};s.default.get(i,"headers.Content-Type","")&&(d.response.content.mimeType=i.headers["Content-Type"]),d.response.content.text=(0,m.safeStringify)(i.body,i.body)}a.entries.push(d)})}),a},["Content-Type","Cache-Control","Connection","Content-Length","Date","Etag","Server","Via"]),I=function(e){var t=e.targetLocation,r=e.targetValue,a=e.parameters,n=void 0===a?[]:a,o=e.extraProps,u=void 0===o?{}:o;return s.default.forEach(r,function(e){var r=e.name,a=e.value;if(!s.default.includes(y,r)&&!s.default.startsWith(r,"X-")){var o=s.default.findIndex(n,{in:t,name:r}),c=n[o]||{in:t,name:r};c.type=(0,i.default)((0,m.safeParse)(a,a)),s.default.merge(c,u),o<0?n.push(c):n[o]=c}}),n};t.harToSwagger2=function(e){var t=e.existingSpec,r=void 0===t?{}:t,a=e.har,n=void 0===a?{}:a,o={paths:{}},u=n.entries,d=void 0===u?[]:u;return s.default.forEach(d,function(e){var t=e.request,a=void 0===t?{}:t,n=a.headers,u=void 0===n?[]:n,d=a.queryString,l=void 0===d?[]:d,f=a.postData,b=void 0===f?{}:f,_=s.default.toLower(a.method),w=void 0,S=void 0;try{w=new c.default(a.url),S=(0,v.parseDynamicParams)({url:w.pathname||"/"})}catch(e){return void console.warn("invalid url",a.url)}if(_&&w){if(!s.default.isEmpty(r)){var x=(0,v.getEndpointFromSpec)({spec:{data:r},url:w});x&&x.path&&(S=x.path)}var E=s.default.get(r,["paths",S])||s.default.get(o,["paths",S])||{},T=s.default.get(E,[_])||s.default.get(o,[_])||{},P=s.default.first((b.mimeType||s.default.get(s.default.find(u,{name:"Content-Type"}),"value","")).split(";"));if(P&&(o.consumes=o.consumes||[],o.consumes.push(P),o.consumes=s.default.uniq(o.consumes)),s.default.isEmpty(l)||(T.parameters=I({targetLocation:"query",targetValue:l,parameters:T.parameters})),s.default.isEmpty(b.params)){if(!s.default.isEmpty(b.text)){T.parameters=T.parameters||[];var k=s.default.findIndex(T.parameters,{in:"body"}),q=T.parameters[k]||{in:"body",name:"body"},O=(0,m.safeParse)(b.text,b.text),R={};try{R=(0,p.default)(JSON.parse(b.text))}catch(e){}q.schema?q.schema=(0,h.extendSchema)({base:q.schema,extend:R,extendIsSchema:!0}):q.schema=R,P&&!s.default.isEmpty(O)&&(s.default.get(q,["x-examples",P])||s.default.set(q,["x-examples",P],(0,g.pruneObject)(O))),k<0?T.parameters.push(q):T.parameters[k]=q}}else T.parameters=I({targetLocation:"formData",targetValue:b.params,parameters:T.parameters});var A=e.response,$=void 0===A?{}:A;if(!s.default.isEmpty($)&&$.status){var M=s.default.find($.headers,{name:"Content-Type"}),j=s.default.get($,"content.mimeType")||s.default.first(s.default.split(s.default.get(M,"value",""),";"));j&&(o.produces=o.produces||[],o.produces.push(j),o.produces=s.default.uniq(o.produces));var U=s.default.get(T,["responses",$.status])||{description:""};s.default.isEmpty($.headers)||(U.headers=U.headers||{},s.default.forEach($.headers,function(e){var t=e.name,r=e.value;if(!s.default.includes(y,t)&&!s.default.startsWith(t,"X-")){var a=U.headers[t]||{};a.type&&"null"!==a.type||(a.type=(0,i.default)((0,m.safeParse)(r,r))),U.headers[t]=a}}),s.default.isEmpty(U.headers)&&delete U.headers);var N=s.default.get($,"content.text");N=(0,m.safeParse)(N,N);try{var C={};C=(0,p.default)(JSON.parse(s.default.get($,"content.text"))),U.schema?U.schema=(0,h.extendSchema)({base:U.schema,extend:C,extendIsSchema:!0}):U.schema=C}catch(e){}j&&!s.default.isEmpty(N)&&(s.default.get(U,["examples",j])||s.default.set(U,["examples",j],(0,g.pruneObject)(N))),T.responses=T.responses||{},s.default.set(T,["responses",$.status],U)}var F=(0,v.computePathParamsFromUri)(S);if(!s.default.isEmpty(F)){var L=I({targetLocation:"path",targetValue:F,parameters:E.parameters,extraProps:{type:"string",required:!0}});s.default.isEmpty(L)||s.default.set(o,["paths",S,"parameters"],L)}s.default.set(o,["paths",S,_],T)}}),o}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.validateInstance=t.routeRequest=t.matchRules=t.isRuleMatch=t.matchApi=t.isApiMatch=t.sortConfigBlocks=t.configBlockScore=t.cleanInstance=t.cleanApi=t.cleanRule=t.ruleTip=t.newRule=t.ruleName=t.apiTip=t.newApi=t.apiName=void 0;var n=r(2),i=a(n),o=r(0),s=a(o),u=r(20),c=a(u),d=r(25),l=(a(d),r(24)),f=(r(109),t.apiName=function(e){var t=e.api;return(void 0===t?{}:t).id||"no-id"},t.newApi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id;e.steps;return{id:t||c.default.generate().substring(0,5).toLowerCase()}},t.apiTip=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[];return s.default.isEmpty(e.methods)&&s.default.isEmpty(e.hosts)&&s.default.isEmpty(e.paths)?t.push({text:"Matches all requests"}):(t.push({text:"Matches all"}),s.default.isEmpty(e.methods)||t.push({text:e.methods.map(function(e){return s.default.toUpper(e)}).join(", "),className:"fw-b fd-u sl-get-color"}),t.push({text:"requests"}),s.default.isEmpty(e.hosts)||(t.push({text:"to"}),t.push({text:e.hosts.join(", "),className:"fw-b fd-u sl-post-color"})),s.default.isEmpty(e.paths)||(t.push({text:"that start with"}),t.push({text:e.paths.join(", "),className:"fw-b fd-u sl-patch-color"}))),e.upstream_url&&(t.push({text:"and forwards them to"}),t.push({text:e.upstream_url,className:"fw-b fd-u sl-copy-color"})),t},t.ruleName=function(e){var t=e.rule;return(void 0===t?{}:t).id||"no-id"},t.newRule=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id;e.steps;return{id:t||c.default.generate().substring(0,5).toLowerCase(),before:{},after:{},done:{}}},t.ruleTip=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[];return s.default.isEmpty(e.methods)&&s.default.isEmpty(e.paths)?t.push({text:"Matches all requests"}):(t.push({text:"Matches all"}),s.default.isEmpty(e.methods)||t.push({text:e.methods.map(function(e){return s.default.toUpper(e)}).join(", "),className:"fw-b fd-u sl-get-color"}),t.push({text:"requests"}),s.default.isEmpty(e.paths)||(t.push({text:"that start with"}),t.push({text:e.paths.join(", "),className:"fw-b fd-u sl-patch-color"}))),s.default.isEmpty(e.apis)||(t.push({text:"that also match the"}),t.push({text:e.apis.join(", "),className:"fw-b fd-u sl-copy-color"}),t.push({text:1===e.apis.length?"api block":"api blocks"})),t},t.cleanRule=function(e){var t=e.rule,r=void 0===t?{}:t;return r=s.default.pick(r,["id","apis","methods","paths","before","after","done"])}),p=t.cleanApi=function(e){var t=e.api,r=void 0===t?{}:t;return r=s.default.pick(r,["id","upstream_url","methods","hosts","paths","specs"])},m=(t.cleanInstance=function(e){var t=e.instance,r=void 0===t?{}:t;r=s.default.pick(r,["description","apis","rules","scenarios"]),r.apis=r.apis||{};for(var a in r.apis)if(r.apis[a]){var n=r.apis[a];s.default.set(r,["apis",a],p({api:n}))}r.rules=r.rules||{};for(var i in r.rules)if(r.rules[i]){var o=r.rules[i];s.default.set(r,["rules",i],f({rule:o}))}return r},t.configBlockScore=function(e){var t=e.block,r=0;return s.default.isEmpty(t.methods)||(r+=1),s.default.isEmpty(t.hosts)||(r+=1),s.default.isEmpty(t.paths)||(r+=1),s.default.isEmpty(t.apis)||(r+=1),t.exclusive&&(r+=1),r}),g=t.sortConfigBlocks=function(e){var t=e.blocks,r=void 0===t?[]:t,a=[];for(var n in r)a.push({score:m({block:r[n]}),index:n,block:r[n]});return s.default.map(s.default.orderBy(a,["score","index"],["desc","asc"]),"block")},h=t.isApiMatch=function(e){var t=e.method,r=e.urlData,a=void 0===r?{}:r,n=e.api,i=void 0===n?{}:n;return!(!s.default.isEmpty(i.methods)&&!s.default.includes(i.methods,t))&&(!(!s.default.isEmpty(i.hosts)&&!s.default.includes(i.hosts,a.host))&&!(!s.default.isEmpty(i.paths)&&!s.default.includes(i.paths,a.pathname)))},v=t.matchApi=function(e){var t=e.method,r=e.url,a=e.apis,n=void 0===a?[]:a,o=null,s=void 0;r&&(s=(0,l.createURL)(r));var u=g({blocks:n}),c=!0,d=!1,f=void 0;try{for(var p,m=(0,i.default)(u);!(c=(p=m.next()).done);c=!0){var v=p.value;if(h({method:t,urlData:s,api:v})){o=v;break}}}catch(e){d=!0,f=e}finally{try{!c&&m.return&&m.return()}finally{if(d)throw f}}return o},y=t.isRuleMatch=function(e){var t=e.method,r=e.urlData,a=void 0===r?{}:r,n=e.api,i=void 0===n?{}:n,o=e.rule,u=void 0===o?{}:o;return!(!s.default.isEmpty(u.apis)&&!s.default.includes(u.apis,s.default.get(i,"id")))&&(!(!s.default.isEmpty(u.methods)&&!s.default.includes(u.methods,t))&&(!(!s.default.isEmpty(u.hosts)&&!s.default.includes(u.hosts,a.host))&&!(!s.default.isEmpty(u.paths)&&!s.default.find(u.paths,function(e){return s.default.startsWith(a.pathname,e)}))))},I=t.matchRules=function(e){var t=e.method,r=e.url,a=e.api,n=e.rules,o=void 0===n?[]:n,u=[],c=void 0;r&&(c=(0,l.createURL)(r));var d=g({blocks:o}),f=!0,p=!1,m=void 0;try{for(var h,v=(0,i.default)(d);!(f=(h=v.next()).done);f=!0){var I=h.value;if(!s.default.isEmpty(I)&&y({method:t,urlData:c,api:a,rule:I})){if(I.exclusive){u=[I];break}u.push(I)}}}catch(e){p=!0,m=e}finally{try{!f&&v.return&&v.return()}finally{if(p)throw m}}return u};t.routeRequest=function(e){var t=e.method,r=e.url,a=e.apis,n=void 0===a?[]:a,i=e.rules,o=void 0===i?[]:i,s=v({method:t,url:r,apis:n});return{api:s,rules:I({method:t,url:r,api:s,rules:o})}},t.validateInstance=function(e){e.instance}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validator=t.schema=void 0;var a=r(25),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=t.schema={$async:!0,type:"object",properties:{}},o=new n.default;t.validator=o.compile(i)},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!==e&&t!==t}function i(e,t){if(n(e,t))return!0;if("object"!==(void 0===e?"undefined":(0,c.default)(e))||null===e||"object"!==(void 0===t?"undefined":(0,c.default)(t))||null===t)return!1;var r=(0,s.default)(e),a=(0,s.default)(t);if(r.length!==a.length)return!1;for(var i=0;i<r.length;i++)if(!d.call(t,r[i])||!n(e[r[i]],t[r[i]]))return!1;return!0}var o=r(19),s=a(o),u=r(18),c=a(u),d=Object.prototype.hasOwnProperty;e.exports=i},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.route=t.build=void 0;var n=r(30),i=a(n),o=r(2),s=a(o),u=r(0),c=a(u),d=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments[2],n=[r[0]],i=r.slice(1);if(r[0]instanceof RegExp)if(n.unshift("__regexs"),c.default.isEmpty(i))c.default.set(t,n,{__matcher:r[0],__data:a});else{var o=c.default.get(t,n);o?o.__routes=o.__routes||{}:o={__matcher:r[0],__routes:{}},c.default.set(t,n,o),e(o.__routes,i,a)}else if(c.default.isEmpty(i))c.default.set(t,n.concat(["__data"]),a);else{var s=c.default.get(t,n,{});c.default.set(t,n,s),e(s,i,a)}},l=(t.build=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],{}),r=!0,a=!1,n=void 0;try{for(var o,u=(0,s.default)(e);!(r=(o=u.next()).done);r=!0){var l=(0,i.default)(o.value,2),f=l[0],p=l[1];c.default.isEmpty(f)?t.__root={__data:p}:d(t,f,p)}}catch(e){a=!0,n=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw n}}return t},function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(t&&c.default.isEmpty(r))return c.default.get(t,"__root.__data");var a=r[0];if(!a)return null;var n=t[a],i=n;if(!n&&t.__regexs)for(var o in t.__regexs)if(a.match(t.__regexs[o].__matcher)){n=t.__regexs[o],i=t.__regexs[o].__routes;break}var s=r.slice(1);return n&&c.default.isEmpty(s)?n.__data:i?e(i,s):null});t.route=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.delimiter,n=void 0===a?"/":a,i=void 0;if(t instanceof Array)i=t;else{i=c.default.trim(t,"#/").split(n)}return l(e,i)}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.schemaMerger=t.markFieldsRequired=t.resolveSchema=t.publicJSON=t.findSchemaByRef=t.findPropertyByRef=t.uniqueByNamespace=t.dereferenceSchema=t.extendSchema=t.buildExampleFromSchema=t.fakeExampleFromSchema=t.parseYamlOrJson=t.isValidJSON=t.isSchemaEmpty=t.emptyJsonSchema=t.emptySchema=void 0;var n=r(2),i=a(n),o=r(7),s=a(o),u=r(46),c=a(u),d=r(28),l=a(d),f=r(18),p=a(f),m=r(19),g=a(m),h=r(0),v=a(h),y=r(34),I=a(y),b=r(33),_=a(b),w=r(141),S=a(w),x=r(1),E=t.emptySchema='{\n    "type": "object"\n}',T=(t.emptyJsonSchema=JSON.parse(E),t.isSchemaEmpty=function(e){if(v.default.isEmpty(e))return!0;var t=e;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){return!0}return!(t&&(0,g.default)(t).length&&(!t.properties||(0,g.default)(t.properties).length))||!(t.allOf||t.oneOf||t.anyOf||t.patternProperties)&&(!("object"!==t.type||!v.default.isEmpty(t.properties))||!("array"!==t.type||!v.default.isEmpty(t.items)))},t.isValidJSON=function(e){try{return"object"===(void 0===e?"undefined":(0,p.default)(e))&&(e=(0,l.default)(e)),JSON.parse(e),!0}catch(e){return!1}},t.parseYamlOrJson=function(e){var t=void 0;if(e instanceof Object)t=e;else try{t=JSON.parse(e)}catch(r){try{t=_.default.safeLoad(e)}catch(e){console.log(e)}}return t},function e(t){if(t instanceof Object)if(t.allOf&&t.allOf instanceof Array)for(var r in t.allOf)e(t.allOf[r]);else if(t.allOf&&t.allOf instanceof Array);else if(t.allOf&&t.allOf instanceof Array);else if(t.items)t.minItems=1,e(t.items);else if(t.properties){t.additionalProperties=!1,t.required=v.default.keys(t.properties);for(var a in t.properties)e(t.properties[a])}return t}),P=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.requireAll,a=void 0===r||r,n=(0,c.default)(t,["requireAll"]),i=(0,x.safeParse)(e);return a&&(i=O(i,{definitions:i.definitions||{}},!0),T(i)),(0,S.default)(i,(0,s.default)({failOnInvalidTypes:!1,maxItems:2,maxLength:10},n))};t.fakeExampleFromSchema=P;var k=(t.buildExampleFromSchema=function e(t,r){var a=O((0,x.safeParse)(t),r,!0),n=a.properties,o={};if(n){for(var s in n)if(Object.prototype.hasOwnProperty.call(n,s)){var u=n[s];if(u.default){if(o[s]=u.default,"string"!==u.type)try{o[s]=JSON.parse(u.default)}catch(e){}}else o[s]=e(u)}return o}if(a.items)return[e(a.items)];if(a.allOf){var c=!0,d=!1,l=void 0;try{for(var f,p=(0,i.default)(a.allOf);!(c=(f=p.next()).done);c=!0){var m=f.value;v.default.merge(o,e(m))}}catch(e){d=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(d)throw l}}return o}if(a.oneOf)return e(a.oneOf[0]);if(a.anyOf)return e(a.anyOf[0]);if("object"===a.type)return{};var g=void 0;switch("string"==typeof a.type?a.type:v.default.first(v.default.without(a.type,"null"))){case"number":case"integer":g=1;case"boolean":g=!0;case"string":g="string";default:g=a.type}return g},t.extendSchema=function(e){var t=e.base,r=e.extend,a=e.extendIsSchema;if((0,x.safeStringify)(t,t).match(/"\$ref"/g))return n;var n=(0,x.safeParse)(t),i=(0,x.safeParse)(r);if(!a)try{i=(0,I.default)(i)}catch(e){return n}return v.default.merge(n,i),n},function e(t){var r=t.target,a=void 0===r?{}:r,n=t.schemas,i=void 0===n?{}:n,o=t.previousRefs,s=void 0===o?[]:o,u=t.combinerParent,c=t.hideInheritedFrom,d=void 0,l=void 0;if(v.default.isEmpty(i))return a;if(v.default.get(a,"$ref"))a=q({target:a,schemas:i,ref:a.$ref,previousRefs:s,combinerParent:u,hideInheritedFrom:c});else if(v.default.get(a,"properties"))d=a.properties;else if(v.default.get(a,"items"))if(a.items.$ref){var f=a.items.$ref,p=f.replace("#/","").split("/");if(a.items=q({target:a.items,schemas:i,ref:a.items.$ref,previousRefs:s,combinerParent:u,hideInheritedFrom:c}),!c){var m=v.default.get(i,p.concat("schema"))||v.default.get(i,p);m&&(a.__inheritedFrom={name:f,ref:f})}}else a.items.properties?d=a.items.properties:a.items.allOf?(d=a.items.allOf,l=!0):a.items.oneOf?(d=a.items.oneOf,l=!0):a.items.anyOf&&(d=a.items.anyOf,l=!0);else v.default.get(a,"allOf")?(d=a.allOf,l=!0):v.default.get(a,"oneOf")?(d=a.oneOf,l=!0):v.default.get(a,"anyOf")?(d=a.anyOf,l=!0):v.default.get(a,"additionalProperties")?d=a.additionalProperties:v.default.get(a,"patternProperties")?d=a.patternProperties:v.default.get(a,"dependencies")&&(d=a.dependencies);if(d)for(var g in d)d.hasOwnProperty(g)&&(d[g]=e({target:d[g],schemas:i,previousRefs:s,combinerParent:l,hideInheritedFrom:c}));return a}),q=function(e){var t=e.target,r=e.schemas,a=e.ref,n=e.previousRefs,i=e.combinerParent,o=e.hideInheritedFrom;if(-1!==n.indexOf(a))return t;var u=n.concat(a),c=a.replace("#/","").split("/"),d=v.default.cloneDeep(v.default.get(r,c.concat("schema"))||v.default.get(r,c));if(d){var l=!1;if(d.properties?i?l="properties":o||(d.__inheritedFrom={name:a,ref:a}):d.items?i?l="items":o||(d.__inheritedFrom={name:a,ref:a}):d.allOf?l="allOf":d.oneOf?l="oneOf":d.anyOf&&(l="anyOf"),l){var f=v.default.isArray(d[l])?v.default.map:v.default.mapValues;d[l]=f(d[l],function(e){if(e.properties)return e.properties=v.default.mapValues(e.properties,function(e){var t=(0,s.default)({},e);return o||(t.__inheritedFrom={name:a,ref:a}),t}),e;var t=(0,s.default)({},e);return o||(t.__inheritedFrom={name:a,ref:a}),t})}return k({target:d,schemas:r,previousRefs:u,hideInheritedFrom:o})}return t},O=t.dereferenceSchema=function(e,t,r){return e?(e=(0,x.safeParse)(v.default.cloneDeep(e)),k({target:e,schemas:t,hideInheritedFrom:r})):{}},R=(t.uniqueByNamespace=function(e){var t={},r=!0,a=!1,n=void 0;try{for(var o,s=(0,i.default)(e);!(r=(o=s.next()).done);r=!0){var u=o.value;t[u.namespace]?u.environment&&(t[u.namespace]=u):t[u.namespace]=u}}catch(e){a=!0,n=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw n}}return v.default.values(t)},t.findPropertyByRef=function(e){var t=e.schema,r=void 0===t?{}:t,a=e.refPath,n=void 0===a?[]:a,o=e.namespacePath,s=void 0===o?[]:o,u=r.definition;if("string"==typeof u)try{u=JSON.parse(r.definition)}catch(e){return[{type:"error",message:"Error parsing schema definition with namespace "+r.namespace+". "+e}]}var c=u,d=!0,l=!1,f=void 0;try{for(var p,m=(0,i.default)(n);!(d=(p=m.next()).done);d=!0){var g=p.value;if(""!==g&&g!==s[1]){var h=g.split("/"),v=!0,y=!1,I=void 0;try{for(var b,_=(0,i.default)(h);!(v=(b=_.next()).done);v=!0){var w=b.value;if(!c)break;"object"===c.type&&(c=c.properties),c=c[w]}}catch(e){y=!0,I=e}finally{try{!v&&_.return&&_.return()}finally{if(y)throw I}}}}}catch(e){l=!0,f=e}finally{try{!d&&m.return&&m.return()}finally{if(l)throw f}}return!!c});t.findSchemaByRef=function(e){var t=e.schemas,r=void 0===t?[]:t,a=e.ref,n=void 0===a?"":a,o=!0,s=!1,u=void 0;try{for(var c,d=(0,i.default)(r);!(o=(c=d.next()).done);o=!0){var l=c.value,f=l.namespace.split("#/"),p=n.split("#/");if(f.length>0&&p.length>0&&p[1]===f[1]){var m=!0;if(p.length>1&&(m=R({schema:l,refPath:p,namespacePath:f})),m)return!0}}}catch(e){s=!0,u=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw u}}return!1},t.publicJSON=function(e){return v.default.omit(e,["skipCompliance","createdAt","updatedAt","owner","workspace","project","environment","pendingChanges","committedAt","commits","compliance","groupId","summary","discovered","mock","operationId"])},t.resolveSchema=function(e){var t=e.schema,r=e.swagger;if(v.default.isEmpty(r))return t;var a=v.default.cloneDeep(t);return a.definition=O(a.definition,r),a},t.markFieldsRequired=function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=r?t:v.default.cloneDeep(t),n=v.default.get(a,["items","properties"])||v.default.get(a,["properties"]);return n&&v.default.forOwn(n,function(t,r){v.default.isObject(t)&&(t=e(t,!0)),a.required&&!a.required.includes(r)?a.required.push(r):a.required=[r]}),a},t.schemaMerger=function(e,t){if(v.default.isArray(e))return v.default.uniq(e.concat(t))}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=a(n),o=r(19),s=a(o),u=r(0),c=a(u),d=function(){var e={};return e._jsonSchemaIsRequired=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];return-1!==c.default.indexOf(e.required,t)},e._reduceJsonSchema=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={};if(t.type&&(r.type=t.type),t.$ref)r.$ref=t.$ref;else if("object"===t.type||t.properties||t.patternProperties){r=c.default.clone(t),r.type=r.type||"object",r.children=[];var a=t.properties||[];t.patternProperties&&(a=a?c.default.merge(t.patternProperties,a):t.patternProperties);for(var n in a)if(Object.prototype.hasOwnProperty.call(a,n)){var i=e._toStoplightSchema(a[n]);i.name=n,e._jsonSchemaIsRequired(t,n)&&(i.required=!0),r.children.push(i)}}else"array"===t.type||t.items?(r=c.default.clone(t),r.type=r.type||"array",(0,s.default)(t.items||[]).length?r.children=[e._toStoplightSchema(t.items)]:r.children=[]):r=t;return delete r.properties,delete r.patternProperties,delete r.items,delete r.required,r},e._reduceJsonSchemaCombination=function(t,r){var a=[],n=!0,o=!1,s=void 0;try{for(var u,c=(0,i.default)(t);!(n=(u=c.next()).done);n=!0){var d=u.value;d=e._reduceJsonSchema(d),r&&(d.type=r),a.push(d)}}catch(e){o=!0,s=e}finally{try{!n&&c.return&&c.return()}finally{if(o)throw s}}return a},e._toStoplightSchema=function(t){var r=t;if(c.default.isEmpty(r))return{};var a=void 0;if(t.allOf?a="allOf":t.anyOf?a="anyOf":t.oneOf&&(a="oneOf"),a){var n=t.type;r[a]=e._reduceJsonSchemaCombination(t[a],n),delete r.type}else r=e._reduceJsonSchema(t);return r},e.toStoplightSchema=function(t){return"string"==typeof t&&(t=JSON.parse(t)),e._toStoplightSchema(c.default.cloneDeep(t))},e._isType=function(e,t){return e instanceof Array?c.default.includes(e,t):e===t},e._reduceStoplightSchema=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={};if(t.type&&(r.type=t.type),t.$ref)r.$ref=t.$ref;else if(e._isType(t.type,"object")){if(r=t,r.properties={},r.patternProperties={},r.required=[],t.children){var a=!0,n=!1,o=void 0;try{for(var u,d=(0,i.default)(t.children);!(a=(u=d.next()).done);a=!0){var l=u.value;if(l){l.required&&r.required.push(l.name);var f=e._toJsonSchema(c.default.clone(l));delete f.name;var p=l.name||"",m=r.properties;p.startsWith("^")&&(m=r.patternProperties),m[p]=f}}}catch(e){n=!0,o=e}finally{try{!a&&d.return&&d.return()}finally{if(n)throw o}}}(0,s.default)(r.properties).length||delete r.properties,(0,s.default)(r.patternProperties).length||delete r.patternProperties,delete r.items}else if(e._isType(t.type,"array")){if(r=t,t.children instanceof Array)if(t.children>1){r.items=[];var g=!0,h=!1,v=void 0;try{for(var y,I=(0,i.default)(t.children);!(g=(y=I.next()).done);g=!0){var b=y.value;b.required&&r.required.push(b.name);var _=e._toJsonSchema(c.default.clone(b));delete _.name,r.items.push(_)}}catch(e){h=!0,v=e}finally{try{!g&&I.return&&I.return()}finally{if(h)throw v}}}else r.items=e._toJsonSchema(t.children[0]);else r.items=e._toJsonSchema(t.children);delete r.properties,delete r.patternProperties}else r=t,delete r.required;c.default.isEmpty(r.required)&&delete r.required,delete r.children,delete r.name,delete r._active,delete r._isOpen;for(var w in r)if("type"!==w&&"types"!==w&&"string"==typeof r[w])try{r[w]=JSON.parse(r[w])}catch(e){}return r},e._reduceStoplightSchemaCombination=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=[],a=!0,n=!1,o=void 0;try{for(var s,u=(0,i.default)(t);!(a=(s=u.next()).done);a=!0){var c=s.value;c=e._reduceStoplightSchema(c),r.push(c)}}catch(e){n=!0,o=e}finally{try{!a&&u.return&&u.return()}finally{if(n)throw o}}return r},e._toJsonSchema=function(t){var r=t;if(!r)return{};var a=void 0;if(r.allOf?a="allOf":r.anyOf?a="anyOf":r.oneOf&&(a="oneOf"),a){r[a]=e._reduceStoplightSchemaCombination(r[a]);var n=c.default.map(r[a],"type");if(1===c.default.uniq(n).length){r.type=n[0];var o=!0,s=!1,u=void 0;try{for(var d,l=(0,i.default)(r[a]);!(o=(d=l.next()).done);o=!0){delete d.value.type}}catch(e){s=!0,u=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}}delete r.required,delete r._active,delete r._isOpen}else r=e._reduceStoplightSchema(r);return r},e.toJsonSchema=function(t){return e._toJsonSchema(c.default.cloneDeep(t))},e}();t.default=d},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.computeUpdatesFromCollectionResult=t.computeNewResource=t.computeNewPath=t.computePathParamsFromUri=t.getEndpointsFromSpecs=t.getEndpointsFromSpec=t.getResponseSchemaFromSpecs=t.getEndpointFromSpecs=t.getEndpointFromSpec=t.createStepFromOperation=t.getResponseSchemaFromOperation=t.buildEndpointFromOperation=t.defaultSwaggerSpec=t.parameterTypes=void 0;var n=r(7),i=a(n),o=r(46),s=a(o),u=r(2),c=a(u),d=r(19),l=a(d),f=r(0),p=a(f),m=r(34),g=a(m),h=r(148),v=a(h),y=r(1),I=r(116),b=r(107),_=r(41),w=r(27),S=r(24),x=r(23),E=(t.parameterTypes=["path","query","header","body","formData"],t.defaultSwaggerSpec={swagger:"2.0",info:{title:"My API",version:"1.0"},host:"example.com",paths:{}},t.buildEndpointFromOperation=function(e){var t=e.swagger,r=e.method,a=e.path,n=e.operation,i=void 0===n?{}:n,o=e.specId;return{specName:e.specName,specId:o,method:r,path:a,url:p.default.get(t,"schemes[0]","http")+"://"+(t.host||"{$$.env.host}")+(t.basePath||"")+a,summary:i.summary,operationId:i.operationId,responses:(0,l.default)(i.responses||{})}}),T=t.getResponseSchemaFromOperation=function(e){var t=e.spec,r=e.method,a=e.path,n=e.code,i=(0,y.safeParse)(p.default.get(t,"data"));if(!p.default.isEmpty(i)){var o=p.default.get(i,["paths",a,p.default.toLower(r),"responses",n],{});return(0,_.dereferenceSchema)(o.schema||o,i)}},P=(t.createStepFromOperation=function(e){var t=e.spec,r=e.host,a=e.method,n=e.path,i=e.code,o=e.updateHostOnSearch,s=void 0===o||o,u=(0,w.dereferenceLocal)((0,y.safeParse)(p.default.get(t,"data",t)));if(!p.default.isEmpty(u)){var d=p.default.get(u,["paths",n,p.default.toLower(a)]);if(d){var l=p.default.trimStart(p.default.camelCase(t.slug)+"-","-"),f=void 0;p.default.isEmpty(t.slug)?(f=p.default.get(u,"schemes[0]","http")+"://"+u.host+(u.basePath||""),s||(f=r||f)):f="{$$.env.host}";var m={input:{method:p.default.toLower(a),url:""+f+n}},g=d.summary||d.operationId;p.default.isEmpty(g)||(m.name=g);var h=new RegExp(/{([\^a-zA-Z0-9-_]+)}/g);m.input.url=m.input.url.replace(h,function(e,t){return"{$.ctx."+t+"}"});var v=void 0,I=[],b={},S=p.default.concat(p.default.get(u,["paths",n,"parameters"],[]),p.default.get(d,"parameters",[])),E=!0,T=!1,P=void 0;try{for(var k,q=(0,c.default)(S);!(E=(k=q.next()).done);E=!0){var O=k.value;switch(O.in){case"body":v=p.default.get(O,["x-examples",p.default.first(p.default.keys(O["x-examples"]))]),p.default.isEmpty(v)&&(v=(0,_.buildExampleFromSchema)(O.schema,{definitions:u.definitions}));break;case"query":if(O.required||O.default){var R=O.default||"{$.ctx."+O.name+"}";I.push(O.name+"="+R)}break;case"header":b[O.name]=O.default||"{$.ctx."+O.name+"}"}}}catch(e){T=!0,P=e}finally{try{!E&&q.return&&q.return()}finally{if(T)throw P}}v&&(m.input.body=v,b["Content-Type"]=p.default.get(d,"produces[0]")||p.default.get(u,"produces[0]")||"application/json");var A=p.default.concat(d.security||[],u.security||[]);if(!p.default.isEmpty(A)){var $=void 0,M=!0,j=!1,U=void 0;try{for(var N,C=(0,c.default)(A);!(M=(N=C.next()).done);M=!0){var F=N.value;if(!$)for(var L in F)$||($=p.default.get(u,["securityDefinitions",L]))}}catch(e){j=!0,U=e}finally{try{!M&&C.return&&C.return()}finally{if(j)throw U}}if("apiKey"===p.default.get($,"type"))switch($.in){case"header":b[$.name]=$.default||"{$$.env."+(l+$.name)+"}";break;case"query":var B=$.default||"{$$.env."+(l+$.name)+"}";I.push($.name+"="+B)}else"basic"===p.default.get($,"type")&&(m.input.auth={type:"basic",username:"{$$.env."+l+"username}",password:"{$$.env."+l+"password}"})}if(I.length)for(var D in I)0===Number(D)?m.input.url=m.input.url+"?"+I[D]:m.input.url=m.input.url+"&"+I[D];return p.default.isEmpty(b)||(m.input.headers=b),i&&(m.after={assertions:[{target:"output.status",op:"eq",expected:Number(i)}]}),(0,x.newStep)(m)}}},t.getEndpointFromSpec=function(e){var t=e.spec,r=e.method,a=e.url,n=e.variables,i=(0,y.safeParse)(p.default.get(t,"data"));if(!p.default.isEmpty(i)){var o=p.default.replace(a,new RegExp("^{[^/]+}/"),"/");o=(0,I.replaceVariables)(o,n),o=o.split("?")[0];try{o=(0,S.createURL)(o),o=o.pathname}catch(e){}o=(0,S.cleanSlashes)(o),i.basePath&&(o=o.replace(i.basePath,"")),o=p.default.isEmpty(o)?"/":o.replace("%7B","{").replace("%7D","}");var s=(0,S.buildPathParts)(o),u=void 0,c=-1;for(var d in i.paths)if(Object.prototype.hasOwnProperty.call(i.paths,d)){var l=r?i.paths[d][p.default.toLower(r)]:{};if(l){if(o===d)return E({swagger:i,method:r,path:d,operation:l,specId:t._id,specName:t.name});var f=(0,S.buildPathParts)(d);if(f.length===s.length){var m=!0,g=0;for(var h in f)if(!f[h].match(/\{.*?\}/)){if(f[h]!==s[h]){m=!1,g=-1;break}g++}m&&g>c&&(c=g,u=E({swagger:i,method:r,path:d,operation:l,specId:t._id,specName:t.name}))}}}return u}}),k=function(e){var t=e.specs,r=(0,s.default)(e,["specs"]);if(p.default.isEmpty(t))return null;if(!(t instanceof Array))return P((0,i.default)({spec:t},r));var a=!0,n=!1,o=void 0;try{for(var u,d=(0,c.default)(t);!(a=(u=d.next()).done);a=!0){var l=u.value,f=P((0,i.default)({spec:l},r));if(f)return f}}catch(e){n=!0,o=e}finally{try{!a&&d.return&&d.return()}finally{if(n)throw o}}return null};t.getEndpointFromSpecs=k;var q=(t.getResponseSchemaFromSpecs=function(e){var t=e.specs,r=e.method,a=e.url,n=e.code,i=e.variables,o=k({specs:t,method:r,url:a,variables:i}),s=void 0;if(o){var u=p.default.find(t,{_id:o.specId});s=T({spec:u,method:r,path:o.path,code:n})}return s},t.getEndpointsFromSpec=function(e){var t=(0,y.safeParse)(p.default.get(e,"data"));if(p.default.isEmpty(t))return[];var r=[];for(var a in t.paths)if(Object.prototype.hasOwnProperty.call(t.paths,a))for(var n in t.paths[a])if("parameters"!==n){var i=t.paths[a][n];r.push(E({swagger:t,method:n,path:a,operation:i,specName:e.name,specId:e._id}))}return r}),O=(t.getEndpointsFromSpecs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(p.default.isEmpty(e))return[];if(!(e instanceof Array))return q(e);var t=[],r=!0,a=!1,n=void 0;try{for(var i,o=(0,c.default)(e);!(r=(i=o.next()).done);r=!0){var s=i.value;t=t.concat(q(s))}}catch(e){a=!0,n=e}finally{try{!r&&o.return&&o.return()}finally{if(a)throw n}}return t},t.computePathParamsFromUri=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.existingParams,a=p.default.reject(r||[],{in:"path"}),n=e.match(/{([\w]*)}/g);if(n){var i=!0,o=!1,s=void 0;try{for(var u,d=(0,c.default)(n);!(i=(u=d.next()).done);i=!0){var l=u.value;a.push({name:l.replace(/{|}/g,""),in:"path",type:"string",required:!0})}}catch(e){o=!0,s=e}finally{try{!i&&d.return&&d.return()}finally{if(o)throw s}}}return a});t.computeNewPath=function(e){var t=e.paths,r=e.path,a=void 0===r?"":r,n=e.methods,i=void 0===n?[]:n,o=e.skipConfirm,s=[];if(p.default.isEmpty(a))return void alert("You must specify a path.");if(p.default.isEmpty(i))return void alert("You must specify at least one method.");"/"!==a.charAt(0)&&(a="/"+a);var u=!0,d=p.default.get(t,a);if(d&&(u=o||confirm("The "+a+" path already exists in this spec. Extend it?")),u){var l=p.default.cloneDeep(d||{}),f=O(a,{existingParams:l.parameters});l||p.default.isEmpty(f)||(l.parameters=f);var m=!0,g=!1,h=void 0;try{for(var v,y=(0,c.default)(i);!(m=(v=y.next()).done);m=!0){l[v.value]={responses:{200:{description:"",schema:{type:"object",properties:{}}}}}}}catch(e){g=!0,h=e}finally{try{!m&&y.return&&y.return()}finally{if(g)throw h}}return s.push({transformation:"set",path:["paths",a],value:l}),s}},t.computeNewResource=function(e){var t=e.path,r=void 0===t?"":t,a=e.name,n=e.input,i=e.output,o=[];if(p.default.isEmpty(a))return void alert("You must specify a model name.");if(p.default.isEmpty(r))return void alert("You must specify a base resource path.");"/"!==r.charAt(0)&&(r="/"+r);var s=p.default.camelCase(a||""),u=s+"Id",d=r+"/{"+u+"}",f=!0,m=p.default.get(void 0,"parsed.paths."+r),h=p.default.get(void 0,"parsed.paths."+d);if(m?f=confirm("The "+r+" path already exists in this spec. Extend it?"):h&&(f=confirm("The "+h+" path already exists in this spec. Extend it?")),f){var I=(0,y.safeParse)(n),b=void 0,_=void 0,w=void 0;if(p.default.isEmpty(I))return void alert("Please provide an example of the input model.");try{b=(0,g.default)(I),_=s+"-input",w="#/definitions/"+_}catch(e){return alert("Could not generate input schema. Is it valid JSON?"),void console.warn("could not generate input schema",e,I)}var S=(0,y.safeParse)(i),x=p.default.cloneDeep(S),E=void 0,T=void 0,P=void 0;if(p.default.isEmpty(S))return void alert("Please provide an example of the full model.");if(!p.default.isEmpty(I)){var k=!0,q=!1,R=void 0;try{for(var A,$=(0,c.default)((0,l.default)(I));!(k=(A=$.next()).done);k=!0){var M=A.value;p.default.unset(x,M)}}catch(e){q=!0,R=e}finally{try{!k&&$.return&&$.return()}finally{if(q)throw R}}}try{E={allOf:[(0,g.default)(x),{$ref:w}]},T=s+"-output",P="#/definitions/"+T}catch(e){return alert("Could not generate output schema. Is it valid JSON?"),void console.warn("could not generate output schema",e,S)}var j=void 0,U=void 0;p.default.isEqual(I,S)?(U=I,j="#/definitions/"+s,o.push({transformation:"set",path:["definitions",s],value:b})):(o.push({transformation:"set",path:["definitions",_],value:b}),o.push({transformation:"set",path:["definitions",T],value:E}));var N=m||{},C=O(r);m||p.default.isEmpty(C)||(N.parameters=C),N.get={operationId:"find"+p.default.capitalize((0,v.default)(a)),responses:{200:{description:"",schema:{type:"array",items:{$ref:j||P}},examples:{"application/json":[U||S]}}}},N.post={operationId:"create"+p.default.capitalize(a),parameters:[{in:"body",name:"body",schema:{$ref:j||w,example:U||I}}],responses:{201:{description:"",schema:{$ref:j||P},examples:{"application/json":U||S}}}};var F=h||{},L=O(d);return h||p.default.isEmpty(L)||(F.parameters=L),F.get={operationId:"get"+p.default.capitalize(a),responses:{200:{description:"",schema:{$ref:j||P},examples:{"application/json":U||S}}}},F.put={operationId:"update"+p.default.capitalize(a),parameters:[{in:"body",name:"body",schema:{$ref:j||w,example:U||I}}],responses:{200:{description:"",schema:{$ref:j||P},examples:{"application/json":U||S}}}},F.delete={operationId:"delete"+p.default.capitalize(a),responses:{204:{description:""}}},o.push({transformation:"set",path:["paths",r],value:N}),o.push({transformation:"set",path:["paths",d],value:F}),o}},t.computeUpdatesFromCollectionResult=function(e){var t=e.spec,r=e.result,a=void 0===r?{}:r,n=(0,b.collectionResultToHar)({result:a}),i=(0,b.harToSwagger2)({existingSpec:p.default.cloneDeep(t),har:n})||{},o=[];return i.consumes&&o.push({transformation:"set",path:["consumes"],value:p.default.uniq((t.consumes||[]).concat(i.consumes))}),i.produces&&o.push({transformation:"set",path:["produces"],value:p.default.uniq((t.produces||[]).concat(i.produces))}),t.paths&&p.default.forEach(i.paths,function(e,r){var a=!0;p.default.get(t,"paths."+r)&&(a=confirm("The "+r+" path already exists in this spec. Extend it?")),a&&o.push({transformation:"set",path:["paths",r],value:p.default.merge(t.paths[r],e)})}),o}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.migrateTests=void 0;var n=r(2),i=a(n),o=r(0),s=a(o),u=r(20),c=a(u),d=r(1),l=function(e){var t=(0,d.safeStringify)(e),r=t.match(/<<([\w- ]+)>>|%3C%3C([\w- ]+)%3E%3E|\\<\\<([\w- ]+)\\>\\>|{([\w- ]+)\}/gm);return s.default.forEach(r,function(e){var r=s.default.trim(e,"<>%3C%3E\\<\\>{}");t=s.default.replace(t,e,"{$$.env."+r+"}")}),t=s.default.replace(t,"SL.variables","$$.env"),(0,d.safeParse)(t)},f=function(e){if(!e||!s.default.isEmpty(e)){var t=[],r=!0,a=!1,n=void 0;try{for(var o,u=(0,i.default)(e);!(r=(o=u.next()).done);r=!0){var c=o.value,l=void 0,f=c.op;if(!s.default.startsWith(c.op,"validate")||!c.match){"response.body"===c.location?l="output.body":"response.code"===c.location&&(l="output.status"),c.target&&!s.default.isEmpty(c.target)&&(l+="."+c.target);var p=c.expected;s.default.isObject(p)&&(p=(0,d.safeStringify)(p)),t.push({target:l,op:f,expected:p})}}}catch(e){a=!0,n=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw n}}return t}},p=function(e){var t="",r=e.split(".");return r.length>1?s.default.forEach(r,function(e,r){e.match(/^[a-zA-Z_][a-z$0-9A-Z_]*$/gm)||s.default.startsWith(e,"[")?(0===r||s.default.startsWith(e,"[")||(t+="."),t+=e):t+="['"+e+"']"}):t=e.match(/^[a-zA-Z_][a-z$0-9A-Z_]*$/gm)||s.default.startsWith(e,"[")?e:"['"+e+"']",t},m=function(e){var t=s.default.get(e,"body");if(!t||!s.default.isEmpty(t)){var r=[],a=!0,n=!1,o=void 0;try{for(var u,c=(0,i.default)(t);!(a=(u=c.next()).done);a=!0){var d=u.value,l=p(d.value);l=s.default.startsWith(l,"[")?"output.body"+l:"output.body."+l;var f=p(d.name);f=s.default.startsWith(f,"[")?"$$.env"+f:"$$.env."+f,r.push({source:l,target:f})}}catch(e){n=!0,o=e}finally{try{!a&&c.return&&c.return()}finally{if(n)throw o}}return r}},g=function(e){var t=e;t=s.default.startsWith(t,"function (ctx, request) {")?s.default.trimStart(t,"function (ctx, request) {"):s.default.trimStart(t,"function (ctx, request, response) {"),t=t.slice(0,-1);var r=[],a=!0,n=!1,o=void 0;try{for(var u,c=(0,i.default)(t.split("\n"));!(a=(u=c.next()).done);a=!0){var d=u.value;s.default.trim(d).length>0&&(d="// "+d),r.push(d)}}catch(e){n=!0,o=e}finally{try{!a&&c.return&&c.return()}finally{if(n)throw o}}return r.join("\n")},h=function(e,t,r){var a=void 0;if(e){var n=g(e);""!==n&&(a={script:n})}if(!s.default.isEmpty(t)){var i=m(t);s.default.isEmpty(i)||(a=a||{},a.transforms=i)}if(!s.default.isEmpty(r)){var o=f(r);s.default.isEmpty(o)||(a=a||{},a.assertions=o)}return a},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={method:e.method},a=e.url;if(t&&(a="{$$.env.host}"+a),r.url=a,"basic"===s.default.get(e,"authorization.authType")){var n={type:"basic",username:s.default.get(e,"authorization.params[0].name"),password:s.default.get(e,"authorization.params[0].value")};r.auth=n}if(!s.default.isEmpty(s.default.get(e,"headers"))){var o={},u=!0,c=!1,l=void 0;try{for(var f,p=(0,i.default)(s.default.get(e,"headers"));!(u=(f=p.next()).done);u=!0){var m=f.value;o[m.name]=m.value}}catch(e){c=!0,l=e}finally{try{!u&&p.return&&p.return()}finally{if(c)throw l}}r.headers=o}if(!s.default.isEmpty(s.default.get(e,"queryString"))){r.url=r.url.split("?")[0];var g=[],h=!0,v=!1,y=void 0;try{for(var I,b=(0,i.default)(s.default.get(e,"queryString"));!(h=(I=b.next()).done);h=!0){var _=I.value;g.push(_.name+"="+_.value)}}catch(e){v=!0,y=e}finally{try{!h&&b.return&&b.return()}finally{if(v)throw y}}s.default.isEmpty(g)||(r.url+="?"+g.join("&"))}if(s.default.get(e,"postData.mimeType")){r.headers||(r.headers={}),r.headers["Content-Type"]=s.default.get(e,"postData.mimeType");var w=void 0;if(s.default.isEmpty(s.default.get(e,"postData.params")))w=s.default.get(e,"postData.text");else{w={};var S=!0,x=!1,E=void 0;try{for(var T,P=(0,i.default)(s.default.get(e,"postData.params"));!(S=(T=P.next()).done);S=!0){var k=T.value;w[k.name]=k.value}}catch(e){x=!0,E=e}finally{try{!S&&P.return&&P.return()}finally{if(x)throw E}}}r.body=(0,d.safeStringify)(w)}return r},y=function(e){return s.default.get(e,"test")?{ref:e.test}:v(e.request,e.useRelativeUrl)},I=function(e){return{id:c.default.generate().substring(0,4).toLowerCase(),type:s.default.get(e,"test")?"ref":"http",name:s.default.get(e,"name")||"",input:y(e),before:h(e.middlewareBefore,null,null),after:h(e.middlewareAfter,e.capture,e.assertions)}},b=function(e,t){var r=!0,a=!1,n=void 0;try{for(var o,s=(0,i.default)(e.data.scenarios);!(r=(o=s.next()).done);r=!0){var u=o.value;if(u.test===t._id)return u}}catch(e){a=!0,n=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw n}}return null},_=function(e,t){var r=!0,a=!1,n=void 0;try{for(var o,s=(0,i.default)(e.data.scenarios);!(r=(o=s.next()).done);r=!0){var u=o.value,c=!0,d=!1,l=void 0;try{for(var f,p=(0,i.default)(u.steps);!(c=(f=p.next()).done);c=!0){var m=f.value;if("ref"===m.type){var g=!0,h=!1,v=void 0;try{for(var y,I=(0,i.default)(t);!(g=(y=I.next()).done);g=!0){var _=y.value;if(_._id===m.input.ref){var w=b(e,_);w&&(m.input.ref="#/scenarios/"+w.id)}}}catch(e){h=!0,v=e}finally{try{!g&&I.return&&I.return()}finally{if(h)throw v}}}}}catch(e){d=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(d)throw l}}}}catch(e){a=!0,n=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw n}}var S=!0,x=!1,E=void 0;try{for(var T,P=(0,i.default)(e.data.scenarios);!(S=(T=P.next()).done);S=!0){delete T.value.test}}catch(e){x=!0,E=e}finally{try{!S&&P.return&&P.return()}finally{if(x)throw E}}},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={id:c.default.generate().substring(0,5).toLowerCase(),name:e.name||"New Scenario",description:e.summary||"",steps:[]},r=!0,a=!1,n=void 0;try{for(var o,s=(0,i.default)(e.steps||[]);!(r=(o=s.next()).done);r=!0){var u=o.value,d=I(u);t.steps.push(l(d))}}catch(e){a=!0,n=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw n}}return t.test=e._id,t};t.migrateTests=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={name:"Scenario Collection",scenarios:[]},r=!0,a=!1,n=void 0;try{for(var o,s=(0,i.default)(e);!(r=(o=s.next()).done);r=!0){var u=o.value;t.data.scenarios.push(w(u))}}catch(e){a=!0,n=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw n}}return _(t,e),t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.replaceVariables=t.extractVariables=void 0;var a=r(0),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=r(1),o=t.extractVariables=function(e){for(var t=(0,i.safeStringify)(e),r=[],a=new RegExp(/\{(\$\.[\[\]\.\w- ']+)\}|\{(\$\$\.[\[\]\.\w- ']+)\}/g);;){var o=a.exec(t);if(!o||n.default.isEmpty(o))return n.default.uniq(r);r.push(o[0])}};t.replaceVariables=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(0,i.safeParse)(r);if(n.default.isEmpty(t)||n.default.isEmpty(a))return t;var s=!1,u=(0,i.safeStringify)(t),c=o(t);return n.default.forEach(c,function(e){var t=n.default.trimStart(n.default.trim(e,"{} "),"$."),r=n.default.get(a,t);if(void 0!==r){if("string"==typeof r)u=u.replace(new RegExp(n.default.escapeRegExp(e),"g"),(0,i.safeStringify)(r));else{var o=n.default.replace(e,"$$.","\\$\\$.");o===e&&(o=n.default.replace(e,"$.","\\$.")),e=o,u=u.replace(new RegExp('"'+e+'"|'+e,"g"),(0,i.safeStringify)(r))}s=!0}}),s&&(u=e(u,r)),(0,i.safeParse)(u,u||t)}},function(e,t){e.exports=require("async/whilst")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-prototype-of")},function(e,t){e.exports=require("babel-runtime/helpers/inherits")},function(e,t){e.exports=require("babel-runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("bugsnag")},function(e,t){e.exports=require("cache-service-cache-module")},function(e,t){e.exports=require("commander")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("feathers-authentication")},function(e,t){e.exports=require("feathers-authentication-jwt")},function(e,t){e.exports=require("feathers-authentication-local")},function(e,t){e.exports=require("feathers-authentication-oauth2")},function(e,t){e.exports=require("feathers-errors/handler")},function(e,t){e.exports=require("feathers-errors/not-found")},function(e,t){e.exports=require("feathers-hooks")},function(e,t){e.exports=require("feathers-mailer")},function(e,t){e.exports=require("feathers-rest")},function(e,t){e.exports=require("feathers-socketio")},function(e,t){e.exports=require("json-schema-faker")},function(e,t){e.exports=require("json-source-map")},function(e,t){e.exports=require("json-stringify-safe")},function(e,t){e.exports=require("merge-deep")},function(e,t){e.exports=require("newrelic")},function(e,t){e.exports=require("passport-github")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("pluralize")},function(e,t){e.exports=require("querystring")},function(e,t){e.exports=require("recast")},function(e,t){e.exports=require("serve-favicon")},function(e,t){e.exports=require("simple-oauth2")},function(e,t){e.exports=require("speakingurl")},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("superagent-cache-plugin")},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("winston")},function(e,t,r){e.exports=r(51)}]));